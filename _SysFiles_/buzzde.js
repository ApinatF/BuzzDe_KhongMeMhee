#!/usr/bin/env node
"use strict";var t=require("process"),e=require("fs"),i=require("path"),r=require("url"),s=require("fs/promises"),n=require("events"),o=require("stream"),a=require("string_decoder");function c(t){var e=Object.create(null);return t&&Object.keys(t).forEach((function(i){if("default"!==i){var r=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(e,i,r.get?r:{enumerable:!0,get:function(){return t[i]}})}})),e.default=t,Object.freeze(e)}var l=c(e),h=c(i);function u(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function d(t){return"number"==typeof t||(!!/^0x[0-9a-f]+$/i.test(t)||/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(t))}function p(t,e){return"constructor"===e&&"function"==typeof t[e]||"__proto__"===e}var f=function(t,e){e||(e={});var i={bools:{},strings:{},unknownFn:null};"function"==typeof e.unknown&&(i.unknownFn=e.unknown),"boolean"==typeof e.boolean&&e.boolean?i.allBools=!0:[].concat(e.boolean).filter(Boolean).forEach((function(t){i.bools[t]=!0}));var r={};function s(t){return r[t].some((function(t){return i.bools[t]}))}Object.keys(e.alias||{}).forEach((function(t){r[t]=[].concat(e.alias[t]),r[t].forEach((function(e){r[e]=[t].concat(r[t].filter((function(t){return e!==t})))}))})),[].concat(e.string).filter(Boolean).forEach((function(t){i.strings[t]=!0,r[t]&&[].concat(r[t]).forEach((function(t){i.strings[t]=!0}))}));var n=e.default||{},o={_:[]};function a(t,e,r){for(var s=t,n=0;n<e.length-1;n++){var o=e[n];if(p(s,o))return;void 0===s[o]&&(s[o]={}),s[o]!==Object.prototype&&s[o]!==Number.prototype&&s[o]!==String.prototype||(s[o]={}),s[o]===Array.prototype&&(s[o]=[]),s=s[o]}var a=e[e.length-1];p(s,a)||(s!==Object.prototype&&s!==Number.prototype&&s!==String.prototype||(s={}),s===Array.prototype&&(s=[]),void 0===s[a]||i.bools[a]||"boolean"==typeof s[a]?s[a]=r:Array.isArray(s[a])?s[a].push(r):s[a]=[s[a],r])}function c(t,e,s){if(!s||!i.unknownFn||function(t,e){return i.allBools&&/^--[^=]+$/.test(e)||i.strings[t]||i.bools[t]||r[t]}(t,s)||!1!==i.unknownFn(s)){var n=!i.strings[t]&&d(e)?Number(e):e;a(o,t.split("."),n),(r[t]||[]).forEach((function(t){a(o,t.split("."),n)}))}}Object.keys(i.bools).forEach((function(t){c(t,void 0!==n[t]&&n[t])}));var l=[];-1!==t.indexOf("--")&&(l=t.slice(t.indexOf("--")+1),t=t.slice(0,t.indexOf("--")));for(var h=0;h<t.length;h++){var u,f,g=t[h];if(/^--.+=/.test(g)){var m=g.match(/^--([^=]+)=([\s\S]*)$/);u=m[1];var y=m[2];i.bools[u]&&(y="false"!==y),c(u,y,g)}else if(/^--no-.+/.test(g))c(u=g.match(/^--no-(.+)/)[1],!1,g);else if(/^--.+/.test(g))u=g.match(/^--(.+)/)[1],void 0===(f=t[h+1])||/^(-|--)[^-]/.test(f)||i.bools[u]||i.allBools||r[u]&&s(u)?/^(true|false)$/.test(f)?(c(u,"true"===f,g),h+=1):c(u,!i.strings[u]||"",g):(c(u,f,g),h+=1);else if(/^-[^-]+/.test(g)){for(var v=g.slice(1,-1).split(""),b=!1,w=0;w<v.length;w++)if("-"!==(f=g.slice(w+2))){if(/[A-Za-z]/.test(v[w])&&"="===f[0]){c(v[w],f.slice(1),g),b=!0;break}if(/[A-Za-z]/.test(v[w])&&/-?\d+(\.\d*)?(e-?\d+)?$/.test(f)){c(v[w],f,g),b=!0;break}if(v[w+1]&&v[w+1].match(/\W/)){c(v[w],g.slice(w+2),g),b=!0;break}c(v[w],!i.strings[v[w]]||"",g)}else c(v[w],f,g);u=g.slice(-1)[0],b||"-"===u||(!t[h+1]||/^(-|--)[^-]/.test(t[h+1])||i.bools[u]||r[u]&&s(u)?t[h+1]&&/^(true|false)$/.test(t[h+1])?(c(u,"true"===t[h+1],g),h+=1):c(u,!i.strings[u]||"",g):(c(u,t[h+1],g),h+=1))}else if(i.unknownFn&&!1===i.unknownFn(g)||o._.push(i.strings._||!d(g)?g:Number(g)),e.stopEarly){o._.push.apply(o._,t.slice(h+1));break}}return Object.keys(n).forEach((function(t){(function(t,e){var i=t;return e.slice(0,-1).forEach((function(t){i=i[t]||{}})),e[e.length-1]in i})(o,t.split("."))||(a(o,t.split("."),n[t]),(r[t]||[]).forEach((function(e){a(o,e.split("."),n[t])})))})),e["--"]?o["--"]=l.slice():l.forEach((function(t){o._.push(t)})),o},g=u(f);const m=".".charCodeAt(0),y=/\\(\\)?/g,v=RegExp("[^.[\\]]+|\\[(?:([^\"'][^[]*)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))","g"),b=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,w=/^\w*$/,S=function(t){const e=typeof t;return"symbol"===e||"object"===e&&t&&"[object Symbol]"===function(t){return Object.prototype.toString.call(t)}(t)},_=function(t,e){return Array.isArray(t)?t:function(t,e){if(Array.isArray(t))return!1;const i=typeof t;return!("number"!==i&&"symbol"!==i&&"boolean"!==i&&t&&!S(t))||w.test(t)||!b.test(t)||null!=e&&t in Object(e)}(t,e)?[t]:function(t){const e=[];return t.charCodeAt(0)===m&&e.push(""),t.replace(v,(function(t,i,r,s){let n=t;r?n=s.replace(y,"$1"):i&&(n=i.trim()),e.push(n)})),e}(t)},k=function(t){if("string"==typeof t||S(t))return t;const e=`${t}`;return"0"==e&&1/t==-INFINITY?"-0":e},E=function(t,e){let i=0;const r=(e=_(e,t)).length;for(;null!=t&&i<r;)t=t[k(e[i++])];return i&&i===r?t:void 0},A=function(t){if(null==t)return[void 0,void 0];if("object"!=typeof t)return[Error('Invalid option "columns": expect an array or an object')];if(Array.isArray(t)){const e=[];for(const i of t)if("string"==typeof i)e.push({key:i,header:i});else{if("object"!=typeof i||null===i||Array.isArray(i))return[Error("Invalid column definition: expect a string or an object")];if(!i.key)return[Error('Invalid column definition: property "key" is required')];void 0===i.header&&(i.header=i.key),e.push(i)}t=e}else{const e=[];for(const i in t)e.push({key:i,header:t[i]});t=e}return[void 0,t]};class C extends Error{constructor(t,e,...i){Array.isArray(e)&&(e=e.join(" ")),super(e),void 0!==Error.captureStackTrace&&Error.captureStackTrace(this,C),this.code=t;for(const t of i)for(const e in t){const i=t[e];this[e]=Buffer.isBuffer(i)?i.toString():null==i?i:JSON.parse(JSON.stringify(i))}}}const R=function(t){return t.replace(/([A-Z])/g,(function(t,e){return"_"+e.toLowerCase()}))},x=function(t){const e={};for(const i in t)e[R(i)]=t[i];if(void 0===e.bom||null===e.bom||!1===e.bom)e.bom=!1;else if(!0!==e.bom)return[new C("CSV_OPTION_BOOLEAN_INVALID_TYPE",["option `bom` is optional and must be a boolean value,",`got ${JSON.stringify(e.bom)}`])];if(void 0===e.delimiter||null===e.delimiter)e.delimiter=",";else if(Buffer.isBuffer(e.delimiter))e.delimiter=e.delimiter.toString();else if("string"!=typeof e.delimiter)return[new C("CSV_OPTION_DELIMITER_INVALID_TYPE",["option `delimiter` must be a buffer or a string,",`got ${JSON.stringify(e.delimiter)}`])];if(void 0===e.quote||null===e.quote)e.quote='"';else if(!0===e.quote)e.quote='"';else if(!1===e.quote)e.quote="";else if(Buffer.isBuffer(e.quote))e.quote=e.quote.toString();else if("string"!=typeof e.quote)return[new C("CSV_OPTION_QUOTE_INVALID_TYPE",["option `quote` must be a boolean, a buffer or a string,",`got ${JSON.stringify(e.quote)}`])];if(void 0!==e.quoted&&null!==e.quoted||(e.quoted=!1),void 0===e.escape_formulas||null===e.escape_formulas)e.escape_formulas=!1;else if("boolean"!=typeof e.escape_formulas)return[new C("CSV_OPTION_ESCAPE_FORMULAS_INVALID_TYPE",["option `escape_formulas` must be a boolean,",`got ${JSON.stringify(e.escape_formulas)}`])];if(void 0!==e.quoted_empty&&null!==e.quoted_empty||(e.quoted_empty=void 0),void 0===e.quoted_match||null===e.quoted_match||!1===e.quoted_match?e.quoted_match=null:Array.isArray(e.quoted_match)||(e.quoted_match=[e.quoted_match]),e.quoted_match)for(const t of e.quoted_match){const e=t instanceof RegExp;if(!("string"==typeof t)&&!e)return[Error(`Invalid Option: quoted_match must be a string or a regex, got ${JSON.stringify(t)}`)]}if(void 0!==e.quoted_string&&null!==e.quoted_string||(e.quoted_string=!1),void 0!==e.eof&&null!==e.eof||(e.eof=!0),void 0===e.escape||null===e.escape)e.escape='"';else if(Buffer.isBuffer(e.escape))e.escape=e.escape.toString();else if("string"!=typeof e.escape)return[Error(`Invalid Option: escape must be a buffer or a string, got ${JSON.stringify(e.escape)}`)];if(e.escape.length>1)return[Error(`Invalid Option: escape must be one character, got ${e.escape.length} characters`)];void 0!==e.header&&null!==e.header||(e.header=!1);const[i,r]=A(e.columns);if(void 0!==i)return[i];if(e.columns=r,void 0!==e.quoted&&null!==e.quoted||(e.quoted=!1),void 0!==e.cast&&null!==e.cast||(e.cast={}),void 0!==e.cast.bigint&&null!==e.cast.bigint||(e.cast.bigint=t=>""+t),void 0!==e.cast.boolean&&null!==e.cast.boolean||(e.cast.boolean=t=>t?"1":""),void 0!==e.cast.date&&null!==e.cast.date||(e.cast.date=t=>""+t.getTime()),void 0!==e.cast.number&&null!==e.cast.number||(e.cast.number=t=>""+t),void 0!==e.cast.object&&null!==e.cast.object||(e.cast.object=t=>JSON.stringify(t)),void 0!==e.cast.string&&null!==e.cast.string||(e.cast.string=function(t){return t}),void 0!==e.on_record&&"function"!=typeof e.on_record)return[Error('Invalid Option: "on_record" must be a function.')];if(void 0===e.record_delimiter||null===e.record_delimiter)e.record_delimiter="\n";else if(Buffer.isBuffer(e.record_delimiter))e.record_delimiter=e.record_delimiter.toString();else if("string"!=typeof e.record_delimiter)return[Error(`Invalid Option: record_delimiter must be a buffer or a string, got ${JSON.stringify(e.record_delimiter)}`)];switch(e.record_delimiter){case"unix":e.record_delimiter="\n";break;case"mac":e.record_delimiter="\r";break;case"windows":e.record_delimiter="\r\n";break;case"ascii":e.record_delimiter="";break;case"unicode":e.record_delimiter="\u2028"}return[void 0,e]},I=Buffer.from([239,187,191]),N=function(t,e={}){const i=[],[r,s]=x(e);if(void 0!==r)throw r;const n=function(t,e,i){return{options:t,state:e,info:i,__transform:function(t,e){if(!Array.isArray(t)&&"object"!=typeof t)return Error(`Invalid Record: expect an array or an object, got ${JSON.stringify(t)}`);if(0===this.info.records)if(Array.isArray(t)){if(!0===this.options.header&&void 0===this.options.columns)return Error("Undiscoverable Columns: header option requires column option or object records")}else if(void 0===this.options.columns){const[e,i]=A(Object.keys(t));if(e)return;this.options.columns=i}if(0===this.info.records){this.bom(e);const t=this.headers(e);if(t)return t}try{this.options.on_record&&this.options.on_record(t,this.info.records)}catch(i){return i}let i,r;if(this.options.eof){if([i,r]=this.stringify(t),i)return i;if(void 0===r)return;r+=this.options.record_delimiter}else{if([i,r]=this.stringify(t),i)return i;if(void 0===r)return;(this.options.header||this.info.records)&&(r=this.options.record_delimiter+r)}this.info.records++,e(r)},stringify:function(t,e=!1){if("object"!=typeof t)return[void 0,t];const{columns:i}=this.options,r=[];if(Array.isArray(t)){i&&t.splice(i.length);for(let i=0;i<t.length;i++){const s=t[i],[n,o]=this.__cast(s,{index:i,column:i,records:this.info.records,header:e});if(n)return[n];r[i]=[o,s]}}else for(let s=0;s<i.length;s++){const n=E(t,i[s].key),[o,a]=this.__cast(n,{index:s,column:i[s].key,records:this.info.records,header:e});if(o)return[o];r[s]=[a,n]}let s="";for(let t=0;t<r.length;t++){let e,i,[o,a]=r[t];if("string"==typeof o)e=this.options;else if("object"!=typeof(n=o)||null===n||Array.isArray(n)){if(null!=o)return[Error(`Invalid Casting Value: returned value must return a string, an object, null or undefined, got ${JSON.stringify(o)}`)];e=this.options}else{if(e=o,o=e.value,delete e.value,"string"!=typeof o&&null!=o&&i)return[Error(`Invalid Casting Value: returned value must return a string, null or undefined, got ${JSON.stringify(o)}`)];if(e={...this.options,...e},[i,e]=x(e),void 0!==i)return[i]}const{delimiter:c,escape:l,quote:h,quoted:u,quoted_empty:d,quoted_string:p,quoted_match:f,record_delimiter:g,escape_formulas:m}=e;if(""===o&&""===a){let t=f&&f.filter((t=>"string"==typeof t?-1!==o.indexOf(t):t.test(o)));t=t&&t.length>0,!0===(t||!0===d||!0===p&&!1!==d)&&(o=h+o+h),s+=o}else if(o){if("string"!=typeof o)return[Error(`Formatter must return a string, null or undefined, got ${JSON.stringify(o)}`)];const t=c.length&&o.indexOf(c)>=0,e=""!==h&&o.indexOf(h)>=0,i=o.indexOf(l)>=0&&l!==h,r=o.indexOf(g)>=0,n=p&&"string"==typeof a;let d=f&&f.filter((t=>"string"==typeof t?-1!==o.indexOf(t):t.test(o)));if(d=d&&d.length>0,m)switch(o[0]){case"=":case"+":case"-":case"@":case"\t":case"\r":case"＝":case"＋":case"－":case"＠":o=`'${o}`}const y=!0===e||t||r||u||n||d;if(!0===y&&!0===i){const t="\\"===l?new RegExp(l+l,"g"):new RegExp(l,"g");o=o.replace(t,l+l)}if(!0===e){const t=new RegExp(h,"g");o=o.replace(t,l+h)}!0===y&&(o=h+o+h),s+=o}else(!0===d||""===a&&!0===p&&!1!==d)&&(s+=h+h);t!==r.length-1&&(s+=c)}var n;return[void 0,s]},bom:function(t){!0===this.options.bom&&t(I)},headers:function(t){if(!1===this.options.header)return;if(void 0===this.options.columns)return;let e,i=this.options.columns.map((t=>t.header));if(this.options.eof?([e,i]=this.stringify(i,!0),i+=this.options.record_delimiter):[e,i]=this.stringify(i),e)return e;t(i)},__cast:function(t,e){const i=typeof t;try{return"string"===i?[void 0,this.options.cast.string(t,e)]:"bigint"===i?[void 0,this.options.cast.bigint(t,e)]:"number"===i?[void 0,this.options.cast.number(t,e)]:"boolean"===i?[void 0,this.options.cast.boolean(t,e)]:t instanceof Date?[void 0,this.options.cast.date(t,e)]:"object"===i&&null!==t?[void 0,this.options.cast.object(t,e)]:[void 0,t,t]}catch(t){return[t]}}}}(s,{stop:!1},{records:0});for(const e of t){const t=n.__transform(e,(function(t){i.push(t)}));if(void 0!==t)throw t}if(0===i.length){n.bom((t=>{i.push(t)}));const t=n.headers((t=>{i.push(t)}));if(void 0!==t)throw t}return i.join("")};
/*! js-yaml 4.1.0 https://github.com/nodeca/js-yaml @license MIT */
function T(t){return null==t}var O={isNothing:T,isObject:function(t){return"object"==typeof t&&null!==t},toArray:function(t){return Array.isArray(t)?t:T(t)?[]:[t]},repeat:function(t,e){var i,r="";for(i=0;i<e;i+=1)r+=t;return r},isNegativeZero:function(t){return 0===t&&Number.NEGATIVE_INFINITY===1/t},extend:function(t,e){var i,r,s,n;if(e)for(i=0,r=(n=Object.keys(e)).length;i<r;i+=1)t[s=n[i]]=e[s];return t}};function L(t,e){var i="",r=t.reason||"(unknown reason)";return t.mark?(t.mark.name&&(i+='in "'+t.mark.name+'" '),i+="("+(t.mark.line+1)+":"+(t.mark.column+1)+")",!e&&t.mark.snippet&&(i+="\n\n"+t.mark.snippet),r+" "+i):r}function M(t,e){Error.call(this),this.name="YAMLException",this.reason=t,this.mark=e,this.message=L(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack||""}M.prototype=Object.create(Error.prototype),M.prototype.constructor=M,M.prototype.toString=function(t){return this.name+": "+L(this,t)};var F=M;function D(t,e,i,r,s){var n="",o="",a=Math.floor(s/2)-1;return r-e>a&&(e=r-a+(n=" ... ").length),i-r>a&&(i=r+a-(o=" ...").length),{str:n+t.slice(e,i).replace(/\t/g,"→")+o,pos:r-e+n.length}}function B(t,e){return O.repeat(" ",e-t.length)+t}var U=function(t,e){if(e=Object.create(e||null),!t.buffer)return null;e.maxLength||(e.maxLength=79),"number"!=typeof e.indent&&(e.indent=1),"number"!=typeof e.linesBefore&&(e.linesBefore=3),"number"!=typeof e.linesAfter&&(e.linesAfter=2);for(var i,r=/\r?\n|\r|\0/g,s=[0],n=[],o=-1;i=r.exec(t.buffer);)n.push(i.index),s.push(i.index+i[0].length),t.position<=i.index&&o<0&&(o=s.length-2);o<0&&(o=s.length-1);var a,c,l="",h=Math.min(t.line+e.linesAfter,n.length).toString().length,u=e.maxLength-(e.indent+h+3);for(a=1;a<=e.linesBefore&&!(o-a<0);a++)c=D(t.buffer,s[o-a],n[o-a],t.position-(s[o]-s[o-a]),u),l=O.repeat(" ",e.indent)+B((t.line-a+1).toString(),h)+" | "+c.str+"\n"+l;for(c=D(t.buffer,s[o],n[o],t.position,u),l+=O.repeat(" ",e.indent)+B((t.line+1).toString(),h)+" | "+c.str+"\n",l+=O.repeat("-",e.indent+h+3+c.pos)+"^\n",a=1;a<=e.linesAfter&&!(o+a>=n.length);a++)c=D(t.buffer,s[o+a],n[o+a],t.position-(s[o]-s[o+a]),u),l+=O.repeat(" ",e.indent)+B((t.line+a+1).toString(),h)+" | "+c.str+"\n";return l.replace(/\n$/,"")},G=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],j=["scalar","sequence","mapping"];var $=function(t,e){if(e=e||{},Object.keys(e).forEach((function(e){if(-1===G.indexOf(e))throw new F('Unknown option "'+e+'" is met in definition of "'+t+'" YAML type.')})),this.options=e,this.tag=t,this.kind=e.kind||null,this.resolve=e.resolve||function(){return!0},this.construct=e.construct||function(t){return t},this.instanceOf=e.instanceOf||null,this.predicate=e.predicate||null,this.represent=e.represent||null,this.representName=e.representName||null,this.defaultStyle=e.defaultStyle||null,this.multi=e.multi||!1,this.styleAliases=function(t){var e={};return null!==t&&Object.keys(t).forEach((function(i){t[i].forEach((function(t){e[String(t)]=i}))})),e}(e.styleAliases||null),-1===j.indexOf(this.kind))throw new F('Unknown kind "'+this.kind+'" is specified for "'+t+'" YAML type.')};function P(t,e){var i=[];return t[e].forEach((function(t){var e=i.length;i.forEach((function(i,r){i.tag===t.tag&&i.kind===t.kind&&i.multi===t.multi&&(e=r)})),i[e]=t})),i}function q(t){return this.extend(t)}q.prototype.extend=function(t){var e=[],i=[];if(t instanceof $)i.push(t);else if(Array.isArray(t))i=i.concat(t);else{if(!t||!Array.isArray(t.implicit)&&!Array.isArray(t.explicit))throw new F("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");t.implicit&&(e=e.concat(t.implicit)),t.explicit&&(i=i.concat(t.explicit))}e.forEach((function(t){if(!(t instanceof $))throw new F("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(t.loadKind&&"scalar"!==t.loadKind)throw new F("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(t.multi)throw new F("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")})),i.forEach((function(t){if(!(t instanceof $))throw new F("Specified list of YAML types (or a single Type object) contains a non-Type object.")}));var r=Object.create(q.prototype);return r.implicit=(this.implicit||[]).concat(e),r.explicit=(this.explicit||[]).concat(i),r.compiledImplicit=P(r,"implicit"),r.compiledExplicit=P(r,"explicit"),r.compiledTypeMap=function(){var t,e,i={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}};function r(t){t.multi?(i.multi[t.kind].push(t),i.multi.fallback.push(t)):i[t.kind][t.tag]=i.fallback[t.tag]=t}for(t=0,e=arguments.length;t<e;t+=1)arguments[t].forEach(r);return i}(r.compiledImplicit,r.compiledExplicit),r};var z=q,W=new $("tag:yaml.org,2002:str",{kind:"scalar",construct:function(t){return null!==t?t:""}}),H=new $("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(t){return null!==t?t:[]}}),Y=new $("tag:yaml.org,2002:map",{kind:"mapping",construct:function(t){return null!==t?t:{}}}),J=new z({explicit:[W,H,Y]});var K=new $("tag:yaml.org,2002:null",{kind:"scalar",resolve:function(t){if(null===t)return!0;var e=t.length;return 1===e&&"~"===t||4===e&&("null"===t||"Null"===t||"NULL"===t)},construct:function(){return null},predicate:function(t){return null===t},represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});var V=new $("tag:yaml.org,2002:bool",{kind:"scalar",resolve:function(t){if(null===t)return!1;var e=t.length;return 4===e&&("true"===t||"True"===t||"TRUE"===t)||5===e&&("false"===t||"False"===t||"FALSE"===t)},construct:function(t){return"true"===t||"True"===t||"TRUE"===t},predicate:function(t){return"[object Boolean]"===Object.prototype.toString.call(t)},represent:{lowercase:function(t){return t?"true":"false"},uppercase:function(t){return t?"TRUE":"FALSE"},camelcase:function(t){return t?"True":"False"}},defaultStyle:"lowercase"});function X(t){return 48<=t&&t<=55}function Z(t){return 48<=t&&t<=57}var Q=new $("tag:yaml.org,2002:int",{kind:"scalar",resolve:function(t){if(null===t)return!1;var e,i,r=t.length,s=0,n=!1;if(!r)return!1;if("-"!==(e=t[s])&&"+"!==e||(e=t[++s]),"0"===e){if(s+1===r)return!0;if("b"===(e=t[++s])){for(s++;s<r;s++)if("_"!==(e=t[s])){if("0"!==e&&"1"!==e)return!1;n=!0}return n&&"_"!==e}if("x"===e){for(s++;s<r;s++)if("_"!==(e=t[s])){if(!(48<=(i=t.charCodeAt(s))&&i<=57||65<=i&&i<=70||97<=i&&i<=102))return!1;n=!0}return n&&"_"!==e}if("o"===e){for(s++;s<r;s++)if("_"!==(e=t[s])){if(!X(t.charCodeAt(s)))return!1;n=!0}return n&&"_"!==e}}if("_"===e)return!1;for(;s<r;s++)if("_"!==(e=t[s])){if(!Z(t.charCodeAt(s)))return!1;n=!0}return!(!n||"_"===e)},construct:function(t){var e,i=t,r=1;if(-1!==i.indexOf("_")&&(i=i.replace(/_/g,"")),"-"!==(e=i[0])&&"+"!==e||("-"===e&&(r=-1),e=(i=i.slice(1))[0]),"0"===i)return 0;if("0"===e){if("b"===i[1])return r*parseInt(i.slice(2),2);if("x"===i[1])return r*parseInt(i.slice(2),16);if("o"===i[1])return r*parseInt(i.slice(2),8)}return r*parseInt(i,10)},predicate:function(t){return"[object Number]"===Object.prototype.toString.call(t)&&t%1==0&&!O.isNegativeZero(t)},represent:{binary:function(t){return t>=0?"0b"+t.toString(2):"-0b"+t.toString(2).slice(1)},octal:function(t){return t>=0?"0o"+t.toString(8):"-0o"+t.toString(8).slice(1)},decimal:function(t){return t.toString(10)},hexadecimal:function(t){return t>=0?"0x"+t.toString(16).toUpperCase():"-0x"+t.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),tt=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");var et=/^[-+]?[0-9]+e/;var it=new $("tag:yaml.org,2002:float",{kind:"scalar",resolve:function(t){return null!==t&&!(!tt.test(t)||"_"===t[t.length-1])},construct:function(t){var e,i;return i="-"===(e=t.replace(/_/g,"").toLowerCase())[0]?-1:1,"+-".indexOf(e[0])>=0&&(e=e.slice(1)),".inf"===e?1===i?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:".nan"===e?NaN:i*parseFloat(e,10)},predicate:function(t){return"[object Number]"===Object.prototype.toString.call(t)&&(t%1!=0||O.isNegativeZero(t))},represent:function(t,e){var i;if(isNaN(t))switch(e){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===t)switch(e){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===t)switch(e){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(O.isNegativeZero(t))return"-0.0";return i=t.toString(10),et.test(i)?i.replace("e",".e"):i},defaultStyle:"lowercase"}),rt=J.extend({implicit:[K,V,Q,it]}),st=rt,nt=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),ot=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");var at=new $("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:function(t){return null!==t&&(null!==nt.exec(t)||null!==ot.exec(t))},construct:function(t){var e,i,r,s,n,o,a,c,l=0,h=null;if(null===(e=nt.exec(t))&&(e=ot.exec(t)),null===e)throw new Error("Date resolve error");if(i=+e[1],r=+e[2]-1,s=+e[3],!e[4])return new Date(Date.UTC(i,r,s));if(n=+e[4],o=+e[5],a=+e[6],e[7]){for(l=e[7].slice(0,3);l.length<3;)l+="0";l=+l}return e[9]&&(h=6e4*(60*+e[10]+ +(e[11]||0)),"-"===e[9]&&(h=-h)),c=new Date(Date.UTC(i,r,s,n,o,a,l)),h&&c.setTime(c.getTime()-h),c},instanceOf:Date,represent:function(t){return t.toISOString()}});var ct=new $("tag:yaml.org,2002:merge",{kind:"scalar",resolve:function(t){return"<<"===t||null===t}}),lt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r";var ht=new $("tag:yaml.org,2002:binary",{kind:"scalar",resolve:function(t){if(null===t)return!1;var e,i,r=0,s=t.length,n=lt;for(i=0;i<s;i++)if(!((e=n.indexOf(t.charAt(i)))>64)){if(e<0)return!1;r+=6}return r%8==0},construct:function(t){var e,i,r=t.replace(/[\r\n=]/g,""),s=r.length,n=lt,o=0,a=[];for(e=0;e<s;e++)e%4==0&&e&&(a.push(o>>16&255),a.push(o>>8&255),a.push(255&o)),o=o<<6|n.indexOf(r.charAt(e));return 0===(i=s%4*6)?(a.push(o>>16&255),a.push(o>>8&255),a.push(255&o)):18===i?(a.push(o>>10&255),a.push(o>>2&255)):12===i&&a.push(o>>4&255),new Uint8Array(a)},predicate:function(t){return"[object Uint8Array]"===Object.prototype.toString.call(t)},represent:function(t){var e,i,r="",s=0,n=t.length,o=lt;for(e=0;e<n;e++)e%3==0&&e&&(r+=o[s>>18&63],r+=o[s>>12&63],r+=o[s>>6&63],r+=o[63&s]),s=(s<<8)+t[e];return 0===(i=n%3)?(r+=o[s>>18&63],r+=o[s>>12&63],r+=o[s>>6&63],r+=o[63&s]):2===i?(r+=o[s>>10&63],r+=o[s>>4&63],r+=o[s<<2&63],r+=o[64]):1===i&&(r+=o[s>>2&63],r+=o[s<<4&63],r+=o[64],r+=o[64]),r}}),ut=Object.prototype.hasOwnProperty,dt=Object.prototype.toString;var pt=new $("tag:yaml.org,2002:omap",{kind:"sequence",resolve:function(t){if(null===t)return!0;var e,i,r,s,n,o=[],a=t;for(e=0,i=a.length;e<i;e+=1){if(r=a[e],n=!1,"[object Object]"!==dt.call(r))return!1;for(s in r)if(ut.call(r,s)){if(n)return!1;n=!0}if(!n)return!1;if(-1!==o.indexOf(s))return!1;o.push(s)}return!0},construct:function(t){return null!==t?t:[]}}),ft=Object.prototype.toString;var gt=new $("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:function(t){if(null===t)return!0;var e,i,r,s,n,o=t;for(n=new Array(o.length),e=0,i=o.length;e<i;e+=1){if(r=o[e],"[object Object]"!==ft.call(r))return!1;if(1!==(s=Object.keys(r)).length)return!1;n[e]=[s[0],r[s[0]]]}return!0},construct:function(t){if(null===t)return[];var e,i,r,s,n,o=t;for(n=new Array(o.length),e=0,i=o.length;e<i;e+=1)r=o[e],s=Object.keys(r),n[e]=[s[0],r[s[0]]];return n}}),mt=Object.prototype.hasOwnProperty;var yt=new $("tag:yaml.org,2002:set",{kind:"mapping",resolve:function(t){if(null===t)return!0;var e,i=t;for(e in i)if(mt.call(i,e)&&null!==i[e])return!1;return!0},construct:function(t){return null!==t?t:{}}}),vt=st.extend({implicit:[at,ct],explicit:[ht,pt,gt,yt]}),bt=Object.prototype.hasOwnProperty,wt=1,St=2,_t=3,kt=4,Et=1,At=2,Ct=3,Rt=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,xt=/[\x85\u2028\u2029]/,It=/[,\[\]\{\}]/,Nt=/^(?:!|!!|![a-z\-]+!)$/i,Tt=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function Ot(t){return Object.prototype.toString.call(t)}function Lt(t){return 10===t||13===t}function Mt(t){return 9===t||32===t}function Ft(t){return 9===t||32===t||10===t||13===t}function Dt(t){return 44===t||91===t||93===t||123===t||125===t}function Bt(t){var e;return 48<=t&&t<=57?t-48:97<=(e=32|t)&&e<=102?e-97+10:-1}function Ut(t){return 48===t?"\0":97===t?"":98===t?"\b":116===t||9===t?"\t":110===t?"\n":118===t?"\v":102===t?"\f":114===t?"\r":101===t?"":32===t?" ":34===t?'"':47===t?"/":92===t?"\\":78===t?"":95===t?" ":76===t?"\u2028":80===t?"\u2029":""}function Gt(t){return t<=65535?String.fromCharCode(t):String.fromCharCode(55296+(t-65536>>10),56320+(t-65536&1023))}for(var jt=new Array(256),$t=new Array(256),Pt=0;Pt<256;Pt++)jt[Pt]=Ut(Pt)?1:0,$t[Pt]=Ut(Pt);function qt(t,e){this.input=t,this.filename=e.filename||null,this.schema=e.schema||vt,this.onWarning=e.onWarning||null,this.legacy=e.legacy||!1,this.json=e.json||!1,this.listener=e.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=t.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function zt(t,e){var i={name:t.filename,buffer:t.input.slice(0,-1),position:t.position,line:t.line,column:t.position-t.lineStart};return i.snippet=U(i),new F(e,i)}function Wt(t,e){throw zt(t,e)}function Ht(t,e){t.onWarning&&t.onWarning.call(null,zt(t,e))}var Yt={YAML:function(t,e,i){var r,s,n;null!==t.version&&Wt(t,"duplication of %YAML directive"),1!==i.length&&Wt(t,"YAML directive accepts exactly one argument"),null===(r=/^([0-9]+)\.([0-9]+)$/.exec(i[0]))&&Wt(t,"ill-formed argument of the YAML directive"),s=parseInt(r[1],10),n=parseInt(r[2],10),1!==s&&Wt(t,"unacceptable YAML version of the document"),t.version=i[0],t.checkLineBreaks=n<2,1!==n&&2!==n&&Ht(t,"unsupported YAML version of the document")},TAG:function(t,e,i){var r,s;2!==i.length&&Wt(t,"TAG directive accepts exactly two arguments"),r=i[0],s=i[1],Nt.test(r)||Wt(t,"ill-formed tag handle (first argument) of the TAG directive"),bt.call(t.tagMap,r)&&Wt(t,'there is a previously declared suffix for "'+r+'" tag handle'),Tt.test(s)||Wt(t,"ill-formed tag prefix (second argument) of the TAG directive");try{s=decodeURIComponent(s)}catch(e){Wt(t,"tag prefix is malformed: "+s)}t.tagMap[r]=s}};function Jt(t,e,i,r){var s,n,o,a;if(e<i){if(a=t.input.slice(e,i),r)for(s=0,n=a.length;s<n;s+=1)9===(o=a.charCodeAt(s))||32<=o&&o<=1114111||Wt(t,"expected valid JSON character");else Rt.test(a)&&Wt(t,"the stream contains non-printable characters");t.result+=a}}function Kt(t,e,i,r){var s,n,o,a;for(O.isObject(i)||Wt(t,"cannot merge mappings; the provided source object is unacceptable"),o=0,a=(s=Object.keys(i)).length;o<a;o+=1)n=s[o],bt.call(e,n)||(e[n]=i[n],r[n]=!0)}function Vt(t,e,i,r,s,n,o,a,c){var l,h;if(Array.isArray(s))for(l=0,h=(s=Array.prototype.slice.call(s)).length;l<h;l+=1)Array.isArray(s[l])&&Wt(t,"nested arrays are not supported inside keys"),"object"==typeof s&&"[object Object]"===Ot(s[l])&&(s[l]="[object Object]");if("object"==typeof s&&"[object Object]"===Ot(s)&&(s="[object Object]"),s=String(s),null===e&&(e={}),"tag:yaml.org,2002:merge"===r)if(Array.isArray(n))for(l=0,h=n.length;l<h;l+=1)Kt(t,e,n[l],i);else Kt(t,e,n,i);else t.json||bt.call(i,s)||!bt.call(e,s)||(t.line=o||t.line,t.lineStart=a||t.lineStart,t.position=c||t.position,Wt(t,"duplicated mapping key")),"__proto__"===s?Object.defineProperty(e,s,{configurable:!0,enumerable:!0,writable:!0,value:n}):e[s]=n,delete i[s];return e}function Xt(t){var e;10===(e=t.input.charCodeAt(t.position))?t.position++:13===e?(t.position++,10===t.input.charCodeAt(t.position)&&t.position++):Wt(t,"a line break is expected"),t.line+=1,t.lineStart=t.position,t.firstTabInLine=-1}function Zt(t,e,i){for(var r=0,s=t.input.charCodeAt(t.position);0!==s;){for(;Mt(s);)9===s&&-1===t.firstTabInLine&&(t.firstTabInLine=t.position),s=t.input.charCodeAt(++t.position);if(e&&35===s)do{s=t.input.charCodeAt(++t.position)}while(10!==s&&13!==s&&0!==s);if(!Lt(s))break;for(Xt(t),s=t.input.charCodeAt(t.position),r++,t.lineIndent=0;32===s;)t.lineIndent++,s=t.input.charCodeAt(++t.position)}return-1!==i&&0!==r&&t.lineIndent<i&&Ht(t,"deficient indentation"),r}function Qt(t){var e,i=t.position;return!(45!==(e=t.input.charCodeAt(i))&&46!==e||e!==t.input.charCodeAt(i+1)||e!==t.input.charCodeAt(i+2)||(i+=3,0!==(e=t.input.charCodeAt(i))&&!Ft(e)))}function te(t,e){1===e?t.result+=" ":e>1&&(t.result+=O.repeat("\n",e-1))}function ee(t,e){var i,r,s=t.tag,n=t.anchor,o=[],a=!1;if(-1!==t.firstTabInLine)return!1;for(null!==t.anchor&&(t.anchorMap[t.anchor]=o),r=t.input.charCodeAt(t.position);0!==r&&(-1!==t.firstTabInLine&&(t.position=t.firstTabInLine,Wt(t,"tab characters must not be used in indentation")),45===r)&&Ft(t.input.charCodeAt(t.position+1));)if(a=!0,t.position++,Zt(t,!0,-1)&&t.lineIndent<=e)o.push(null),r=t.input.charCodeAt(t.position);else if(i=t.line,se(t,e,_t,!1,!0),o.push(t.result),Zt(t,!0,-1),r=t.input.charCodeAt(t.position),(t.line===i||t.lineIndent>e)&&0!==r)Wt(t,"bad indentation of a sequence entry");else if(t.lineIndent<e)break;return!!a&&(t.tag=s,t.anchor=n,t.kind="sequence",t.result=o,!0)}function ie(t){var e,i,r,s,n=!1,o=!1;if(33!==(s=t.input.charCodeAt(t.position)))return!1;if(null!==t.tag&&Wt(t,"duplication of a tag property"),60===(s=t.input.charCodeAt(++t.position))?(n=!0,s=t.input.charCodeAt(++t.position)):33===s?(o=!0,i="!!",s=t.input.charCodeAt(++t.position)):i="!",e=t.position,n){do{s=t.input.charCodeAt(++t.position)}while(0!==s&&62!==s);t.position<t.length?(r=t.input.slice(e,t.position),s=t.input.charCodeAt(++t.position)):Wt(t,"unexpected end of the stream within a verbatim tag")}else{for(;0!==s&&!Ft(s);)33===s&&(o?Wt(t,"tag suffix cannot contain exclamation marks"):(i=t.input.slice(e-1,t.position+1),Nt.test(i)||Wt(t,"named tag handle cannot contain such characters"),o=!0,e=t.position+1)),s=t.input.charCodeAt(++t.position);r=t.input.slice(e,t.position),It.test(r)&&Wt(t,"tag suffix cannot contain flow indicator characters")}r&&!Tt.test(r)&&Wt(t,"tag name cannot contain such characters: "+r);try{r=decodeURIComponent(r)}catch(e){Wt(t,"tag name is malformed: "+r)}return n?t.tag=r:bt.call(t.tagMap,i)?t.tag=t.tagMap[i]+r:"!"===i?t.tag="!"+r:"!!"===i?t.tag="tag:yaml.org,2002:"+r:Wt(t,'undeclared tag handle "'+i+'"'),!0}function re(t){var e,i;if(38!==(i=t.input.charCodeAt(t.position)))return!1;for(null!==t.anchor&&Wt(t,"duplication of an anchor property"),i=t.input.charCodeAt(++t.position),e=t.position;0!==i&&!Ft(i)&&!Dt(i);)i=t.input.charCodeAt(++t.position);return t.position===e&&Wt(t,"name of an anchor node must contain at least one character"),t.anchor=t.input.slice(e,t.position),!0}function se(t,e,i,r,s){var n,o,a,c,l,h,u,d,p,f=1,g=!1,m=!1;if(null!==t.listener&&t.listener("open",t),t.tag=null,t.anchor=null,t.kind=null,t.result=null,n=o=a=kt===i||_t===i,r&&Zt(t,!0,-1)&&(g=!0,t.lineIndent>e?f=1:t.lineIndent===e?f=0:t.lineIndent<e&&(f=-1)),1===f)for(;ie(t)||re(t);)Zt(t,!0,-1)?(g=!0,a=n,t.lineIndent>e?f=1:t.lineIndent===e?f=0:t.lineIndent<e&&(f=-1)):a=!1;if(a&&(a=g||s),1!==f&&kt!==i||(d=wt===i||St===i?e:e+1,p=t.position-t.lineStart,1===f?a&&(ee(t,p)||function(t,e,i){var r,s,n,o,a,c,l,h=t.tag,u=t.anchor,d={},p=Object.create(null),f=null,g=null,m=null,y=!1,v=!1;if(-1!==t.firstTabInLine)return!1;for(null!==t.anchor&&(t.anchorMap[t.anchor]=d),l=t.input.charCodeAt(t.position);0!==l;){if(y||-1===t.firstTabInLine||(t.position=t.firstTabInLine,Wt(t,"tab characters must not be used in indentation")),r=t.input.charCodeAt(t.position+1),n=t.line,63!==l&&58!==l||!Ft(r)){if(o=t.line,a=t.lineStart,c=t.position,!se(t,i,St,!1,!0))break;if(t.line===n){for(l=t.input.charCodeAt(t.position);Mt(l);)l=t.input.charCodeAt(++t.position);if(58===l)Ft(l=t.input.charCodeAt(++t.position))||Wt(t,"a whitespace character is expected after the key-value separator within a block mapping"),y&&(Vt(t,d,p,f,g,null,o,a,c),f=g=m=null),v=!0,y=!1,s=!1,f=t.tag,g=t.result;else{if(!v)return t.tag=h,t.anchor=u,!0;Wt(t,"can not read an implicit mapping pair; a colon is missed")}}else{if(!v)return t.tag=h,t.anchor=u,!0;Wt(t,"can not read a block mapping entry; a multiline key may not be an implicit key")}}else 63===l?(y&&(Vt(t,d,p,f,g,null,o,a,c),f=g=m=null),v=!0,y=!0,s=!0):y?(y=!1,s=!0):Wt(t,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),t.position+=1,l=r;if((t.line===n||t.lineIndent>e)&&(y&&(o=t.line,a=t.lineStart,c=t.position),se(t,e,kt,!0,s)&&(y?g=t.result:m=t.result),y||(Vt(t,d,p,f,g,m,o,a,c),f=g=m=null),Zt(t,!0,-1),l=t.input.charCodeAt(t.position)),(t.line===n||t.lineIndent>e)&&0!==l)Wt(t,"bad indentation of a mapping entry");else if(t.lineIndent<e)break}return y&&Vt(t,d,p,f,g,null,o,a,c),v&&(t.tag=h,t.anchor=u,t.kind="mapping",t.result=d),v}(t,p,d))||function(t,e){var i,r,s,n,o,a,c,l,h,u,d,p,f=!0,g=t.tag,m=t.anchor,y=Object.create(null);if(91===(p=t.input.charCodeAt(t.position)))o=93,l=!1,n=[];else{if(123!==p)return!1;o=125,l=!0,n={}}for(null!==t.anchor&&(t.anchorMap[t.anchor]=n),p=t.input.charCodeAt(++t.position);0!==p;){if(Zt(t,!0,e),(p=t.input.charCodeAt(t.position))===o)return t.position++,t.tag=g,t.anchor=m,t.kind=l?"mapping":"sequence",t.result=n,!0;f?44===p&&Wt(t,"expected the node content, but found ','"):Wt(t,"missed comma between flow collection entries"),d=null,a=c=!1,63===p&&Ft(t.input.charCodeAt(t.position+1))&&(a=c=!0,t.position++,Zt(t,!0,e)),i=t.line,r=t.lineStart,s=t.position,se(t,e,wt,!1,!0),u=t.tag,h=t.result,Zt(t,!0,e),p=t.input.charCodeAt(t.position),!c&&t.line!==i||58!==p||(a=!0,p=t.input.charCodeAt(++t.position),Zt(t,!0,e),se(t,e,wt,!1,!0),d=t.result),l?Vt(t,n,y,u,h,d,i,r,s):a?n.push(Vt(t,null,y,u,h,d,i,r,s)):n.push(h),Zt(t,!0,e),44===(p=t.input.charCodeAt(t.position))?(f=!0,p=t.input.charCodeAt(++t.position)):f=!1}Wt(t,"unexpected end of the stream within a flow collection")}(t,d)?m=!0:(o&&function(t,e){var i,r,s,n,o,a=Et,c=!1,l=!1,h=e,u=0,d=!1;if(124===(n=t.input.charCodeAt(t.position)))r=!1;else{if(62!==n)return!1;r=!0}for(t.kind="scalar",t.result="";0!==n;)if(43===(n=t.input.charCodeAt(++t.position))||45===n)Et===a?a=43===n?Ct:At:Wt(t,"repeat of a chomping mode identifier");else{if(!((s=48<=(o=n)&&o<=57?o-48:-1)>=0))break;0===s?Wt(t,"bad explicit indentation width of a block scalar; it cannot be less than one"):l?Wt(t,"repeat of an indentation width identifier"):(h=e+s-1,l=!0)}if(Mt(n)){do{n=t.input.charCodeAt(++t.position)}while(Mt(n));if(35===n)do{n=t.input.charCodeAt(++t.position)}while(!Lt(n)&&0!==n)}for(;0!==n;){for(Xt(t),t.lineIndent=0,n=t.input.charCodeAt(t.position);(!l||t.lineIndent<h)&&32===n;)t.lineIndent++,n=t.input.charCodeAt(++t.position);if(!l&&t.lineIndent>h&&(h=t.lineIndent),Lt(n))u++;else{if(t.lineIndent<h){a===Ct?t.result+=O.repeat("\n",c?1+u:u):a===Et&&c&&(t.result+="\n");break}for(r?Mt(n)?(d=!0,t.result+=O.repeat("\n",c?1+u:u)):d?(d=!1,t.result+=O.repeat("\n",u+1)):0===u?c&&(t.result+=" "):t.result+=O.repeat("\n",u):t.result+=O.repeat("\n",c?1+u:u),c=!0,l=!0,u=0,i=t.position;!Lt(n)&&0!==n;)n=t.input.charCodeAt(++t.position);Jt(t,i,t.position,!1)}}return!0}(t,d)||function(t,e){var i,r,s;if(39!==(i=t.input.charCodeAt(t.position)))return!1;for(t.kind="scalar",t.result="",t.position++,r=s=t.position;0!==(i=t.input.charCodeAt(t.position));)if(39===i){if(Jt(t,r,t.position,!0),39!==(i=t.input.charCodeAt(++t.position)))return!0;r=t.position,t.position++,s=t.position}else Lt(i)?(Jt(t,r,s,!0),te(t,Zt(t,!1,e)),r=s=t.position):t.position===t.lineStart&&Qt(t)?Wt(t,"unexpected end of the document within a single quoted scalar"):(t.position++,s=t.position);Wt(t,"unexpected end of the stream within a single quoted scalar")}(t,d)||function(t,e){var i,r,s,n,o,a,c;if(34!==(a=t.input.charCodeAt(t.position)))return!1;for(t.kind="scalar",t.result="",t.position++,i=r=t.position;0!==(a=t.input.charCodeAt(t.position));){if(34===a)return Jt(t,i,t.position,!0),t.position++,!0;if(92===a){if(Jt(t,i,t.position,!0),Lt(a=t.input.charCodeAt(++t.position)))Zt(t,!1,e);else if(a<256&&jt[a])t.result+=$t[a],t.position++;else if((o=120===(c=a)?2:117===c?4:85===c?8:0)>0){for(s=o,n=0;s>0;s--)(o=Bt(a=t.input.charCodeAt(++t.position)))>=0?n=(n<<4)+o:Wt(t,"expected hexadecimal character");t.result+=Gt(n),t.position++}else Wt(t,"unknown escape sequence");i=r=t.position}else Lt(a)?(Jt(t,i,r,!0),te(t,Zt(t,!1,e)),i=r=t.position):t.position===t.lineStart&&Qt(t)?Wt(t,"unexpected end of the document within a double quoted scalar"):(t.position++,r=t.position)}Wt(t,"unexpected end of the stream within a double quoted scalar")}(t,d)?m=!0:!function(t){var e,i,r;if(42!==(r=t.input.charCodeAt(t.position)))return!1;for(r=t.input.charCodeAt(++t.position),e=t.position;0!==r&&!Ft(r)&&!Dt(r);)r=t.input.charCodeAt(++t.position);return t.position===e&&Wt(t,"name of an alias node must contain at least one character"),i=t.input.slice(e,t.position),bt.call(t.anchorMap,i)||Wt(t,'unidentified alias "'+i+'"'),t.result=t.anchorMap[i],Zt(t,!0,-1),!0}(t)?function(t,e,i){var r,s,n,o,a,c,l,h,u=t.kind,d=t.result;if(Ft(h=t.input.charCodeAt(t.position))||Dt(h)||35===h||38===h||42===h||33===h||124===h||62===h||39===h||34===h||37===h||64===h||96===h)return!1;if((63===h||45===h)&&(Ft(r=t.input.charCodeAt(t.position+1))||i&&Dt(r)))return!1;for(t.kind="scalar",t.result="",s=n=t.position,o=!1;0!==h;){if(58===h){if(Ft(r=t.input.charCodeAt(t.position+1))||i&&Dt(r))break}else if(35===h){if(Ft(t.input.charCodeAt(t.position-1)))break}else{if(t.position===t.lineStart&&Qt(t)||i&&Dt(h))break;if(Lt(h)){if(a=t.line,c=t.lineStart,l=t.lineIndent,Zt(t,!1,-1),t.lineIndent>=e){o=!0,h=t.input.charCodeAt(t.position);continue}t.position=n,t.line=a,t.lineStart=c,t.lineIndent=l;break}}o&&(Jt(t,s,n,!1),te(t,t.line-a),s=n=t.position,o=!1),Mt(h)||(n=t.position+1),h=t.input.charCodeAt(++t.position)}return Jt(t,s,n,!1),!!t.result||(t.kind=u,t.result=d,!1)}(t,d,wt===i)&&(m=!0,null===t.tag&&(t.tag="?")):(m=!0,null===t.tag&&null===t.anchor||Wt(t,"alias node should not have any properties")),null!==t.anchor&&(t.anchorMap[t.anchor]=t.result)):0===f&&(m=a&&ee(t,p))),null===t.tag)null!==t.anchor&&(t.anchorMap[t.anchor]=t.result);else if("?"===t.tag){for(null!==t.result&&"scalar"!==t.kind&&Wt(t,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+t.kind+'"'),c=0,l=t.implicitTypes.length;c<l;c+=1)if((u=t.implicitTypes[c]).resolve(t.result)){t.result=u.construct(t.result),t.tag=u.tag,null!==t.anchor&&(t.anchorMap[t.anchor]=t.result);break}}else if("!"!==t.tag){if(bt.call(t.typeMap[t.kind||"fallback"],t.tag))u=t.typeMap[t.kind||"fallback"][t.tag];else for(u=null,c=0,l=(h=t.typeMap.multi[t.kind||"fallback"]).length;c<l;c+=1)if(t.tag.slice(0,h[c].tag.length)===h[c].tag){u=h[c];break}u||Wt(t,"unknown tag !<"+t.tag+">"),null!==t.result&&u.kind!==t.kind&&Wt(t,"unacceptable node kind for !<"+t.tag+'> tag; it should be "'+u.kind+'", not "'+t.kind+'"'),u.resolve(t.result,t.tag)?(t.result=u.construct(t.result,t.tag),null!==t.anchor&&(t.anchorMap[t.anchor]=t.result)):Wt(t,"cannot resolve a node with !<"+t.tag+"> explicit tag")}return null!==t.listener&&t.listener("close",t),null!==t.tag||null!==t.anchor||m}function ne(t){var e,i,r,s,n=t.position,o=!1;for(t.version=null,t.checkLineBreaks=t.legacy,t.tagMap=Object.create(null),t.anchorMap=Object.create(null);0!==(s=t.input.charCodeAt(t.position))&&(Zt(t,!0,-1),s=t.input.charCodeAt(t.position),!(t.lineIndent>0||37!==s));){for(o=!0,s=t.input.charCodeAt(++t.position),e=t.position;0!==s&&!Ft(s);)s=t.input.charCodeAt(++t.position);for(r=[],(i=t.input.slice(e,t.position)).length<1&&Wt(t,"directive name must not be less than one character in length");0!==s;){for(;Mt(s);)s=t.input.charCodeAt(++t.position);if(35===s){do{s=t.input.charCodeAt(++t.position)}while(0!==s&&!Lt(s));break}if(Lt(s))break;for(e=t.position;0!==s&&!Ft(s);)s=t.input.charCodeAt(++t.position);r.push(t.input.slice(e,t.position))}0!==s&&Xt(t),bt.call(Yt,i)?Yt[i](t,i,r):Ht(t,'unknown document directive "'+i+'"')}Zt(t,!0,-1),0===t.lineIndent&&45===t.input.charCodeAt(t.position)&&45===t.input.charCodeAt(t.position+1)&&45===t.input.charCodeAt(t.position+2)?(t.position+=3,Zt(t,!0,-1)):o&&Wt(t,"directives end mark is expected"),se(t,t.lineIndent-1,kt,!1,!0),Zt(t,!0,-1),t.checkLineBreaks&&xt.test(t.input.slice(n,t.position))&&Ht(t,"non-ASCII line breaks are interpreted as content"),t.documents.push(t.result),t.position===t.lineStart&&Qt(t)?46===t.input.charCodeAt(t.position)&&(t.position+=3,Zt(t,!0,-1)):t.position<t.length-1&&Wt(t,"end of the stream or a document separator is expected")}function oe(t,e){e=e||{},0!==(t=String(t)).length&&(10!==t.charCodeAt(t.length-1)&&13!==t.charCodeAt(t.length-1)&&(t+="\n"),65279===t.charCodeAt(0)&&(t=t.slice(1)));var i=new qt(t,e),r=t.indexOf("\0");for(-1!==r&&(i.position=r,Wt(i,"null byte is not allowed in input")),i.input+="\0";32===i.input.charCodeAt(i.position);)i.lineIndent+=1,i.position+=1;for(;i.position<i.length-1;)ne(i);return i.documents}var ae={loadAll:function(t,e,i){null!==e&&"object"==typeof e&&void 0===i&&(i=e,e=null);var r=oe(t,i);if("function"!=typeof e)return r;for(var s=0,n=r.length;s<n;s+=1)e(r[s])},load:function(t,e){var i=oe(t,e);if(0!==i.length){if(1===i.length)return i[0];throw new F("expected a single document in the stream, but found more")}}},ce=Object.prototype.toString,le=Object.prototype.hasOwnProperty,he=65279,ue=9,de=10,pe=13,fe=32,ge=33,me=34,ye=35,ve=37,be=38,we=39,Se=42,_e=44,ke=45,Ee=58,Ae=61,Ce=62,Re=63,xe=64,Ie=91,Ne=93,Te=96,Oe=123,Le=124,Me=125,Fe={0:"\\0",7:"\\a",8:"\\b",9:"\\t",10:"\\n",11:"\\v",12:"\\f",13:"\\r",27:"\\e",34:'\\"',92:"\\\\",133:"\\N",160:"\\_",8232:"\\L",8233:"\\P"},De=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],Be=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function Ue(t){var e,i,r;if(e=t.toString(16).toUpperCase(),t<=255)i="x",r=2;else if(t<=65535)i="u",r=4;else{if(!(t<=4294967295))throw new F("code point within a string may not be greater than 0xFFFFFFFF");i="U",r=8}return"\\"+i+O.repeat("0",r-e.length)+e}var Ge=1,je=2;function $e(t){this.schema=t.schema||vt,this.indent=Math.max(1,t.indent||2),this.noArrayIndent=t.noArrayIndent||!1,this.skipInvalid=t.skipInvalid||!1,this.flowLevel=O.isNothing(t.flowLevel)?-1:t.flowLevel,this.styleMap=function(t,e){var i,r,s,n,o,a,c;if(null===e)return{};for(i={},s=0,n=(r=Object.keys(e)).length;s<n;s+=1)o=r[s],a=String(e[o]),"!!"===o.slice(0,2)&&(o="tag:yaml.org,2002:"+o.slice(2)),(c=t.compiledTypeMap.fallback[o])&&le.call(c.styleAliases,a)&&(a=c.styleAliases[a]),i[o]=a;return i}(this.schema,t.styles||null),this.sortKeys=t.sortKeys||!1,this.lineWidth=t.lineWidth||80,this.noRefs=t.noRefs||!1,this.noCompatMode=t.noCompatMode||!1,this.condenseFlow=t.condenseFlow||!1,this.quotingType='"'===t.quotingType?je:Ge,this.forceQuotes=t.forceQuotes||!1,this.replacer="function"==typeof t.replacer?t.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function Pe(t,e){for(var i,r=O.repeat(" ",e),s=0,n=-1,o="",a=t.length;s<a;)-1===(n=t.indexOf("\n",s))?(i=t.slice(s),s=a):(i=t.slice(s,n+1),s=n+1),i.length&&"\n"!==i&&(o+=r),o+=i;return o}function qe(t,e){return"\n"+O.repeat(" ",t.indent*e)}function ze(t){return t===fe||t===ue}function We(t){return 32<=t&&t<=126||161<=t&&t<=55295&&8232!==t&&8233!==t||57344<=t&&t<=65533&&t!==he||65536<=t&&t<=1114111}function He(t){return We(t)&&t!==he&&t!==pe&&t!==de}function Ye(t,e,i){var r=He(t),s=r&&!ze(t);return(i?r:r&&t!==_e&&t!==Ie&&t!==Ne&&t!==Oe&&t!==Me)&&t!==ye&&!(e===Ee&&!s)||He(e)&&!ze(e)&&t===ye||e===Ee&&s}function Je(t,e){var i,r=t.charCodeAt(e);return r>=55296&&r<=56319&&e+1<t.length&&(i=t.charCodeAt(e+1))>=56320&&i<=57343?1024*(r-55296)+i-56320+65536:r}function Ke(t){return/^\n* /.test(t)}var Ve=1,Xe=2,Ze=3,Qe=4,ti=5;function ei(t,e,i,r,s,n,o,a){var c,l,h=0,u=null,d=!1,p=!1,f=-1!==r,g=-1,m=We(l=Je(t,0))&&l!==he&&!ze(l)&&l!==ke&&l!==Re&&l!==Ee&&l!==_e&&l!==Ie&&l!==Ne&&l!==Oe&&l!==Me&&l!==ye&&l!==be&&l!==Se&&l!==ge&&l!==Le&&l!==Ae&&l!==Ce&&l!==we&&l!==me&&l!==ve&&l!==xe&&l!==Te&&function(t){return!ze(t)&&t!==Ee}(Je(t,t.length-1));if(e||o)for(c=0;c<t.length;h>=65536?c+=2:c++){if(!We(h=Je(t,c)))return ti;m=m&&Ye(h,u,a),u=h}else{for(c=0;c<t.length;h>=65536?c+=2:c++){if((h=Je(t,c))===de)d=!0,f&&(p=p||c-g-1>r&&" "!==t[g+1],g=c);else if(!We(h))return ti;m=m&&Ye(h,u,a),u=h}p=p||f&&c-g-1>r&&" "!==t[g+1]}return d||p?i>9&&Ke(t)?ti:o?n===je?ti:Xe:p?Qe:Ze:!m||o||s(t)?n===je?ti:Xe:Ve}function ii(t,e,i,r,s){t.dump=function(){if(0===e.length)return t.quotingType===je?'""':"''";if(!t.noCompatMode&&(-1!==De.indexOf(e)||Be.test(e)))return t.quotingType===je?'"'+e+'"':"'"+e+"'";var n=t.indent*Math.max(1,i),o=-1===t.lineWidth?-1:Math.max(Math.min(t.lineWidth,40),t.lineWidth-n),a=r||t.flowLevel>-1&&i>=t.flowLevel;switch(ei(e,a,t.indent,o,(function(e){return function(t,e){var i,r;for(i=0,r=t.implicitTypes.length;i<r;i+=1)if(t.implicitTypes[i].resolve(e))return!0;return!1}(t,e)}),t.quotingType,t.forceQuotes&&!r,s)){case Ve:return e;case Xe:return"'"+e.replace(/'/g,"''")+"'";case Ze:return"|"+ri(e,t.indent)+si(Pe(e,n));case Qe:return">"+ri(e,t.indent)+si(Pe(function(t,e){var i,r,s=/(\n+)([^\n]*)/g,n=(a=t.indexOf("\n"),a=-1!==a?a:t.length,s.lastIndex=a,ni(t.slice(0,a),e)),o="\n"===t[0]||" "===t[0];var a;for(;r=s.exec(t);){var c=r[1],l=r[2];i=" "===l[0],n+=c+(o||i||""===l?"":"\n")+ni(l,e),o=i}return n}(e,o),n));case ti:return'"'+function(t){for(var e,i="",r=0,s=0;s<t.length;r>=65536?s+=2:s++)r=Je(t,s),!(e=Fe[r])&&We(r)?(i+=t[s],r>=65536&&(i+=t[s+1])):i+=e||Ue(r);return i}(e)+'"';default:throw new F("impossible error: invalid scalar style")}}()}function ri(t,e){var i=Ke(t)?String(e):"",r="\n"===t[t.length-1];return i+(r&&("\n"===t[t.length-2]||"\n"===t)?"+":r?"":"-")+"\n"}function si(t){return"\n"===t[t.length-1]?t.slice(0,-1):t}function ni(t,e){if(""===t||" "===t[0])return t;for(var i,r,s=/ [^ ]/g,n=0,o=0,a=0,c="";i=s.exec(t);)(a=i.index)-n>e&&(r=o>n?o:a,c+="\n"+t.slice(n,r),n=r+1),o=a;return c+="\n",t.length-n>e&&o>n?c+=t.slice(n,o)+"\n"+t.slice(o+1):c+=t.slice(n),c.slice(1)}function oi(t,e,i,r){var s,n,o,a="",c=t.tag;for(s=0,n=i.length;s<n;s+=1)o=i[s],t.replacer&&(o=t.replacer.call(i,String(s),o)),(ci(t,e+1,o,!0,!0,!1,!0)||void 0===o&&ci(t,e+1,null,!0,!0,!1,!0))&&(r&&""===a||(a+=qe(t,e)),t.dump&&de===t.dump.charCodeAt(0)?a+="-":a+="- ",a+=t.dump);t.tag=c,t.dump=a||"[]"}function ai(t,e,i){var r,s,n,o,a,c;for(n=0,o=(s=i?t.explicitTypes:t.implicitTypes).length;n<o;n+=1)if(((a=s[n]).instanceOf||a.predicate)&&(!a.instanceOf||"object"==typeof e&&e instanceof a.instanceOf)&&(!a.predicate||a.predicate(e))){if(i?a.multi&&a.representName?t.tag=a.representName(e):t.tag=a.tag:t.tag="?",a.represent){if(c=t.styleMap[a.tag]||a.defaultStyle,"[object Function]"===ce.call(a.represent))r=a.represent(e,c);else{if(!le.call(a.represent,c))throw new F("!<"+a.tag+'> tag resolver accepts not "'+c+'" style');r=a.represent[c](e,c)}t.dump=r}return!0}return!1}function ci(t,e,i,r,s,n,o){t.tag=null,t.dump=i,ai(t,i,!1)||ai(t,i,!0);var a,c=ce.call(t.dump),l=r;r&&(r=t.flowLevel<0||t.flowLevel>e);var h,u,d="[object Object]"===c||"[object Array]"===c;if(d&&(u=-1!==(h=t.duplicates.indexOf(i))),(null!==t.tag&&"?"!==t.tag||u||2!==t.indent&&e>0)&&(s=!1),u&&t.usedDuplicates[h])t.dump="*ref_"+h;else{if(d&&u&&!t.usedDuplicates[h]&&(t.usedDuplicates[h]=!0),"[object Object]"===c)r&&0!==Object.keys(t.dump).length?(!function(t,e,i,r){var s,n,o,a,c,l,h="",u=t.tag,d=Object.keys(i);if(!0===t.sortKeys)d.sort();else if("function"==typeof t.sortKeys)d.sort(t.sortKeys);else if(t.sortKeys)throw new F("sortKeys must be a boolean or a function");for(s=0,n=d.length;s<n;s+=1)l="",r&&""===h||(l+=qe(t,e)),a=i[o=d[s]],t.replacer&&(a=t.replacer.call(i,o,a)),ci(t,e+1,o,!0,!0,!0)&&((c=null!==t.tag&&"?"!==t.tag||t.dump&&t.dump.length>1024)&&(t.dump&&de===t.dump.charCodeAt(0)?l+="?":l+="? "),l+=t.dump,c&&(l+=qe(t,e)),ci(t,e+1,a,!0,c)&&(t.dump&&de===t.dump.charCodeAt(0)?l+=":":l+=": ",h+=l+=t.dump));t.tag=u,t.dump=h||"{}"}(t,e,t.dump,s),u&&(t.dump="&ref_"+h+t.dump)):(!function(t,e,i){var r,s,n,o,a,c="",l=t.tag,h=Object.keys(i);for(r=0,s=h.length;r<s;r+=1)a="",""!==c&&(a+=", "),t.condenseFlow&&(a+='"'),o=i[n=h[r]],t.replacer&&(o=t.replacer.call(i,n,o)),ci(t,e,n,!1,!1)&&(t.dump.length>1024&&(a+="? "),a+=t.dump+(t.condenseFlow?'"':"")+":"+(t.condenseFlow?"":" "),ci(t,e,o,!1,!1)&&(c+=a+=t.dump));t.tag=l,t.dump="{"+c+"}"}(t,e,t.dump),u&&(t.dump="&ref_"+h+" "+t.dump));else if("[object Array]"===c)r&&0!==t.dump.length?(t.noArrayIndent&&!o&&e>0?oi(t,e-1,t.dump,s):oi(t,e,t.dump,s),u&&(t.dump="&ref_"+h+t.dump)):(!function(t,e,i){var r,s,n,o="",a=t.tag;for(r=0,s=i.length;r<s;r+=1)n=i[r],t.replacer&&(n=t.replacer.call(i,String(r),n)),(ci(t,e,n,!1,!1)||void 0===n&&ci(t,e,null,!1,!1))&&(""!==o&&(o+=","+(t.condenseFlow?"":" ")),o+=t.dump);t.tag=a,t.dump="["+o+"]"}(t,e,t.dump),u&&(t.dump="&ref_"+h+" "+t.dump));else{if("[object String]"!==c){if("[object Undefined]"===c)return!1;if(t.skipInvalid)return!1;throw new F("unacceptable kind of an object to dump "+c)}"?"!==t.tag&&ii(t,t.dump,e,n,l)}null!==t.tag&&"?"!==t.tag&&(a=encodeURI("!"===t.tag[0]?t.tag.slice(1):t.tag).replace(/!/g,"%21"),a="!"===t.tag[0]?"!"+a:"tag:yaml.org,2002:"===a.slice(0,18)?"!!"+a.slice(18):"!<"+a+">",t.dump=a+" "+t.dump)}return!0}function li(t,e){var i,r,s=[],n=[];for(hi(t,s,n),i=0,r=n.length;i<r;i+=1)e.duplicates.push(s[n[i]]);e.usedDuplicates=new Array(r)}function hi(t,e,i){var r,s,n;if(null!==t&&"object"==typeof t)if(-1!==(s=e.indexOf(t)))-1===i.indexOf(s)&&i.push(s);else if(e.push(t),Array.isArray(t))for(s=0,n=t.length;s<n;s+=1)hi(t[s],e,i);else for(s=0,n=(r=Object.keys(t)).length;s<n;s+=1)hi(t[r[s]],e,i)}function ui(t,e){return function(){throw new Error("Function yaml."+t+" is removed in js-yaml 4. Use yaml."+e+" instead, which is now safe by default.")}}var di=$,pi=z,fi=J,gi=rt,mi=st,yi=vt,vi=ae.load,bi=ae.loadAll,wi={dump:function(t,e){var i=new $e(e=e||{});i.noRefs||li(t,i);var r=t;return i.replacer&&(r=i.replacer.call({"":r},"",r)),ci(i,0,r,!0,!0)?i.dump+"\n":""}}.dump,Si=F,_i={binary:ht,float:it,map:Y,null:K,pairs:gt,set:yt,timestamp:at,bool:V,int:Q,merge:ct,omap:pt,seq:H,str:W},ki=ui("safeLoad","load"),Ei=ui("safeLoadAll","loadAll"),Ai=ui("safeDump","dump"),Ci={Type:di,Schema:pi,FAILSAFE_SCHEMA:fi,JSON_SCHEMA:gi,CORE_SCHEMA:mi,DEFAULT_SCHEMA:yi,load:vi,loadAll:bi,dump:wi,YAMLException:Si,types:_i,safeLoad:ki,safeLoadAll:Ei,safeDump:Ai},Ri=xi;function xi(t,e,i){t instanceof RegExp&&(t=Ii(t,i)),e instanceof RegExp&&(e=Ii(e,i));var r=Ni(t,e,i);return r&&{start:r[0],end:r[1],pre:i.slice(0,r[0]),body:i.slice(r[0]+t.length,r[1]),post:i.slice(r[1]+e.length)}}function Ii(t,e){var i=e.match(t);return i?i[0]:null}function Ni(t,e,i){var r,s,n,o,a,c=i.indexOf(t),l=i.indexOf(e,c+1),h=c;if(c>=0&&l>0){if(t===e)return[c,l];for(r=[],n=i.length;h>=0&&!a;)h==c?(r.push(h),c=i.indexOf(t,h+1)):1==r.length?a=[r.pop(),l]:((s=r.pop())<n&&(n=s,o=l),l=i.indexOf(e,h+1)),h=c<l&&c>=0?c:l;r.length&&(a=[n,o])}return a}xi.range=Ni;var Ti=Ri,Oi=function(t){if(!t)return[];"{}"===t.substr(0,2)&&(t="\\{\\}"+t.substr(2));return Wi(function(t){return t.split("\\\\").join(Li).split("\\{").join(Mi).split("\\}").join(Fi).split("\\,").join(Di).split("\\.").join(Bi)}(t),!0).map(Gi)},Li="\0SLASH"+Math.random()+"\0",Mi="\0OPEN"+Math.random()+"\0",Fi="\0CLOSE"+Math.random()+"\0",Di="\0COMMA"+Math.random()+"\0",Bi="\0PERIOD"+Math.random()+"\0";function Ui(t){return parseInt(t,10)==t?parseInt(t,10):t.charCodeAt(0)}function Gi(t){return t.split(Li).join("\\").split(Mi).join("{").split(Fi).join("}").split(Di).join(",").split(Bi).join(".")}function ji(t){if(!t)return[""];var e=[],i=Ti("{","}",t);if(!i)return t.split(",");var r=i.pre,s=i.body,n=i.post,o=r.split(",");o[o.length-1]+="{"+s+"}";var a=ji(n);return n.length&&(o[o.length-1]+=a.shift(),o.push.apply(o,a)),e.push.apply(e,o),e}function $i(t){return"{"+t+"}"}function Pi(t){return/^-?0\d/.test(t)}function qi(t,e){return t<=e}function zi(t,e){return t>=e}function Wi(t,e){var i=[],r=Ti("{","}",t);if(!r)return[t];var s=r.pre,n=r.post.length?Wi(r.post,!1):[""];if(/\$$/.test(r.pre))for(var o=0;o<n.length;o++){var a=s+"{"+r.body+"}"+n[o];i.push(a)}else{var c,l,h=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(r.body),u=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(r.body),d=h||u,p=r.body.indexOf(",")>=0;if(!d&&!p)return r.post.match(/,.*\}/)?Wi(t=r.pre+"{"+r.body+Fi+r.post):[t];if(d)c=r.body.split(/\.\./);else if(1===(c=ji(r.body)).length&&1===(c=Wi(c[0],!1).map($i)).length)return n.map((function(t){return r.pre+c[0]+t}));if(d){var f=Ui(c[0]),g=Ui(c[1]),m=Math.max(c[0].length,c[1].length),y=3==c.length?Math.abs(Ui(c[2])):1,v=qi;g<f&&(y*=-1,v=zi);var b=c.some(Pi);l=[];for(var w=f;v(w,g);w+=y){var S;if(u)"\\"===(S=String.fromCharCode(w))&&(S="");else if(S=String(w),b){var _=m-S.length;if(_>0){var k=new Array(_+1).join("0");S=w<0?"-"+k+S.slice(1):k+S}}l.push(S)}}else{l=[];for(var E=0;E<c.length;E++)l.push.apply(l,Wi(c[E],!1))}for(E=0;E<l.length;E++)for(o=0;o<n.length;o++){a=s+l[E]+n[o];(!e||d||a)&&i.push(a)}}return i}var Hi=u(Oi);const Yi=t=>{if("string"!=typeof t)throw new TypeError("invalid pattern");if(t.length>65536)throw new TypeError("pattern is too long")},Ji={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},Ki=t=>t.replace(/[[\]\\-]/g,"\\$&"),Vi=t=>t.join(""),Xi=(t,e)=>{const i=e;if("["!==t.charAt(i))throw new Error("not in a brace expression");const r=[],s=[];let n=i+1,o=!1,a=!1,c=!1,l=!1,h=i,u="";t:for(;n<t.length;){const e=t.charAt(n);if("!"!==e&&"^"!==e||n!==i+1){if("]"===e&&o&&!c){h=n+1;break}if(o=!0,"\\"!==e||c){if("["===e&&!c)for(const[e,[o,c,l]]of Object.entries(Ji))if(t.startsWith(e,n)){if(u)return["$.",!1,t.length-i,!0];n+=e.length,l?s.push(o):r.push(o),a=a||c;continue t}c=!1,u?(e>u?r.push(Ki(u)+"-"+Ki(e)):e===u&&r.push(Ki(e)),u="",n++):t.startsWith("-]",n+1)?(r.push(Ki(e+"-")),n+=2):t.startsWith("-",n+1)?(u=e,n+=2):(r.push(Ki(e)),n++)}else c=!0,n++}else l=!0,n++}if(h<n)return["",!1,0,!1];if(!r.length&&!s.length)return["$.",!1,t.length-i,!0];if(0===s.length&&1===r.length&&/^\\?.$/.test(r[0])&&!l){const t=2===r[0].length?r[0].slice(-1):r[0];return[(d=t,d.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")),!1,h-i,!1]}var d;const p="["+(l?"^":"")+Vi(r)+"]",f="["+(l?"":"^")+Vi(s)+"]";return[r.length&&s.length?"("+p+"|"+f+")":r.length?p:f,a,h-i,!0]},Zi=(t,{windowsPathsNoEscape:e=!1}={})=>e?t.replace(/\[([^\/\\])\]/g,"$1"):t.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1"),Qi=new Set(["!","?","+","*","@"]),tr=t=>Qi.has(t),er="(?!\\.)",ir=new Set(["[","."]),rr=new Set(["..","."]),sr=new Set("().*{}+?[]^$\\!"),nr="[^/]",or=nr+"*?",ar=nr+"+?";class cr{type;#t;#e;#i=!1;#r=[];#s;#n;#o;#a=!1;#c;#l;#h=!1;constructor(t,e,i={}){this.type=t,t&&(this.#e=!0),this.#s=e,this.#t=this.#s?this.#s.#t:this,this.#c=this.#t===this?i:this.#t.#c,this.#o=this.#t===this?[]:this.#t.#o,"!"!==t||this.#t.#a||this.#o.push(this),this.#n=this.#s?this.#s.#r.length:0}get hasMagic(){if(void 0!==this.#e)return this.#e;for(const t of this.#r)if("string"!=typeof t&&(t.type||t.hasMagic))return this.#e=!0;return this.#e}toString(){return void 0!==this.#l?this.#l:this.type?this.#l=this.type+"("+this.#r.map((t=>String(t))).join("|")+")":this.#l=this.#r.map((t=>String(t))).join("")}#u(){if(this!==this.#t)throw new Error("should only call on root");if(this.#a)return this;let t;for(this.toString(),this.#a=!0;t=this.#o.pop();){if("!"!==t.type)continue;let e=t,i=e.#s;for(;i;){for(let r=e.#n+1;!i.type&&r<i.#r.length;r++)for(const e of t.#r){if("string"==typeof e)throw new Error("string part in extglob AST??");e.copyIn(i.#r[r])}e=i,i=e.#s}}return this}push(...t){for(const e of t)if(""!==e){if("string"!=typeof e&&!(e instanceof cr&&e.#s===this))throw new Error("invalid part: "+e);this.#r.push(e)}}toJSON(){const t=null===this.type?this.#r.slice().map((t=>"string"==typeof t?t:t.toJSON())):[this.type,...this.#r.map((t=>t.toJSON()))];return this.isStart()&&!this.type&&t.unshift([]),this.isEnd()&&(this===this.#t||this.#t.#a&&"!"===this.#s?.type)&&t.push({}),t}isStart(){if(this.#t===this)return!0;if(!this.#s?.isStart())return!1;if(0===this.#n)return!0;const t=this.#s;for(let e=0;e<this.#n;e++){const i=t.#r[e];if(!(i instanceof cr&&"!"===i.type))return!1}return!0}isEnd(){if(this.#t===this)return!0;if("!"===this.#s?.type)return!0;if(!this.#s?.isEnd())return!1;if(!this.type)return this.#s?.isEnd();const t=this.#s?this.#s.#r.length:0;return this.#n===t-1}copyIn(t){"string"==typeof t?this.push(t):this.push(t.clone(this))}clone(t){const e=new cr(this.type,t);for(const t of this.#r)e.copyIn(t);return e}static#d(t,e,i,r){let s=!1,n=!1,o=-1,a=!1;if(null===e.type){let c=i,l="";for(;c<t.length;){const i=t.charAt(c++);if(s||"\\"===i)s=!s,l+=i;else if(n)c===o+1?"^"!==i&&"!"!==i||(a=!0):"]"!==i||c===o+2&&a||(n=!1),l+=i;else if("["!==i)if(r.noext||!tr(i)||"("!==t.charAt(c))l+=i;else{e.push(l),l="";const s=new cr(i,e);c=cr.#d(t,s,c,r),e.push(s)}else n=!0,o=c,a=!1,l+=i}return e.push(l),c}let c=i+1,l=new cr(null,e);const h=[];let u="";for(;c<t.length;){const i=t.charAt(c++);if(s||"\\"===i)s=!s,u+=i;else if(n)c===o+1?"^"!==i&&"!"!==i||(a=!0):"]"!==i||c===o+2&&a||(n=!1),u+=i;else if("["!==i)if(tr(i)&&"("===t.charAt(c)){l.push(u),u="";const e=new cr(i,l);l.push(e),c=cr.#d(t,e,c,r)}else if("|"!==i){if(")"===i)return""===u&&0===e.#r.length&&(e.#h=!0),l.push(u),u="",e.push(...h,l),c;u+=i}else l.push(u),u="",h.push(l),l=new cr(null,e);else n=!0,o=c,a=!1,u+=i}return e.type=null,e.#e=void 0,e.#r=[t.substring(i-1)],c}static fromGlob(t,e={}){const i=new cr(null,void 0,e);return cr.#d(t,i,0,e),i}toMMPattern(){if(this!==this.#t)return this.#t.toMMPattern();const t=this.toString(),[e,i,r,s]=this.toRegExpSource();if(!(r||this.#e||this.#c.nocase&&!this.#c.nocaseMagicOnly&&t.toUpperCase()!==t.toLowerCase()))return i;const n=(this.#c.nocase?"i":"")+(s?"u":"");return Object.assign(new RegExp(`^${e}$`,n),{_src:e,_glob:t})}get options(){return this.#c}toRegExpSource(t){const e=t??!!this.#c.dot;if(this.#t===this&&this.#u(),!this.type){const i=this.isStart()&&this.isEnd(),r=this.#r.map((e=>{const[r,s,n,o]="string"==typeof e?cr.#p(e,this.#e,i):e.toRegExpSource(t);return this.#e=this.#e||n,this.#i=this.#i||o,r})).join("");let s="";if(this.isStart()&&"string"==typeof this.#r[0]){if(!(1===this.#r.length&&rr.has(this.#r[0]))){const i=ir,n=e&&i.has(r.charAt(0))||r.startsWith("\\.")&&i.has(r.charAt(2))||r.startsWith("\\.\\.")&&i.has(r.charAt(4)),o=!e&&!t&&i.has(r.charAt(0));s=n?"(?!(?:^|/)\\.\\.?(?:$|/))":o?er:""}}let n="";this.isEnd()&&this.#t.#a&&"!"===this.#s?.type&&(n="(?:$|\\/)");return[s+r+n,Zi(r),this.#e=!!this.#e,this.#i]}const i="*"===this.type||"+"===this.type,r="!"===this.type?"(?:(?!(?:":"(?:";let s=this.#f(e);if(this.isStart()&&this.isEnd()&&!s&&"!"!==this.type){const t=this.toString();return this.#r=[t],this.type=null,this.#e=void 0,[t,Zi(this.toString()),!1,!1]}let n=!i||t||e?"":this.#f(!0);n===s&&(n=""),n&&(s=`(?:${s})(?:${n})*?`);let o="";if("!"===this.type&&this.#h)o=(this.isStart()&&!e?er:"")+ar;else{o=r+s+("!"===this.type?"))"+(!this.isStart()||e||t?"":er)+or+")":"@"===this.type?")":"?"===this.type?")?":"+"===this.type&&n?")":"*"===this.type&&n?")?":`)${this.type}`)}return[o,Zi(s),this.#e=!!this.#e,this.#i]}#f(t){return this.#r.map((e=>{if("string"==typeof e)throw new Error("string type in extglob ast??");const[i,r,s,n]=e.toRegExpSource(t);return this.#i=this.#i||n,i})).filter((t=>!(this.isStart()&&this.isEnd()&&!t))).join("|")}static#p(t,e,i=!1){let r=!1,s="",n=!1;for(let o=0;o<t.length;o++){const a=t.charAt(o);if(r)r=!1,s+=(sr.has(a)?"\\":"")+a;else if("\\"!==a){if("["===a){const[i,r,a,c]=Xi(t,o);if(a){s+=i,n=n||r,o+=a-1,e=e||c;continue}}"*"!==a?"?"!==a?s+=a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):(s+=nr,e=!0):(s+=i&&"*"===t?ar:or,e=!0)}else o===t.length-1?s+="\\\\":r=!0}return[s,Zi(t),!!e,n]}}const lr=(t,{windowsPathsNoEscape:e=!1}={})=>e?t.replace(/[?*()[\]]/g,"[$&]"):t.replace(/[?*()[\]\\]/g,"\\$&"),hr=(t,e,i={})=>(Yi(e),!(!i.nocomment&&"#"===e.charAt(0))&&new Dr(e,i).match(t)),ur=/^\*+([^+@!?\*\[\(]*)$/,dr=t=>e=>!e.startsWith(".")&&e.endsWith(t),pr=t=>e=>e.endsWith(t),fr=t=>(t=t.toLowerCase(),e=>!e.startsWith(".")&&e.toLowerCase().endsWith(t)),gr=t=>(t=t.toLowerCase(),e=>e.toLowerCase().endsWith(t)),mr=/^\*+\.\*+$/,yr=t=>!t.startsWith(".")&&t.includes("."),vr=t=>"."!==t&&".."!==t&&t.includes("."),br=/^\.\*+$/,wr=t=>"."!==t&&".."!==t&&t.startsWith("."),Sr=/^\*+$/,_r=t=>0!==t.length&&!t.startsWith("."),kr=t=>0!==t.length&&"."!==t&&".."!==t,Er=/^\?+([^+@!?\*\[\(]*)?$/,Ar=([t,e=""])=>{const i=Ir([t]);return e?(e=e.toLowerCase(),t=>i(t)&&t.toLowerCase().endsWith(e)):i},Cr=([t,e=""])=>{const i=Nr([t]);return e?(e=e.toLowerCase(),t=>i(t)&&t.toLowerCase().endsWith(e)):i},Rr=([t,e=""])=>{const i=Nr([t]);return e?t=>i(t)&&t.endsWith(e):i},xr=([t,e=""])=>{const i=Ir([t]);return e?t=>i(t)&&t.endsWith(e):i},Ir=([t])=>{const e=t.length;return t=>t.length===e&&!t.startsWith(".")},Nr=([t])=>{const e=t.length;return t=>t.length===e&&"."!==t&&".."!==t},Tr="object"==typeof process&&process?"object"==typeof process.env&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix";hr.sep="win32"===Tr?{sep:"\\"}.sep:{sep:"/"}.sep;const Or=Symbol("globstar **");hr.GLOBSTAR=Or;hr.filter=(t,e={})=>i=>hr(i,t,e);const Lr=(t,e={})=>Object.assign({},t,e);hr.defaults=t=>{if(!t||"object"!=typeof t||!Object.keys(t).length)return hr;const e=hr;return Object.assign(((i,r,s={})=>e(i,r,Lr(t,s))),{Minimatch:class extends e.Minimatch{constructor(e,i={}){super(e,Lr(t,i))}static defaults(i){return e.defaults(Lr(t,i)).Minimatch}},AST:class extends e.AST{constructor(e,i,r={}){super(e,i,Lr(t,r))}static fromGlob(i,r={}){return e.AST.fromGlob(i,Lr(t,r))}},unescape:(i,r={})=>e.unescape(i,Lr(t,r)),escape:(i,r={})=>e.escape(i,Lr(t,r)),filter:(i,r={})=>e.filter(i,Lr(t,r)),defaults:i=>e.defaults(Lr(t,i)),makeRe:(i,r={})=>e.makeRe(i,Lr(t,r)),braceExpand:(i,r={})=>e.braceExpand(i,Lr(t,r)),match:(i,r,s={})=>e.match(i,r,Lr(t,s)),sep:e.sep,GLOBSTAR:Or})};const Mr=(t,e={})=>(Yi(t),e.nobrace||!/\{(?:(?!\{).)*\}/.test(t)?[t]:Hi(t));hr.braceExpand=Mr;hr.makeRe=(t,e={})=>new Dr(t,e).makeRe();hr.match=(t,e,i={})=>{const r=new Dr(e,i);return t=t.filter((t=>r.match(t))),r.options.nonull&&!t.length&&t.push(e),t};const Fr=/[?*]|[+@!]\(.*?\)|\[|\]/;class Dr{options;set;pattern;windowsPathsNoEscape;nonegate;negate;comment;empty;preserveMultipleSlashes;partial;globSet;globParts;nocase;isWindows;platform;windowsNoMagicRoot;regexp;constructor(t,e={}){Yi(t),e=e||{},this.options=e,this.pattern=t,this.platform=e.platform||Tr,this.isWindows="win32"===this.platform,this.windowsPathsNoEscape=!!e.windowsPathsNoEscape||!1===e.allowWindowsEscape,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!e.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!e.nonegate,this.comment=!1,this.empty=!1,this.partial=!!e.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=void 0!==e.windowsNoMagicRoot?e.windowsNoMagicRoot:!(!this.isWindows||!this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(const t of this.set)for(const e of t)if("string"!=typeof e)return!0;return!1}debug(...t){}make(){const t=this.pattern,e=this.options;if(!e.nocomment&&"#"===t.charAt(0))return void(this.comment=!0);if(!t)return void(this.empty=!0);this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],e.debug&&(this.debug=(...t)=>console.error(...t)),this.debug(this.pattern,this.globSet);const i=this.globSet.map((t=>this.slashSplit(t)));this.globParts=this.preprocess(i),this.debug(this.pattern,this.globParts);let r=this.globParts.map(((t,e,i)=>{if(this.isWindows&&this.windowsNoMagicRoot){const e=!(""!==t[0]||""!==t[1]||"?"!==t[2]&&Fr.test(t[2])||Fr.test(t[3])),i=/^[a-z]:/i.test(t[0]);if(e)return[...t.slice(0,4),...t.slice(4).map((t=>this.parse(t)))];if(i)return[t[0],...t.slice(1).map((t=>this.parse(t)))]}return t.map((t=>this.parse(t)))}));if(this.debug(this.pattern,r),this.set=r.filter((t=>-1===t.indexOf(!1))),this.isWindows)for(let t=0;t<this.set.length;t++){const e=this.set[t];""===e[0]&&""===e[1]&&"?"===this.globParts[t][2]&&"string"==typeof e[3]&&/^[a-z]:$/i.test(e[3])&&(e[2]="?")}this.debug(this.pattern,this.set)}preprocess(t){if(this.options.noglobstar)for(let e=0;e<t.length;e++)for(let i=0;i<t[e].length;i++)"**"===t[e][i]&&(t[e][i]="*");const{optimizationLevel:e=1}=this.options;return e>=2?(t=this.firstPhasePreProcess(t),t=this.secondPhasePreProcess(t)):t=e>=1?this.levelOneOptimize(t):this.adjascentGlobstarOptimize(t),t}adjascentGlobstarOptimize(t){return t.map((t=>{let e=-1;for(;-1!==(e=t.indexOf("**",e+1));){let i=e;for(;"**"===t[i+1];)i++;i!==e&&t.splice(e,i-e)}return t}))}levelOneOptimize(t){return t.map((t=>(t=t.reduce(((t,e)=>{const i=t[t.length-1];return"**"===e&&"**"===i?t:".."===e&&i&&".."!==i&&"."!==i&&"**"!==i?(t.pop(),t):(t.push(e),t)}),[]),0===t.length?[""]:t)))}levelTwoFileOptimize(t){Array.isArray(t)||(t=this.slashSplit(t));let e=!1;do{if(e=!1,!this.preserveMultipleSlashes){for(let i=1;i<t.length-1;i++){const r=t[i];1===i&&""===r&&""===t[0]||("."!==r&&""!==r||(e=!0,t.splice(i,1),i--))}"."!==t[0]||2!==t.length||"."!==t[1]&&""!==t[1]||(e=!0,t.pop())}let i=0;for(;-1!==(i=t.indexOf("..",i+1));){const r=t[i-1];r&&"."!==r&&".."!==r&&"**"!==r&&(e=!0,t.splice(i-1,2),i-=2)}}while(e);return 0===t.length?[""]:t}firstPhasePreProcess(t){let e=!1;do{e=!1;for(let i of t){let r=-1;for(;-1!==(r=i.indexOf("**",r+1));){let s=r;for(;"**"===i[s+1];)s++;s>r&&i.splice(r+1,s-r);let n=i[r+1];const o=i[r+2],a=i[r+3];if(".."!==n)continue;if(!o||"."===o||".."===o||!a||"."===a||".."===a)continue;e=!0,i.splice(r,1);const c=i.slice(0);c[r]="**",t.push(c),r--}if(!this.preserveMultipleSlashes){for(let t=1;t<i.length-1;t++){const r=i[t];1===t&&""===r&&""===i[0]||("."!==r&&""!==r||(e=!0,i.splice(t,1),t--))}"."!==i[0]||2!==i.length||"."!==i[1]&&""!==i[1]||(e=!0,i.pop())}let s=0;for(;-1!==(s=i.indexOf("..",s+1));){const t=i[s-1];if(t&&"."!==t&&".."!==t&&"**"!==t){e=!0;const t=1===s&&"**"===i[s+1]?["."]:[];i.splice(s-1,2,...t),0===i.length&&i.push(""),s-=2}}}}while(e);return t}secondPhasePreProcess(t){for(let e=0;e<t.length-1;e++)for(let i=e+1;i<t.length;i++){const r=this.partsMatch(t[e],t[i],!this.preserveMultipleSlashes);r&&(t[e]=r,t[i]=[])}return t.filter((t=>t.length))}partsMatch(t,e,i=!1){let r=0,s=0,n=[],o="";for(;r<t.length&&s<e.length;)if(t[r]===e[s])n.push("b"===o?e[s]:t[r]),r++,s++;else if(i&&"**"===t[r]&&e[s]===t[r+1])n.push(t[r]),r++;else if(i&&"**"===e[s]&&t[r]===e[s+1])n.push(e[s]),s++;else if("*"!==t[r]||!e[s]||!this.options.dot&&e[s].startsWith(".")||"**"===e[s]){if("*"!==e[s]||!t[r]||!this.options.dot&&t[r].startsWith(".")||"**"===t[r])return!1;if("a"===o)return!1;o="b",n.push(e[s]),r++,s++}else{if("b"===o)return!1;o="a",n.push(t[r]),r++,s++}return t.length===e.length&&n}parseNegate(){if(this.nonegate)return;const t=this.pattern;let e=!1,i=0;for(let r=0;r<t.length&&"!"===t.charAt(r);r++)e=!e,i++;i&&(this.pattern=t.slice(i)),this.negate=e}matchOne(t,e,i=!1){const r=this.options;if(this.isWindows){const i="string"==typeof t[0]&&/^[a-z]:$/i.test(t[0]),r=!i&&""===t[0]&&""===t[1]&&"?"===t[2]&&/^[a-z]:$/i.test(t[3]),s="string"==typeof e[0]&&/^[a-z]:$/i.test(e[0]),n=r?3:i?0:void 0,o=!s&&""===e[0]&&""===e[1]&&"?"===e[2]&&"string"==typeof e[3]&&/^[a-z]:$/i.test(e[3])?3:s?0:void 0;if("number"==typeof n&&"number"==typeof o){const[i,r]=[t[n],e[o]];i.toLowerCase()===r.toLowerCase()&&(e[o]=i,o>n?e=e.slice(o):n>o&&(t=t.slice(n)))}}const{optimizationLevel:s=1}=this.options;s>=2&&(t=this.levelTwoFileOptimize(t)),this.debug("matchOne",this,{file:t,pattern:e}),this.debug("matchOne",t.length,e.length);for(var n=0,o=0,a=t.length,c=e.length;n<a&&o<c;n++,o++){this.debug("matchOne loop");var l=e[o],h=t[n];if(this.debug(e,l,h),!1===l)return!1;if(l===Or){this.debug("GLOBSTAR",[e,l,h]);var u=n,d=o+1;if(d===c){for(this.debug("** at the end");n<a;n++)if("."===t[n]||".."===t[n]||!r.dot&&"."===t[n].charAt(0))return!1;return!0}for(;u<a;){var p=t[u];if(this.debug("\nglobstar while",t,u,e,d,p),this.matchOne(t.slice(u),e.slice(d),i))return this.debug("globstar found match!",u,a,p),!0;if("."===p||".."===p||!r.dot&&"."===p.charAt(0)){this.debug("dot detected!",t,u,e,d);break}this.debug("globstar swallow a segment, and continue"),u++}return!(!i||(this.debug("\n>>> no match, partial?",t,u,e,d),u!==a))}let s;if("string"==typeof l?(s=h===l,this.debug("string match",l,h,s)):(s=l.test(h),this.debug("pattern match",l,h,s)),!s)return!1}if(n===a&&o===c)return!0;if(n===a)return i;if(o===c)return n===a-1&&""===t[n];throw new Error("wtf?")}braceExpand(){return Mr(this.pattern,this.options)}parse(t){Yi(t);const e=this.options;if("**"===t)return Or;if(""===t)return"";let i,r=null;(i=t.match(Sr))?r=e.dot?kr:_r:(i=t.match(ur))?r=(e.nocase?e.dot?gr:fr:e.dot?pr:dr)(i[1]):(i=t.match(Er))?r=(e.nocase?e.dot?Cr:Ar:e.dot?Rr:xr)(i):(i=t.match(mr))?r=e.dot?vr:yr:(i=t.match(br))&&(r=wr);const s=cr.fromGlob(t,this.options).toMMPattern();return r&&"object"==typeof s&&Reflect.defineProperty(s,"test",{value:r}),s}makeRe(){if(this.regexp||!1===this.regexp)return this.regexp;const t=this.set;if(!t.length)return this.regexp=!1,this.regexp;const e=this.options,i=e.noglobstar?"[^/]*?":e.dot?"(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?":"(?:(?!(?:\\/|^)\\.).)*?",r=new Set(e.nocase?["i"]:[]);let s=t.map((t=>{const e=t.map((t=>{if(t instanceof RegExp)for(const e of t.flags.split(""))r.add(e);return"string"==typeof t?t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):t===Or?Or:t._src}));return e.forEach(((t,r)=>{const s=e[r+1],n=e[r-1];t===Or&&n!==Or&&(void 0===n?void 0!==s&&s!==Or?e[r+1]="(?:\\/|"+i+"\\/)?"+s:e[r]=i:void 0===s?e[r-1]=n+"(?:\\/|"+i+")?":s!==Or&&(e[r-1]=n+"(?:\\/|\\/"+i+"\\/)"+s,e[r+1]=Or))})),e.filter((t=>t!==Or)).join("/")})).join("|");const[n,o]=t.length>1?["(?:",")"]:["",""];s="^"+n+s+o+"$",this.negate&&(s="^(?!"+s+").+$");try{this.regexp=new RegExp(s,[...r].join(""))}catch(t){this.regexp=!1}return this.regexp}slashSplit(t){return this.preserveMultipleSlashes?t.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(t)?["",...t.split(/\/+/)]:t.split(/\/+/)}match(t,e=this.partial){if(this.debug("match",t,this.pattern),this.comment)return!1;if(this.empty)return""===t;if("/"===t&&e)return!0;const i=this.options;this.isWindows&&(t=t.split("\\").join("/"));const r=this.slashSplit(t);this.debug(this.pattern,"split",r);const s=this.set;this.debug(this.pattern,"set",s);let n=r[r.length-1];if(!n)for(let t=r.length-2;!n&&t>=0;t--)n=r[t];for(let t=0;t<s.length;t++){const o=s[t];let a=r;i.matchBase&&1===o.length&&(a=[n]);if(this.matchOne(a,o,e))return!!i.flipNegate||!this.negate}return!i.flipNegate&&this.negate}static defaults(t){return hr.defaults(t).Minimatch}}hr.AST=cr,hr.Minimatch=Dr,hr.escape=lr,hr.unescape=Zi;const Br="object"==typeof performance&&performance&&"function"==typeof performance.now?performance:Date,Ur=new Set,Gr="object"==typeof process&&process?process:{},jr=(t,e,i,r)=>{"function"==typeof Gr.emitWarning?Gr.emitWarning(t,e,i,r):console.error(`[${i}] ${e}: ${t}`)};let $r=globalThis.AbortController,Pr=globalThis.AbortSignal;if(void 0===$r){Pr=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(t,e){this._onabort.push(e)}},$r=class{constructor(){e()}signal=new Pr;abort(t){if(!this.signal.aborted){this.signal.reason=t,this.signal.aborted=!0;for(const e of this.signal._onabort)e(t);this.signal.onabort?.(t)}}};let t="1"!==Gr.env?.LRU_CACHE_IGNORE_AC_WARNING;const e=()=>{t&&(t=!1,jr("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",e))}}const qr=t=>t&&t===Math.floor(t)&&t>0&&isFinite(t),zr=t=>qr(t)?t<=Math.pow(2,8)?Uint8Array:t<=Math.pow(2,16)?Uint16Array:t<=Math.pow(2,32)?Uint32Array:t<=Number.MAX_SAFE_INTEGER?Wr:null:null;class Wr extends Array{constructor(t){super(t),this.fill(0)}}class Hr{heap;length;static#g=!1;static create(t){const e=zr(t);if(!e)return[];Hr.#g=!0;const i=new Hr(t,e);return Hr.#g=!1,i}constructor(t,e){if(!Hr.#g)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new e(t),this.length=0}push(t){this.heap[this.length++]=t}pop(){return this.heap[--this.length]}}class Yr{#m;#y;#v;#b;#w;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#S;#_;#k;#E;#A;#C;#R;#x;#I;#N;#T;#O;#L;#M;#F;#D;#B;static unsafeExposeInternals(t){return{starts:t.#L,ttls:t.#M,sizes:t.#O,keyMap:t.#k,keyList:t.#E,valList:t.#A,next:t.#C,prev:t.#R,get head(){return t.#x},get tail(){return t.#I},free:t.#N,isBackgroundFetch:e=>t.#U(e),backgroundFetch:(e,i,r,s)=>t.#G(e,i,r,s),moveToTail:e=>t.#j(e),indexes:e=>t.#$(e),rindexes:e=>t.#P(e),isStale:e=>t.#q(e)}}get max(){return this.#m}get maxSize(){return this.#y}get calculatedSize(){return this.#_}get size(){return this.#S}get fetchMethod(){return this.#w}get dispose(){return this.#v}get disposeAfter(){return this.#b}constructor(t){const{max:e=0,ttl:i,ttlResolution:r=1,ttlAutopurge:s,updateAgeOnGet:n,updateAgeOnHas:o,allowStale:a,dispose:c,disposeAfter:l,noDisposeOnSet:h,noUpdateTTL:u,maxSize:d=0,maxEntrySize:p=0,sizeCalculation:f,fetchMethod:g,noDeleteOnFetchRejection:m,noDeleteOnStaleGet:y,allowStaleOnFetchRejection:v,allowStaleOnFetchAbort:b,ignoreFetchAbort:w}=t;if(0!==e&&!qr(e))throw new TypeError("max option must be a nonnegative integer");const S=e?zr(e):Array;if(!S)throw new Error("invalid max value: "+e);if(this.#m=e,this.#y=d,this.maxEntrySize=p||this.#y,this.sizeCalculation=f,this.sizeCalculation){if(!this.#y&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if("function"!=typeof this.sizeCalculation)throw new TypeError("sizeCalculation set to non-function")}if(void 0!==g&&"function"!=typeof g)throw new TypeError("fetchMethod must be a function if specified");if(this.#w=g,this.#D=!!g,this.#k=new Map,this.#E=new Array(e).fill(void 0),this.#A=new Array(e).fill(void 0),this.#C=new S(e),this.#R=new S(e),this.#x=0,this.#I=0,this.#N=Hr.create(e),this.#S=0,this.#_=0,"function"==typeof c&&(this.#v=c),"function"==typeof l?(this.#b=l,this.#T=[]):(this.#b=void 0,this.#T=void 0),this.#F=!!this.#v,this.#B=!!this.#b,this.noDisposeOnSet=!!h,this.noUpdateTTL=!!u,this.noDeleteOnFetchRejection=!!m,this.allowStaleOnFetchRejection=!!v,this.allowStaleOnFetchAbort=!!b,this.ignoreFetchAbort=!!w,0!==this.maxEntrySize){if(0!==this.#y&&!qr(this.#y))throw new TypeError("maxSize must be a positive integer if specified");if(!qr(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#z()}if(this.allowStale=!!a,this.noDeleteOnStaleGet=!!y,this.updateAgeOnGet=!!n,this.updateAgeOnHas=!!o,this.ttlResolution=qr(r)||0===r?r:1,this.ttlAutopurge=!!s,this.ttl=i||0,this.ttl){if(!qr(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#W()}if(0===this.#m&&0===this.ttl&&0===this.#y)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#m&&!this.#y){const t="LRU_CACHE_UNBOUNDED";if((t=>!Ur.has(t))(t)){Ur.add(t);jr("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",t,Yr)}}}getRemainingTTL(t){return this.#k.has(t)?1/0:0}#W(){const t=new Wr(this.#m),e=new Wr(this.#m);this.#M=t,this.#L=e,this.#H=(i,r,s=Br.now())=>{if(e[i]=0!==r?s:0,t[i]=r,0!==r&&this.ttlAutopurge){const t=setTimeout((()=>{this.#q(i)&&this.delete(this.#E[i])}),r+1);t.unref&&t.unref()}},this.#Y=i=>{e[i]=0!==t[i]?Br.now():0},this.#J=(s,n)=>{if(t[n]){const o=t[n],a=e[n];if(!o||!a)return;s.ttl=o,s.start=a,s.now=i||r();const c=s.now-a;s.remainingTTL=o-c}};let i=0;const r=()=>{const t=Br.now();if(this.ttlResolution>0){i=t;const e=setTimeout((()=>i=0),this.ttlResolution);e.unref&&e.unref()}return t};this.getRemainingTTL=s=>{const n=this.#k.get(s);if(void 0===n)return 0;const o=t[n],a=e[n];if(!o||!a)return 1/0;return o-((i||r())-a)},this.#q=s=>{const n=e[s],o=t[s];return!!o&&!!n&&(i||r())-n>o}}#Y=()=>{};#J=()=>{};#H=()=>{};#q=()=>!1;#z(){const t=new Wr(this.#m);this.#_=0,this.#O=t,this.#K=e=>{this.#_-=t[e],t[e]=0},this.#V=(t,e,i,r)=>{if(this.#U(e))return 0;if(!qr(i)){if(!r)throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");if("function"!=typeof r)throw new TypeError("sizeCalculation must be a function");if(i=r(e,t),!qr(i))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}return i},this.#X=(e,i,r)=>{if(t[e]=i,this.#y){const i=this.#y-t[e];for(;this.#_>i;)this.#Z(!0)}this.#_+=t[e],r&&(r.entrySize=i,r.totalCalculatedSize=this.#_)}}#K=t=>{};#X=(t,e,i)=>{};#V=(t,e,i,r)=>{if(i||r)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#$({allowStale:t=this.allowStale}={}){if(this.#S)for(let e=this.#I;this.#Q(e)&&(!t&&this.#q(e)||(yield e),e!==this.#x);)e=this.#R[e]}*#P({allowStale:t=this.allowStale}={}){if(this.#S)for(let e=this.#x;this.#Q(e)&&(!t&&this.#q(e)||(yield e),e!==this.#I);)e=this.#C[e]}#Q(t){return void 0!==t&&this.#k.get(this.#E[t])===t}*entries(){for(const t of this.#$())void 0===this.#A[t]||void 0===this.#E[t]||this.#U(this.#A[t])||(yield[this.#E[t],this.#A[t]])}*rentries(){for(const t of this.#P())void 0===this.#A[t]||void 0===this.#E[t]||this.#U(this.#A[t])||(yield[this.#E[t],this.#A[t]])}*keys(){for(const t of this.#$()){const e=this.#E[t];void 0===e||this.#U(this.#A[t])||(yield e)}}*rkeys(){for(const t of this.#P()){const e=this.#E[t];void 0===e||this.#U(this.#A[t])||(yield e)}}*values(){for(const t of this.#$()){void 0===this.#A[t]||this.#U(this.#A[t])||(yield this.#A[t])}}*rvalues(){for(const t of this.#P()){void 0===this.#A[t]||this.#U(this.#A[t])||(yield this.#A[t])}}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(t,e={}){for(const i of this.#$()){const r=this.#A[i],s=this.#U(r)?r.__staleWhileFetching:r;if(void 0!==s&&t(s,this.#E[i],this))return this.get(this.#E[i],e)}}forEach(t,e=this){for(const i of this.#$()){const r=this.#A[i],s=this.#U(r)?r.__staleWhileFetching:r;void 0!==s&&t.call(e,s,this.#E[i],this)}}rforEach(t,e=this){for(const i of this.#P()){const r=this.#A[i],s=this.#U(r)?r.__staleWhileFetching:r;void 0!==s&&t.call(e,s,this.#E[i],this)}}purgeStale(){let t=!1;for(const e of this.#P({allowStale:!0}))this.#q(e)&&(this.delete(this.#E[e]),t=!0);return t}info(t){const e=this.#k.get(t);if(void 0===e)return;const i=this.#A[e],r=this.#U(i)?i.__staleWhileFetching:i;if(void 0===r)return;const s={value:r};if(this.#M&&this.#L){const t=this.#M[e],i=this.#L[e];if(t&&i){const e=t-(Br.now()-i);s.ttl=e,s.start=Date.now()}}return this.#O&&(s.size=this.#O[e]),s}dump(){const t=[];for(const e of this.#$({allowStale:!0})){const i=this.#E[e],r=this.#A[e],s=this.#U(r)?r.__staleWhileFetching:r;if(void 0===s||void 0===i)continue;const n={value:s};if(this.#M&&this.#L){n.ttl=this.#M[e];const t=Br.now()-this.#L[e];n.start=Math.floor(Date.now()-t)}this.#O&&(n.size=this.#O[e]),t.unshift([i,n])}return t}load(t){this.clear();for(const[e,i]of t){if(i.start){const t=Date.now()-i.start;i.start=Br.now()-t}this.set(e,i.value,i)}}set(t,e,i={}){if(void 0===e)return this.delete(t),this;const{ttl:r=this.ttl,start:s,noDisposeOnSet:n=this.noDisposeOnSet,sizeCalculation:o=this.sizeCalculation,status:a}=i;let{noUpdateTTL:c=this.noUpdateTTL}=i;const l=this.#V(t,e,i.size||0,o);if(this.maxEntrySize&&l>this.maxEntrySize)return a&&(a.set="miss",a.maxEntrySizeExceeded=!0),this.delete(t),this;let h=0===this.#S?void 0:this.#k.get(t);if(void 0===h)h=0===this.#S?this.#I:0!==this.#N.length?this.#N.pop():this.#S===this.#m?this.#Z(!1):this.#S,this.#E[h]=t,this.#A[h]=e,this.#k.set(t,h),this.#C[this.#I]=h,this.#R[h]=this.#I,this.#I=h,this.#S++,this.#X(h,l,a),a&&(a.set="add"),c=!1;else{this.#j(h);const i=this.#A[h];if(e!==i){if(this.#D&&this.#U(i)){i.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:e}=i;void 0===e||n||(this.#F&&this.#v?.(e,t,"set"),this.#B&&this.#T?.push([e,t,"set"]))}else n||(this.#F&&this.#v?.(i,t,"set"),this.#B&&this.#T?.push([i,t,"set"]));if(this.#K(h),this.#X(h,l,a),this.#A[h]=e,a){a.set="replace";const t=i&&this.#U(i)?i.__staleWhileFetching:i;void 0!==t&&(a.oldValue=t)}}else a&&(a.set="update")}if(0===r||this.#M||this.#W(),this.#M&&(c||this.#H(h,r,s),a&&this.#J(a,h)),!n&&this.#B&&this.#T){const t=this.#T;let e;for(;e=t?.shift();)this.#b?.(...e)}return this}pop(){try{for(;this.#S;){const t=this.#A[this.#x];if(this.#Z(!0),this.#U(t)){if(t.__staleWhileFetching)return t.__staleWhileFetching}else if(void 0!==t)return t}}finally{if(this.#B&&this.#T){const t=this.#T;let e;for(;e=t?.shift();)this.#b?.(...e)}}}#Z(t){const e=this.#x,i=this.#E[e],r=this.#A[e];return this.#D&&this.#U(r)?r.__abortController.abort(new Error("evicted")):(this.#F||this.#B)&&(this.#F&&this.#v?.(r,i,"evict"),this.#B&&this.#T?.push([r,i,"evict"])),this.#K(e),t&&(this.#E[e]=void 0,this.#A[e]=void 0,this.#N.push(e)),1===this.#S?(this.#x=this.#I=0,this.#N.length=0):this.#x=this.#C[e],this.#k.delete(i),this.#S--,e}has(t,e={}){const{updateAgeOnHas:i=this.updateAgeOnHas,status:r}=e,s=this.#k.get(t);if(void 0!==s){const t=this.#A[s];if(this.#U(t)&&void 0===t.__staleWhileFetching)return!1;if(!this.#q(s))return i&&this.#Y(s),r&&(r.has="hit",this.#J(r,s)),!0;r&&(r.has="stale",this.#J(r,s))}else r&&(r.has="miss");return!1}peek(t,e={}){const{allowStale:i=this.allowStale}=e,r=this.#k.get(t);if(void 0===r||!i&&this.#q(r))return;const s=this.#A[r];return this.#U(s)?s.__staleWhileFetching:s}#G(t,e,i,r){const s=void 0===e?void 0:this.#A[e];if(this.#U(s))return s;const n=new $r,{signal:o}=i;o?.addEventListener("abort",(()=>n.abort(o.reason)),{signal:n.signal});const a={signal:n.signal,options:i,context:r},c=(r,s=!1)=>{const{aborted:o}=n.signal,c=i.ignoreFetchAbort&&void 0!==r;if(i.status&&(o&&!s?(i.status.fetchAborted=!0,i.status.fetchError=n.signal.reason,c&&(i.status.fetchAbortIgnored=!0)):i.status.fetchResolved=!0),o&&!c&&!s)return l(n.signal.reason);const u=h;return this.#A[e]===h&&(void 0===r?u.__staleWhileFetching?this.#A[e]=u.__staleWhileFetching:this.delete(t):(i.status&&(i.status.fetchUpdated=!0),this.set(t,r,a.options))),r},l=r=>{const{aborted:s}=n.signal,o=s&&i.allowStaleOnFetchAbort,a=o||i.allowStaleOnFetchRejection,c=a||i.noDeleteOnFetchRejection,l=h;if(this.#A[e]===h){!c||void 0===l.__staleWhileFetching?this.delete(t):o||(this.#A[e]=l.__staleWhileFetching)}if(a)return i.status&&void 0!==l.__staleWhileFetching&&(i.status.returnedStale=!0),l.__staleWhileFetching;if(l.__returned===l)throw r};i.status&&(i.status.fetchDispatched=!0);const h=new Promise(((e,r)=>{const o=this.#w?.(t,s,a);o&&o instanceof Promise&&o.then((t=>e(void 0===t?void 0:t)),r),n.signal.addEventListener("abort",(()=>{i.ignoreFetchAbort&&!i.allowStaleOnFetchAbort||(e(void 0),i.allowStaleOnFetchAbort&&(e=t=>c(t,!0)))}))})).then(c,(t=>(i.status&&(i.status.fetchRejected=!0,i.status.fetchError=t),l(t)))),u=Object.assign(h,{__abortController:n,__staleWhileFetching:s,__returned:void 0});return void 0===e?(this.set(t,u,{...a.options,status:void 0}),e=this.#k.get(t)):this.#A[e]=u,u}#U(t){if(!this.#D)return!1;const e=t;return!!e&&e instanceof Promise&&e.hasOwnProperty("__staleWhileFetching")&&e.__abortController instanceof $r}async fetch(t,e={}){const{allowStale:i=this.allowStale,updateAgeOnGet:r=this.updateAgeOnGet,noDeleteOnStaleGet:s=this.noDeleteOnStaleGet,ttl:n=this.ttl,noDisposeOnSet:o=this.noDisposeOnSet,size:a=0,sizeCalculation:c=this.sizeCalculation,noUpdateTTL:l=this.noUpdateTTL,noDeleteOnFetchRejection:h=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:u=this.allowStaleOnFetchRejection,ignoreFetchAbort:d=this.ignoreFetchAbort,allowStaleOnFetchAbort:p=this.allowStaleOnFetchAbort,context:f,forceRefresh:g=!1,status:m,signal:y}=e;if(!this.#D)return m&&(m.fetch="get"),this.get(t,{allowStale:i,updateAgeOnGet:r,noDeleteOnStaleGet:s,status:m});const v={allowStale:i,updateAgeOnGet:r,noDeleteOnStaleGet:s,ttl:n,noDisposeOnSet:o,size:a,sizeCalculation:c,noUpdateTTL:l,noDeleteOnFetchRejection:h,allowStaleOnFetchRejection:u,allowStaleOnFetchAbort:p,ignoreFetchAbort:d,status:m,signal:y};let b=this.#k.get(t);if(void 0===b){m&&(m.fetch="miss");const e=this.#G(t,b,v,f);return e.__returned=e}{const e=this.#A[b];if(this.#U(e)){const t=i&&void 0!==e.__staleWhileFetching;return m&&(m.fetch="inflight",t&&(m.returnedStale=!0)),t?e.__staleWhileFetching:e.__returned=e}const s=this.#q(b);if(!g&&!s)return m&&(m.fetch="hit"),this.#j(b),r&&this.#Y(b),m&&this.#J(m,b),e;const n=this.#G(t,b,v,f),o=void 0!==n.__staleWhileFetching&&i;return m&&(m.fetch=s?"stale":"refresh",o&&s&&(m.returnedStale=!0)),o?n.__staleWhileFetching:n.__returned=n}}get(t,e={}){const{allowStale:i=this.allowStale,updateAgeOnGet:r=this.updateAgeOnGet,noDeleteOnStaleGet:s=this.noDeleteOnStaleGet,status:n}=e,o=this.#k.get(t);if(void 0!==o){const e=this.#A[o],a=this.#U(e);return n&&this.#J(n,o),this.#q(o)?(n&&(n.get="stale"),a?(n&&i&&void 0!==e.__staleWhileFetching&&(n.returnedStale=!0),i?e.__staleWhileFetching:void 0):(s||this.delete(t),n&&i&&(n.returnedStale=!0),i?e:void 0)):(n&&(n.get="hit"),a?e.__staleWhileFetching:(this.#j(o),r&&this.#Y(o),e))}n&&(n.get="miss")}#tt(t,e){this.#R[e]=t,this.#C[t]=e}#j(t){t!==this.#I&&(t===this.#x?this.#x=this.#C[t]:this.#tt(this.#R[t],this.#C[t]),this.#tt(this.#I,t),this.#I=t)}delete(t){let e=!1;if(0!==this.#S){const i=this.#k.get(t);if(void 0!==i)if(e=!0,1===this.#S)this.clear();else{this.#K(i);const e=this.#A[i];if(this.#U(e)?e.__abortController.abort(new Error("deleted")):(this.#F||this.#B)&&(this.#F&&this.#v?.(e,t,"delete"),this.#B&&this.#T?.push([e,t,"delete"])),this.#k.delete(t),this.#E[i]=void 0,this.#A[i]=void 0,i===this.#I)this.#I=this.#R[i];else if(i===this.#x)this.#x=this.#C[i];else{const t=this.#R[i];this.#C[t]=this.#C[i];const e=this.#C[i];this.#R[e]=this.#R[i]}this.#S--,this.#N.push(i)}}if(this.#B&&this.#T?.length){const t=this.#T;let e;for(;e=t?.shift();)this.#b?.(...e)}return e}clear(){for(const t of this.#P({allowStale:!0})){const e=this.#A[t];if(this.#U(e))e.__abortController.abort(new Error("deleted"));else{const i=this.#E[t];this.#F&&this.#v?.(e,i,"delete"),this.#B&&this.#T?.push([e,i,"delete"])}}if(this.#k.clear(),this.#A.fill(void 0),this.#E.fill(void 0),this.#M&&this.#L&&(this.#M.fill(0),this.#L.fill(0)),this.#O&&this.#O.fill(0),this.#x=0,this.#I=0,this.#N.length=0,this.#_=0,this.#S=0,this.#B&&this.#T){const t=this.#T;let e;for(;e=t?.shift();)this.#b?.(...e)}}}const Jr="object"==typeof process&&process?process:{stdout:null,stderr:null},Kr=t=>!!t&&"object"==typeof t&&(t instanceof Ls||t instanceof o||Vr(t)||Xr(t)),Vr=t=>!!t&&"object"==typeof t&&t instanceof n.EventEmitter&&"function"==typeof t.pipe&&t.pipe!==o.Writable.prototype.pipe,Xr=t=>!!t&&"object"==typeof t&&t instanceof n.EventEmitter&&"function"==typeof t.write&&"function"==typeof t.end,Zr=Symbol("EOF"),Qr=Symbol("maybeEmitEnd"),ts=Symbol("emittedEnd"),es=Symbol("emittingEnd"),is=Symbol("emittedError"),rs=Symbol("closed"),ss=Symbol("read"),ns=Symbol("flush"),os=Symbol("flushChunk"),as=Symbol("encoding"),cs=Symbol("decoder"),ls=Symbol("flowing"),hs=Symbol("paused"),us=Symbol("resume"),ds=Symbol("buffer"),ps=Symbol("pipes"),fs=Symbol("bufferLength"),gs=Symbol("bufferPush"),ms=Symbol("bufferShift"),ys=Symbol("objectMode"),vs=Symbol("destroyed"),bs=Symbol("error"),ws=Symbol("emitData"),Ss=Symbol("emitEnd"),_s=Symbol("emitEnd2"),ks=Symbol("async"),Es=Symbol("abort"),As=Symbol("aborted"),Cs=Symbol("signal"),Rs=Symbol("dataListeners"),xs=Symbol("discarded"),Is=t=>Promise.resolve().then(t),Ns=t=>t();class Ts{src;dest;opts;ondrain;constructor(t,e,i){this.src=t,this.dest=e,this.opts=i,this.ondrain=()=>t[us](),this.dest.on("drain",this.ondrain)}unpipe(){this.dest.removeListener("drain",this.ondrain)}proxyErrors(t){}end(){this.unpipe(),this.opts.end&&this.dest.end()}}class Os extends Ts{unpipe(){this.src.removeListener("error",this.proxyErrors),super.unpipe()}constructor(t,e,i){super(t,e,i),this.proxyErrors=t=>e.emit("error",t),t.on("error",this.proxyErrors)}}class Ls extends n.EventEmitter{[ls]=!1;[hs]=!1;[ps]=[];[ds]=[];[ys];[as];[ks];[cs];[Zr]=!1;[ts]=!1;[es]=!1;[rs]=!1;[is]=null;[fs]=0;[vs]=!1;[Cs];[As]=!1;[Rs]=0;[xs]=!1;writable=!0;readable=!0;constructor(...t){const e=t[0]||{};if(super(),e.objectMode&&"string"==typeof e.encoding)throw new TypeError("Encoding and objectMode may not be used together");e.objectMode?(this[ys]=!0,this[as]=null):(t=>!t.objectMode&&!!t.encoding&&"buffer"!==t.encoding)(e)?(this[as]=e.encoding,this[ys]=!1):(this[ys]=!1,this[as]=null),this[ks]=!!e.async,this[cs]=this[as]?new a.StringDecoder(this[as]):null,e&&!0===e.debugExposeBuffer&&Object.defineProperty(this,"buffer",{get:()=>this[ds]}),e&&!0===e.debugExposePipes&&Object.defineProperty(this,"pipes",{get:()=>this[ps]});const{signal:i}=e;i&&(this[Cs]=i,i.aborted?this[Es]():i.addEventListener("abort",(()=>this[Es]())))}get bufferLength(){return this[fs]}get encoding(){return this[as]}set encoding(t){throw new Error("Encoding must be set at instantiation time")}setEncoding(t){throw new Error("Encoding must be set at instantiation time")}get objectMode(){return this[ys]}set objectMode(t){throw new Error("objectMode must be set at instantiation time")}get async(){return this[ks]}set async(t){this[ks]=this[ks]||!!t}[Es](){this[As]=!0,this.emit("abort",this[Cs]?.reason),this.destroy(this[Cs]?.reason)}get aborted(){return this[As]}set aborted(t){}write(t,e,i){if(this[As])return!1;if(this[Zr])throw new Error("write after end");if(this[vs])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;"function"==typeof e&&(i=e,e="utf8"),e||(e="utf8");const r=this[ks]?Is:Ns;if(!this[ys]&&!Buffer.isBuffer(t))if(s=t,!Buffer.isBuffer(s)&&ArrayBuffer.isView(s))t=Buffer.from(t.buffer,t.byteOffset,t.byteLength);else if((t=>t instanceof ArrayBuffer||!!t&&"object"==typeof t&&t.constructor&&"ArrayBuffer"===t.constructor.name&&t.byteLength>=0)(t))t=Buffer.from(t);else if("string"!=typeof t)throw new Error("Non-contiguous data written to non-objectMode stream");var s;return this[ys]?(this[ls]&&0!==this[fs]&&this[ns](!0),this[ls]?this.emit("data",t):this[gs](t),0!==this[fs]&&this.emit("readable"),i&&r(i),this[ls]):t.length?("string"!=typeof t||e===this[as]&&!this[cs]?.lastNeed||(t=Buffer.from(t,e)),Buffer.isBuffer(t)&&this[as]&&(t=this[cs].write(t)),this[ls]&&0!==this[fs]&&this[ns](!0),this[ls]?this.emit("data",t):this[gs](t),0!==this[fs]&&this.emit("readable"),i&&r(i),this[ls]):(0!==this[fs]&&this.emit("readable"),i&&r(i),this[ls])}read(t){if(this[vs])return null;if(this[xs]=!1,0===this[fs]||0===t||t&&t>this[fs])return this[Qr](),null;this[ys]&&(t=null),this[ds].length>1&&!this[ys]&&(this[ds]=[this[as]?this[ds].join(""):Buffer.concat(this[ds],this[fs])]);const e=this[ss](t||null,this[ds][0]);return this[Qr](),e}[ss](t,e){if(this[ys])this[ms]();else{const i=e;t===i.length||null===t?this[ms]():"string"==typeof i?(this[ds][0]=i.slice(t),e=i.slice(0,t),this[fs]-=t):(this[ds][0]=i.subarray(t),e=i.subarray(0,t),this[fs]-=t)}return this.emit("data",e),this[ds].length||this[Zr]||this.emit("drain"),e}end(t,e,i){return"function"==typeof t&&(i=t,t=void 0),"function"==typeof e&&(i=e,e="utf8"),void 0!==t&&this.write(t,e),i&&this.once("end",i),this[Zr]=!0,this.writable=!1,!this[ls]&&this[hs]||this[Qr](),this}[us](){this[vs]||(this[Rs]||this[ps].length||(this[xs]=!0),this[hs]=!1,this[ls]=!0,this.emit("resume"),this[ds].length?this[ns]():this[Zr]?this[Qr]():this.emit("drain"))}resume(){return this[us]()}pause(){this[ls]=!1,this[hs]=!0,this[xs]=!1}get destroyed(){return this[vs]}get flowing(){return this[ls]}get paused(){return this[hs]}[gs](t){this[ys]?this[fs]+=1:this[fs]+=t.length,this[ds].push(t)}[ms](){return this[ys]?this[fs]-=1:this[fs]-=this[ds][0].length,this[ds].shift()}[ns](t=!1){do{}while(this[os](this[ms]())&&this[ds].length);t||this[ds].length||this[Zr]||this.emit("drain")}[os](t){return this.emit("data",t),this[ls]}pipe(t,e){if(this[vs])return t;this[xs]=!1;const i=this[ts];return e=e||{},t===Jr.stdout||t===Jr.stderr?e.end=!1:e.end=!1!==e.end,e.proxyErrors=!!e.proxyErrors,i?e.end&&t.end():(this[ps].push(e.proxyErrors?new Os(this,t,e):new Ts(this,t,e)),this[ks]?Is((()=>this[us]())):this[us]()),t}unpipe(t){const e=this[ps].find((e=>e.dest===t));e&&(1===this[ps].length?(this[ls]&&0===this[Rs]&&(this[ls]=!1),this[ps]=[]):this[ps].splice(this[ps].indexOf(e),1),e.unpipe())}addListener(t,e){return this.on(t,e)}on(t,e){const i=super.on(t,e);if("data"===t)this[xs]=!1,this[Rs]++,this[ps].length||this[ls]||this[us]();else if("readable"===t&&0!==this[fs])super.emit("readable");else if((t=>"end"===t||"finish"===t||"prefinish"===t)(t)&&this[ts])super.emit(t),this.removeAllListeners(t);else if("error"===t&&this[is]){const t=e;this[ks]?Is((()=>t.call(this,this[is]))):t.call(this,this[is])}return i}removeListener(t,e){return this.off(t,e)}off(t,e){const i=super.off(t,e);return"data"===t&&(this[Rs]=this.listeners("data").length,0!==this[Rs]||this[xs]||this[ps].length||(this[ls]=!1)),i}removeAllListeners(t){const e=super.removeAllListeners(t);return"data"!==t&&void 0!==t||(this[Rs]=0,this[xs]||this[ps].length||(this[ls]=!1)),e}get emittedEnd(){return this[ts]}[Qr](){this[es]||this[ts]||this[vs]||0!==this[ds].length||!this[Zr]||(this[es]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[rs]&&this.emit("close"),this[es]=!1)}emit(t,...e){const i=e[0];if("error"!==t&&"close"!==t&&t!==vs&&this[vs])return!1;if("data"===t)return!(!this[ys]&&!i)&&(this[ks]?(Is((()=>this[ws](i))),!0):this[ws](i));if("end"===t)return this[Ss]();if("close"===t){if(this[rs]=!0,!this[ts]&&!this[vs])return!1;const t=super.emit("close");return this.removeAllListeners("close"),t}if("error"===t){this[is]=i,super.emit(bs,i);const t=!(this[Cs]&&!this.listeners("error").length)&&super.emit("error",i);return this[Qr](),t}if("resume"===t){const t=super.emit("resume");return this[Qr](),t}if("finish"===t||"prefinish"===t){const e=super.emit(t);return this.removeAllListeners(t),e}const r=super.emit(t,...e);return this[Qr](),r}[ws](t){for(const e of this[ps])!1===e.dest.write(t)&&this.pause();const e=!this[xs]&&super.emit("data",t);return this[Qr](),e}[Ss](){return!this[ts]&&(this[ts]=!0,this.readable=!1,this[ks]?(Is((()=>this[_s]())),!0):this[_s]())}[_s](){if(this[cs]){const t=this[cs].end();if(t){for(const e of this[ps])e.dest.write(t);this[xs]||super.emit("data",t)}}for(const t of this[ps])t.end();const t=super.emit("end");return this.removeAllListeners("end"),t}async collect(){const t=Object.assign([],{dataLength:0});this[ys]||(t.dataLength=0);const e=this.promise();return this.on("data",(e=>{t.push(e),this[ys]||(t.dataLength+=e.length)})),await e,t}async concat(){if(this[ys])throw new Error("cannot concat in objectMode");const t=await this.collect();return this[as]?t.join(""):Buffer.concat(t,t.dataLength)}async promise(){return new Promise(((t,e)=>{this.on(vs,(()=>e(new Error("stream destroyed")))),this.on("error",(t=>e(t))),this.on("end",(()=>t()))}))}[Symbol.asyncIterator](){this[xs]=!1;let t=!1;const e=async()=>(this.pause(),t=!0,{value:void 0,done:!0});return{next:()=>{if(t)return e();const i=this.read();if(null!==i)return Promise.resolve({done:!1,value:i});if(this[Zr])return e();let r,s;const n=t=>{this.off("data",o),this.off("end",a),this.off(vs,c),e(),s(t)},o=t=>{this.off("error",n),this.off("end",a),this.off(vs,c),this.pause(),r({value:t,done:!!this[Zr]})},a=()=>{this.off("error",n),this.off("data",o),this.off(vs,c),e(),r({done:!0,value:void 0})},c=()=>n(new Error("stream destroyed"));return new Promise(((t,e)=>{s=e,r=t,this.once(vs,c),this.once("error",n),this.once("end",a),this.once("data",o)}))},throw:e,return:e,[Symbol.asyncIterator](){return this}}}[Symbol.iterator](){this[xs]=!1;let t=!1;const e=()=>(this.pause(),this.off(bs,e),this.off(vs,e),this.off("end",e),t=!0,{done:!0,value:void 0});return this.once("end",e),this.once(bs,e),this.once(vs,e),{next:()=>{if(t)return e();const i=this.read();return null===i?e():{done:!1,value:i}},throw:e,return:e,[Symbol.iterator](){return this}}}destroy(t){if(this[vs])return t?this.emit("error",t):this.emit(vs),this;this[vs]=!0,this[xs]=!0,this[ds].length=0,this[fs]=0;return"function"!=typeof this.close||this[rs]||this.close(),t?this.emit("error",t):this.emit(vs),this}static get isStream(){return Kr}}const Ms=e.realpathSync.native,Fs={lstatSync:e.lstatSync,readdir:e.readdir,readdirSync:e.readdirSync,readlinkSync:e.readlinkSync,realpathSync:Ms,promises:{lstat:s.lstat,readdir:s.readdir,readlink:s.readlink,realpath:s.realpath}},Ds=t=>t&&t!==Fs&&t!==l?{...Fs,...t,promises:{...Fs.promises,...t.promises||{}}}:Fs,Bs=/^\\\\\?\\([a-z]:)\\?$/i,Us=/[\\\/]/,Gs=10,js=15,$s=-16,Ps=128,qs=256,zs=512,Ws=t=>t.isFile()?8:t.isDirectory()?4:t.isSymbolicLink()?Gs:t.isCharacterDevice()?2:t.isBlockDevice()?6:t.isSocket()?12:t.isFIFO()?1:0,Hs=new Map,Ys=t=>{const e=Hs.get(t);if(e)return e;const i=t.normalize("NFKD");return Hs.set(t,i),i},Js=new Map,Ks=t=>{const e=Js.get(t);if(e)return e;const i=Ys(t.toLowerCase());return Js.set(t,i),i};class Vs extends Yr{constructor(){super({max:256})}}class Xs extends Yr{constructor(t=16384){super({maxSize:t,sizeCalculation:t=>t.length+1})}}const Zs=Symbol("PathScurry setAsCwd");class Qs{name;root;roots;parent;nocase;#et;#it;get dev(){return this.#it}#rt;get mode(){return this.#rt}#st;get nlink(){return this.#st}#nt;get uid(){return this.#nt}#ot;get gid(){return this.#ot}#at;get rdev(){return this.#at}#ct;get blksize(){return this.#ct}#lt;get ino(){return this.#lt}#S;get size(){return this.#S}#ht;get blocks(){return this.#ht}#ut;get atimeMs(){return this.#ut}#dt;get mtimeMs(){return this.#dt}#pt;get ctimeMs(){return this.#pt}#ft;get birthtimeMs(){return this.#ft}#gt;get atime(){return this.#gt}#mt;get mtime(){return this.#mt}#yt;get ctime(){return this.#yt}#vt;get birthtime(){return this.#vt}#bt;#wt;#St;#_t;#kt;#Et;#At;#Ct;#Rt;#xt;get path(){return(this.parent||this).fullpath()}constructor(t,e=0,i,r,s,n,o){this.name=t,this.#bt=s?Ks(t):Ys(t),this.#At=1023&e,this.nocase=s,this.roots=r,this.root=i||this,this.#Ct=n,this.#St=o.fullpath,this.#kt=o.relative,this.#Et=o.relativePosix,this.parent=o.parent,this.parent?this.#et=this.parent.#et:this.#et=Ds(o.fs)}depth(){return void 0!==this.#wt?this.#wt:this.parent?this.#wt=this.parent.depth()+1:this.#wt=0}childrenCache(){return this.#Ct}resolve(t){if(!t)return this;const e=this.getRootString(t),i=t.substring(e.length).split(this.splitSep);return e?this.getRoot(e).#It(i):this.#It(i)}#It(t){let e=this;for(const i of t)e=e.child(i);return e}children(){const t=this.#Ct.get(this);if(t)return t;const e=Object.assign([],{provisional:0});return this.#Ct.set(this,e),this.#At&=-17,e}child(t,e){if(""===t||"."===t)return this;if(".."===t)return this.parent||this;const i=this.children(),r=this.nocase?Ks(t):Ys(t);for(const t of i)if(t.#bt===r)return t;const s=this.parent?this.sep:"",n=this.#St?this.#St+s+t:void 0,o=this.newChild(t,0,{...e,parent:this,fullpath:n});return this.canReaddir()||(o.#At|=Ps),i.push(o),o}relative(){if(void 0!==this.#kt)return this.#kt;const t=this.name,e=this.parent;if(!e)return this.#kt=this.name;const i=e.relative();return i+(i&&e.parent?this.sep:"")+t}relativePosix(){if("/"===this.sep)return this.relative();if(void 0!==this.#Et)return this.#Et;const t=this.name,e=this.parent;if(!e)return this.#Et=this.fullpathPosix();const i=e.relativePosix();return i+(i&&e.parent?"/":"")+t}fullpath(){if(void 0!==this.#St)return this.#St;const t=this.name,e=this.parent;if(!e)return this.#St=this.name;const i=e.fullpath()+(e.parent?this.sep:"")+t;return this.#St=i}fullpathPosix(){if(void 0!==this.#_t)return this.#_t;if("/"===this.sep)return this.#_t=this.fullpath();if(!this.parent){const t=this.fullpath().replace(/\\/g,"/");return/^[a-z]:\//i.test(t)?this.#_t=`//?/${t}`:this.#_t=t}const t=this.parent,e=t.fullpathPosix(),i=e+(e&&t.parent?"/":"")+this.name;return this.#_t=i}isUnknown(){return!(this.#At&js)}isType(t){return this[`is${t}`]()}getType(){return this.isUnknown()?"Unknown":this.isDirectory()?"Directory":this.isFile()?"File":this.isSymbolicLink()?"SymbolicLink":this.isFIFO()?"FIFO":this.isCharacterDevice()?"CharacterDevice":this.isBlockDevice()?"BlockDevice":this.isSocket()?"Socket":"Unknown"}isFile(){return 8==(this.#At&js)}isDirectory(){return 4==(this.#At&js)}isCharacterDevice(){return 2==(this.#At&js)}isBlockDevice(){return 6==(this.#At&js)}isFIFO(){return 1==(this.#At&js)}isSocket(){return 12==(this.#At&js)}isSymbolicLink(){return(this.#At&Gs)===Gs}lstatCached(){return 32&this.#At?this:void 0}readlinkCached(){return this.#Rt}realpathCached(){return this.#xt}readdirCached(){const t=this.children();return t.slice(0,t.provisional)}canReadlink(){if(this.#Rt)return!0;if(!this.parent)return!1;const t=this.#At&js;return!(0!==t&&t!==Gs||this.#At&qs||this.#At&Ps)}calledReaddir(){return!!(16&this.#At)}isENOENT(){return!!(this.#At&Ps)}isNamed(t){return this.nocase?this.#bt===Ks(t):this.#bt===Ys(t)}async readlink(){const t=this.#Rt;if(t)return t;if(this.canReadlink()&&this.parent)try{const t=await this.#et.promises.readlink(this.fullpath()),e=(await this.parent.realpath())?.resolve(t);if(e)return this.#Rt=e}catch(t){return void this.#Nt(t.code)}}readlinkSync(){const t=this.#Rt;if(t)return t;if(this.canReadlink()&&this.parent)try{const t=this.#et.readlinkSync(this.fullpath()),e=this.parent.realpathSync()?.resolve(t);if(e)return this.#Rt=e}catch(t){return void this.#Nt(t.code)}}#Tt(t){this.#At|=16;for(let e=t.provisional;e<t.length;e++){const i=t[e];i&&i.#Ot()}}#Ot(){this.#At&Ps||(this.#At=(this.#At|Ps)&$s,this.#Lt())}#Lt(){const t=this.children();t.provisional=0;for(const e of t)e.#Ot()}#Mt(){this.#At|=zs,this.#Ft()}#Ft(){if(64&this.#At)return;let t=this.#At;4==(t&js)&&(t&=$s),this.#At=64|t,this.#Lt()}#Dt(t=""){"ENOTDIR"===t||"EPERM"===t?this.#Ft():"ENOENT"===t?this.#Ot():this.children().provisional=0}#Bt(t=""){if("ENOTDIR"===t){this.parent.#Ft()}else"ENOENT"===t&&this.#Ot()}#Nt(t=""){let e=this.#At;e|=qs,"ENOENT"===t&&(e|=Ps),"EINVAL"!==t&&"UNKNOWN"!==t||(e&=$s),this.#At=e,"ENOTDIR"===t&&this.parent&&this.parent.#Ft()}#Ut(t,e){return this.#Gt(t,e)||this.#jt(t,e)}#jt(t,e){const i=Ws(t),r=this.newChild(t.name,i,{parent:this}),s=r.#At&js;return 4!==s&&s!==Gs&&0!==s&&(r.#At|=64),e.unshift(r),e.provisional++,r}#Gt(t,e){for(let i=e.provisional;i<e.length;i++){const r=e[i];if((this.nocase?Ks(t.name):Ys(t.name))===r.#bt)return this.#$t(t,r,i,e)}}#$t(t,e,i,r){const s=e.name;return e.#At=e.#At&$s|Ws(t),s!==t.name&&(e.name=t.name),i!==r.provisional&&(i===r.length-1?r.pop():r.splice(i,1),r.unshift(e)),r.provisional++,e}async lstat(){if(!(this.#At&Ps))try{return this.#Pt(await this.#et.promises.lstat(this.fullpath())),this}catch(t){this.#Bt(t.code)}}lstatSync(){if(!(this.#At&Ps))try{return this.#Pt(this.#et.lstatSync(this.fullpath())),this}catch(t){this.#Bt(t.code)}}#Pt(t){const{atime:e,atimeMs:i,birthtime:r,birthtimeMs:s,blksize:n,blocks:o,ctime:a,ctimeMs:c,dev:l,gid:h,ino:u,mode:d,mtime:p,mtimeMs:f,nlink:g,rdev:m,size:y,uid:v}=t;this.#gt=e,this.#ut=i,this.#vt=r,this.#ft=s,this.#ct=n,this.#ht=o,this.#yt=a,this.#pt=c,this.#it=l,this.#ot=h,this.#lt=u,this.#rt=d,this.#mt=p,this.#dt=f,this.#st=g,this.#at=m,this.#S=y,this.#nt=v;const b=Ws(t);this.#At=this.#At&$s|b|32,0!==b&&4!==b&&b!==Gs&&(this.#At|=64)}#qt=[];#zt=!1;#Wt(t){this.#zt=!1;const e=this.#qt.slice();this.#qt.length=0,e.forEach((e=>e(null,t)))}readdirCB(t,e=!1){if(!this.canReaddir())return void(e?t(null,[]):queueMicrotask((()=>t(null,[]))));const i=this.children();if(this.calledReaddir()){const r=i.slice(0,i.provisional);return void(e?t(null,r):queueMicrotask((()=>t(null,r))))}if(this.#qt.push(t),this.#zt)return;this.#zt=!0;const r=this.fullpath();this.#et.readdir(r,{withFileTypes:!0},((t,e)=>{if(t)this.#Dt(t.code),i.provisional=0;else{for(const t of e)this.#Ut(t,i);this.#Tt(i)}this.#Wt(i.slice(0,i.provisional))}))}#Ht;async readdir(){if(!this.canReaddir())return[];const t=this.children();if(this.calledReaddir())return t.slice(0,t.provisional);const e=this.fullpath();if(this.#Ht)await this.#Ht;else{let i=()=>{};this.#Ht=new Promise((t=>i=t));try{for(const i of await this.#et.promises.readdir(e,{withFileTypes:!0}))this.#Ut(i,t);this.#Tt(t)}catch(e){this.#Dt(e.code),t.provisional=0}this.#Ht=void 0,i()}return t.slice(0,t.provisional)}readdirSync(){if(!this.canReaddir())return[];const t=this.children();if(this.calledReaddir())return t.slice(0,t.provisional);const e=this.fullpath();try{for(const i of this.#et.readdirSync(e,{withFileTypes:!0}))this.#Ut(i,t);this.#Tt(t)}catch(e){this.#Dt(e.code),t.provisional=0}return t.slice(0,t.provisional)}canReaddir(){if(704&this.#At)return!1;const t=js&this.#At;return 0===t||4===t||t===Gs}shouldWalk(t,e){return!(4&~this.#At)&&!(704&this.#At)&&!t.has(this)&&(!e||e(this))}async realpath(){if(this.#xt)return this.#xt;if(!(896&this.#At))try{const t=await this.#et.promises.realpath(this.fullpath());return this.#xt=this.resolve(t)}catch(t){this.#Mt()}}realpathSync(){if(this.#xt)return this.#xt;if(!(896&this.#At))try{const t=this.#et.realpathSync(this.fullpath());return this.#xt=this.resolve(t)}catch(t){this.#Mt()}}[Zs](t){if(t===this)return;const e=new Set([]);let i=[],r=this;for(;r&&r.parent;)e.add(r),r.#kt=i.join(this.sep),r.#Et=i.join("/"),r=r.parent,i.push("..");for(r=t;r&&r.parent&&!e.has(r);)r.#kt=void 0,r.#Et=void 0,r=r.parent}}class tn extends Qs{sep="\\";splitSep=Us;constructor(t,e=0,i,r,s,n,o){super(t,e,i,r,s,n,o)}newChild(t,e=0,i={}){return new tn(t,e,this.root,this.roots,this.nocase,this.childrenCache(),i)}getRootString(t){return i.win32.parse(t).root}getRoot(t){if((t=(t=>t.replace(/\//g,"\\").replace(Bs,"$1\\"))(t.toUpperCase()))===this.root.name)return this.root;for(const[e,i]of Object.entries(this.roots))if(this.sameRoot(t,e))return this.roots[t]=i;return this.roots[t]=new sn(t,this).root}sameRoot(t,e=this.root.name){return(t=t.toUpperCase().replace(/\//g,"\\").replace(Bs,"$1\\"))===e}}class en extends Qs{splitSep="/";sep="/";constructor(t,e=0,i,r,s,n,o){super(t,e,i,r,s,n,o)}getRootString(t){return t.startsWith("/")?"/":""}getRoot(t){return this.root}newChild(t,e=0,i={}){return new en(t,e,this.root,this.roots,this.nocase,this.childrenCache(),i)}}class rn{root;rootPath;roots;cwd;#Yt;#Jt;#Ct;nocase;#et;constructor(t=process.cwd(),e,i,{nocase:s,childrenCacheSize:n=16384,fs:o=Fs}={}){this.#et=Ds(o),(t instanceof URL||t.startsWith("file://"))&&(t=r.fileURLToPath(t));const a=e.resolve(t);this.roots=Object.create(null),this.rootPath=this.parseRootPath(a),this.#Yt=new Vs,this.#Jt=new Vs,this.#Ct=new Xs(n);const c=a.substring(this.rootPath.length).split(i);if(1!==c.length||c[0]||c.pop(),void 0===s)throw new TypeError("must provide nocase setting to PathScurryBase ctor");this.nocase=s,this.root=this.newRoot(this.#et),this.roots[this.rootPath]=this.root;let l=this.root,h=c.length-1;const u=e.sep;let d=this.rootPath,p=!1;for(const t of c){const e=h--;l=l.child(t,{relative:new Array(e).fill("..").join(u),relativePosix:new Array(e).fill("..").join("/"),fullpath:d+=(p?"":u)+t}),p=!0}this.cwd=l}depth(t=this.cwd){return"string"==typeof t&&(t=this.cwd.resolve(t)),t.depth()}childrenCache(){return this.#Ct}resolve(...t){let e="";for(let i=t.length-1;i>=0;i--){const r=t[i];if(r&&"."!==r&&(e=e?`${r}/${e}`:r,this.isAbsolute(r)))break}const i=this.#Yt.get(e);if(void 0!==i)return i;const r=this.cwd.resolve(e).fullpath();return this.#Yt.set(e,r),r}resolvePosix(...t){let e="";for(let i=t.length-1;i>=0;i--){const r=t[i];if(r&&"."!==r&&(e=e?`${r}/${e}`:r,this.isAbsolute(r)))break}const i=this.#Jt.get(e);if(void 0!==i)return i;const r=this.cwd.resolve(e).fullpathPosix();return this.#Jt.set(e,r),r}relative(t=this.cwd){return"string"==typeof t&&(t=this.cwd.resolve(t)),t.relative()}relativePosix(t=this.cwd){return"string"==typeof t&&(t=this.cwd.resolve(t)),t.relativePosix()}basename(t=this.cwd){return"string"==typeof t&&(t=this.cwd.resolve(t)),t.name}dirname(t=this.cwd){return"string"==typeof t&&(t=this.cwd.resolve(t)),(t.parent||t).fullpath()}async readdir(t=this.cwd,e={withFileTypes:!0}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof Qs||(e=t,t=this.cwd);const{withFileTypes:i}=e;if(t.canReaddir()){const e=await t.readdir();return i?e:e.map((t=>t.name))}return[]}readdirSync(t=this.cwd,e={withFileTypes:!0}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof Qs||(e=t,t=this.cwd);const{withFileTypes:i=!0}=e;return t.canReaddir()?i?t.readdirSync():t.readdirSync().map((t=>t.name)):[]}async lstat(t=this.cwd){return"string"==typeof t&&(t=this.cwd.resolve(t)),t.lstat()}lstatSync(t=this.cwd){return"string"==typeof t&&(t=this.cwd.resolve(t)),t.lstatSync()}async readlink(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof Qs||(e=t.withFileTypes,t=this.cwd);const i=await t.readlink();return e?i:i?.fullpath()}readlinkSync(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof Qs||(e=t.withFileTypes,t=this.cwd);const i=t.readlinkSync();return e?i:i?.fullpath()}async realpath(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof Qs||(e=t.withFileTypes,t=this.cwd);const i=await t.realpath();return e?i:i?.fullpath()}realpathSync(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof Qs||(e=t.withFileTypes,t=this.cwd);const i=t.realpathSync();return e?i:i?.fullpath()}async walk(t=this.cwd,e={}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof Qs||(e=t,t=this.cwd);const{withFileTypes:i=!0,follow:r=!1,filter:s,walkFilter:n}=e,o=[];s&&!s(t)||o.push(i?t:t.fullpath());const a=new Set,c=(t,e)=>{a.add(t),t.readdirCB(((t,l)=>{if(t)return e(t);let h=l.length;if(!h)return e();const u=()=>{0==--h&&e()};for(const t of l)s&&!s(t)||o.push(i?t:t.fullpath()),r&&t.isSymbolicLink()?t.realpath().then((t=>t?.isUnknown()?t.lstat():t)).then((t=>t?.shouldWalk(a,n)?c(t,u):u())):t.shouldWalk(a,n)?c(t,u):u()}),!0)},l=t;return new Promise(((t,e)=>{c(l,(i=>{if(i)return e(i);t(o)}))}))}walkSync(t=this.cwd,e={}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof Qs||(e=t,t=this.cwd);const{withFileTypes:i=!0,follow:r=!1,filter:s,walkFilter:n}=e,o=[];s&&!s(t)||o.push(i?t:t.fullpath());const a=new Set([t]);for(const t of a){const e=t.readdirSync();for(const t of e){s&&!s(t)||o.push(i?t:t.fullpath());let e=t;if(t.isSymbolicLink()){if(!r||!(e=t.realpathSync()))continue;e.isUnknown()&&e.lstatSync()}e.shouldWalk(a,n)&&a.add(e)}}return o}[Symbol.asyncIterator](){return this.iterate()}iterate(t=this.cwd,e={}){return"string"==typeof t?t=this.cwd.resolve(t):t instanceof Qs||(e=t,t=this.cwd),this.stream(t,e)[Symbol.asyncIterator]()}[Symbol.iterator](){return this.iterateSync()}*iterateSync(t=this.cwd,e={}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof Qs||(e=t,t=this.cwd);const{withFileTypes:i=!0,follow:r=!1,filter:s,walkFilter:n}=e;s&&!s(t)||(yield i?t:t.fullpath());const o=new Set([t]);for(const t of o){const e=t.readdirSync();for(const t of e){s&&!s(t)||(yield i?t:t.fullpath());let e=t;if(t.isSymbolicLink()){if(!r||!(e=t.realpathSync()))continue;e.isUnknown()&&e.lstatSync()}e.shouldWalk(o,n)&&o.add(e)}}}stream(t=this.cwd,e={}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof Qs||(e=t,t=this.cwd);const{withFileTypes:i=!0,follow:r=!1,filter:s,walkFilter:n}=e,o=new Ls({objectMode:!0});s&&!s(t)||o.write(i?t:t.fullpath());const a=new Set,c=[t];let l=0;const h=()=>{let t=!1;for(;!t;){const e=c.shift();if(!e)return void(0===l&&o.end());l++,a.add(e);const u=(e,p,f=!1)=>{if(e)return o.emit("error",e);if(r&&!f){const t=[];for(const e of p)e.isSymbolicLink()&&t.push(e.realpath().then((t=>t?.isUnknown()?t.lstat():t)));if(t.length)return void Promise.all(t).then((()=>u(null,p,!0)))}for(const e of p)!e||s&&!s(e)||o.write(i?e:e.fullpath())||(t=!0);l--;for(const t of p){const e=t.realpathCached()||t;e.shouldWalk(a,n)&&c.push(e)}t&&!o.flowing?o.once("drain",h):d||h()};let d=!0;e.readdirCB(u,!0),d=!1}};return h(),o}streamSync(t=this.cwd,e={}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof Qs||(e=t,t=this.cwd);const{withFileTypes:i=!0,follow:r=!1,filter:s,walkFilter:n}=e,o=new Ls({objectMode:!0}),a=new Set;s&&!s(t)||o.write(i?t:t.fullpath());const c=[t];let l=0;const h=()=>{let t=!1;for(;!t;){const e=c.shift();if(!e)return void(0===l&&o.end());l++,a.add(e);const h=e.readdirSync();for(const e of h)s&&!s(e)||o.write(i?e:e.fullpath())||(t=!0);l--;for(const t of h){let e=t;if(t.isSymbolicLink()){if(!r||!(e=t.realpathSync()))continue;e.isUnknown()&&e.lstatSync()}e.shouldWalk(a,n)&&c.push(e)}}t&&!o.flowing&&o.once("drain",h)};return h(),o}chdir(t=this.cwd){const e=this.cwd;this.cwd="string"==typeof t?this.cwd.resolve(t):t,this.cwd[Zs](e)}}class sn extends rn{sep="\\";constructor(t=process.cwd(),e={}){const{nocase:r=!0}=e;super(t,i.win32,"\\",{...e,nocase:r}),this.nocase=r;for(let t=this.cwd;t;t=t.parent)t.nocase=this.nocase}parseRootPath(t){return i.win32.parse(t).root.toUpperCase()}newRoot(t){return new tn(this.rootPath,4,void 0,this.roots,this.nocase,this.childrenCache(),{fs:t})}isAbsolute(t){return t.startsWith("/")||t.startsWith("\\")||/^[a-z]:(\/|\\)/i.test(t)}}class nn extends rn{sep="/";constructor(t=process.cwd(),e={}){const{nocase:r=!1}=e;super(t,i.posix,"/",{...e,nocase:r}),this.nocase=r}parseRootPath(t){return"/"}newRoot(t){return new en(this.rootPath,4,void 0,this.roots,this.nocase,this.childrenCache(),{fs:t})}isAbsolute(t){return t.startsWith("/")}}class on extends nn{constructor(t=process.cwd(),e={}){const{nocase:i=!0}=e;super(t,{...e,nocase:i})}}process.platform;const an="win32"===process.platform?sn:"darwin"===process.platform?on:nn;class cn{#Kt;#Vt;#Xt;length;#Zt;#Qt;#te;#ee;#ie;#re;#se=!0;constructor(t,e,i,r){if(!(t.length>=1))throw new TypeError("empty pattern list");if(!(e.length>=1))throw new TypeError("empty glob list");if(e.length!==t.length)throw new TypeError("mismatched pattern list and glob list lengths");if(this.length=t.length,i<0||i>=this.length)throw new TypeError("index out of range");if(this.#Kt=t,this.#Vt=e,this.#Xt=i,this.#Zt=r,0===this.#Xt)if(this.isUNC()){const[t,e,i,r,...s]=this.#Kt,[n,o,a,c,...l]=this.#Vt;""===s[0]&&(s.shift(),l.shift());const h=[t,e,i,r,""].join("/"),u=[n,o,a,c,""].join("/");this.#Kt=[h,...s],this.#Vt=[u,...l],this.length=this.#Kt.length}else if(this.isDrive()||this.isAbsolute()){const[t,...e]=this.#Kt,[i,...r]=this.#Vt;""===e[0]&&(e.shift(),r.shift());const s=t+"/",n=i+"/";this.#Kt=[s,...e],this.#Vt=[n,...r],this.length=this.#Kt.length}}pattern(){return this.#Kt[this.#Xt]}isString(){return"string"==typeof this.#Kt[this.#Xt]}isGlobstar(){return this.#Kt[this.#Xt]===Or}isRegExp(){return this.#Kt[this.#Xt]instanceof RegExp}globString(){return this.#te=this.#te||(0===this.#Xt?this.isAbsolute()?this.#Vt[0]+this.#Vt.slice(1).join("/"):this.#Vt.join("/"):this.#Vt.slice(this.#Xt).join("/"))}hasMore(){return this.length>this.#Xt+1}rest(){return void 0!==this.#Qt?this.#Qt:this.hasMore()?(this.#Qt=new cn(this.#Kt,this.#Vt,this.#Xt+1,this.#Zt),this.#Qt.#re=this.#re,this.#Qt.#ie=this.#ie,this.#Qt.#ee=this.#ee,this.#Qt):this.#Qt=null}isUNC(){const t=this.#Kt;return void 0!==this.#ie?this.#ie:this.#ie="win32"===this.#Zt&&0===this.#Xt&&""===t[0]&&""===t[1]&&"string"==typeof t[2]&&!!t[2]&&"string"==typeof t[3]&&!!t[3]}isDrive(){const t=this.#Kt;return void 0!==this.#ee?this.#ee:this.#ee="win32"===this.#Zt&&0===this.#Xt&&this.length>1&&"string"==typeof t[0]&&/^[a-z]:$/i.test(t[0])}isAbsolute(){const t=this.#Kt;return void 0!==this.#re?this.#re:this.#re=""===t[0]&&t.length>1||this.isDrive()||this.isUNC()}root(){const t=this.#Kt[0];return"string"==typeof t&&this.isAbsolute()&&0===this.#Xt?t:""}checkFollowGlobstar(){return!(0===this.#Xt||!this.isGlobstar()||!this.#se)}markFollowGlobstar(){return!(0===this.#Xt||!this.isGlobstar()||!this.#se)&&(this.#se=!1,!0)}}const ln="object"==typeof process&&process&&"string"==typeof process.platform?process.platform:"linux";class hn{relative;relativeChildren;absolute;absoluteChildren;constructor(t,{nobrace:e,nocase:i,noext:r,noglobstar:s,platform:n=ln}){this.relative=[],this.absolute=[],this.relativeChildren=[],this.absoluteChildren=[];const o={dot:!0,nobrace:e,nocase:i,noext:r,noglobstar:s,optimizationLevel:2,platform:n,nocomment:!0,nonegate:!0};for(const e of t){const t=new Dr(e,o);for(let e=0;e<t.set.length;e++){const i=t.set[e],r=t.globParts[e];if(!i||!r)throw new Error("invalid pattern object");for(;"."===i[0]&&"."===r[0];)i.shift(),r.shift();const s=new cn(i,r,0,n),a=new Dr(s.globString(),o),c="**"===r[r.length-1],l=s.isAbsolute();l?this.absolute.push(a):this.relative.push(a),c&&(l?this.absoluteChildren.push(a):this.relativeChildren.push(a))}}}ignored(t){const e=t.fullpath(),i=`${e}/`,r=t.relative()||".",s=`${r}/`;for(const t of this.relative)if(t.match(r)||t.match(s))return!0;for(const t of this.absolute)if(t.match(e)||t.match(i))return!0;return!1}childrenIgnored(t){const e=t.fullpath()+"/",i=(t.relative()||".")+"/";for(const t of this.relativeChildren)if(t.match(i))return!0;for(const t of this.absoluteChildren)if(t.match(e))return!0;return!1}}class un{store;constructor(t=new Map){this.store=t}copy(){return new un(new Map(this.store))}hasWalked(t,e){return this.store.get(t.fullpath())?.has(e.globString())}storeWalked(t,e){const i=t.fullpath(),r=this.store.get(i);r?r.add(e.globString()):this.store.set(i,new Set([e.globString()]))}}class dn{store=new Map;add(t,e,i){const r=(e?2:0)|(i?1:0),s=this.store.get(t);this.store.set(t,void 0===s?r:r&s)}entries(){return[...this.store.entries()].map((([t,e])=>[t,!!(2&e),!!(1&e)]))}}class pn{store=new Map;add(t,e){if(!t.canReaddir())return;const i=this.store.get(t);i?i.find((t=>t.globString()===e.globString()))||i.push(e):this.store.set(t,[e])}get(t){const e=this.store.get(t);if(!e)throw new Error("attempting to walk unknown path");return e}entries(){return this.keys().map((t=>[t,this.store.get(t)]))}keys(){return[...this.store.keys()].filter((t=>t.canReaddir()))}}class fn{hasWalkedCache;matches=new dn;subwalks=new pn;patterns;follow;dot;opts;constructor(t,e){this.opts=t,this.follow=!!t.follow,this.dot=!!t.dot,this.hasWalkedCache=e?e.copy():new un}processPatterns(t,e){this.patterns=e;const i=e.map((e=>[t,e]));for(let[t,e]of i){this.hasWalkedCache.storeWalked(t,e);const i=e.root(),r=e.isAbsolute()&&!1!==this.opts.absolute;if(i){t=t.resolve("/"===i&&void 0!==this.opts.root?this.opts.root:i);const r=e.rest();if(!r){this.matches.add(t,!0,!1);continue}e=r}if(t.isENOENT())continue;let s,n,o=!1;for(;"string"==typeof(s=e.pattern())&&(n=e.rest());){const i=t.resolve(s);t=i,e=n,o=!0}if(s=e.pattern(),n=e.rest(),o){if(this.hasWalkedCache.hasWalked(t,e))continue;this.hasWalkedCache.storeWalked(t,e)}if("string"!=typeof s)if(s===Or){(!t.isSymbolicLink()||this.follow||e.checkFollowGlobstar())&&this.subwalks.add(t,e);const i=n?.pattern(),s=n?.rest();if(n&&(""!==i&&"."!==i||s)){if(".."===i){const e=t.parent||t;s?this.hasWalkedCache.hasWalked(e,s)||this.subwalks.add(e,s):this.matches.add(e,r,!0)}}else this.matches.add(t,r,""===i||"."===i)}else s instanceof RegExp&&this.subwalks.add(t,e);else{const e=".."===s||""===s||"."===s;this.matches.add(t.resolve(s),r,e)}}return this}subwalkTargets(){return this.subwalks.keys()}child(){return new fn(this.opts,this.hasWalkedCache)}filterEntries(t,e){const i=this.subwalks.get(t),r=this.child();for(const t of e)for(const e of i){const i=e.isAbsolute(),s=e.pattern(),n=e.rest();s===Or?r.testGlobstar(t,e,n,i):s instanceof RegExp?r.testRegExp(t,s,n,i):r.testString(t,s,n,i)}return r}testGlobstar(t,e,i,r){if(!this.dot&&t.name.startsWith(".")||(e.hasMore()||this.matches.add(t,r,!1),t.canReaddir()&&(this.follow||!t.isSymbolicLink()?this.subwalks.add(t,e):t.isSymbolicLink()&&(i&&e.checkFollowGlobstar()?this.subwalks.add(t,i):e.markFollowGlobstar()&&this.subwalks.add(t,e)))),i){const e=i.pattern();if("string"==typeof e&&".."!==e&&""!==e&&"."!==e)this.testString(t,e,i.rest(),r);else if(".."===e){const e=t.parent||t;this.subwalks.add(e,i)}else e instanceof RegExp&&this.testRegExp(t,e,i.rest(),r)}}testRegExp(t,e,i,r){e.test(t.name)&&(i?this.subwalks.add(t,i):this.matches.add(t,r,!1))}testString(t,e,i,r){t.isNamed(e)&&(i?this.subwalks.add(t,i):this.matches.add(t,r,!1))}}class gn{path;patterns;opts;seen=new Set;paused=!1;aborted=!1;#ne=[];#oe;#ae;signal;maxDepth;constructor(t,e,i){this.patterns=t,this.path=e,this.opts=i,this.#ae=i.posix||"win32"!==i.platform?"/":"\\",i.ignore&&(this.#oe=((t,e)=>"string"==typeof t?new hn([t],e):Array.isArray(t)?new hn(t,e):t)(i.ignore,i)),this.maxDepth=i.maxDepth||1/0,i.signal&&(this.signal=i.signal,this.signal.addEventListener("abort",(()=>{this.#ne.length=0})))}#ce(t){return this.seen.has(t)||!!this.#oe?.ignored?.(t)}#le(t){return!!this.#oe?.childrenIgnored?.(t)}pause(){this.paused=!0}resume(){if(this.signal?.aborted)return;let t;for(this.paused=!1;!this.paused&&(t=this.#ne.shift());)t()}onResume(t){this.signal?.aborted||(this.paused?this.#ne.push(t):t())}async matchCheck(t,e){if(e&&this.opts.nodir)return;let i;if(this.opts.realpath){if(i=t.realpathCached()||await t.realpath(),!i)return;t=i}const r=t.isUnknown()||this.opts.stat?await t.lstat():t;if(this.opts.follow&&this.opts.nodir&&r?.isSymbolicLink()){const t=await r.realpath();t&&(t.isUnknown()||this.opts.stat)&&await t.lstat()}return this.matchCheckTest(r,e)}matchCheckTest(t,e){return!t||!(this.maxDepth===1/0||t.depth()<=this.maxDepth)||e&&!t.canReaddir()||this.opts.nodir&&t.isDirectory()||this.opts.nodir&&this.opts.follow&&t.isSymbolicLink()&&t.realpathCached()?.isDirectory()||this.#ce(t)?void 0:t}matchCheckSync(t,e){if(e&&this.opts.nodir)return;let i;if(this.opts.realpath){if(i=t.realpathCached()||t.realpathSync(),!i)return;t=i}const r=t.isUnknown()||this.opts.stat?t.lstatSync():t;if(this.opts.follow&&this.opts.nodir&&r?.isSymbolicLink()){const t=r.realpathSync();t&&(t?.isUnknown()||this.opts.stat)&&t.lstatSync()}return this.matchCheckTest(r,e)}matchFinish(t,e){if(this.#ce(t))return;const i=void 0===this.opts.absolute?e:this.opts.absolute;this.seen.add(t);const r=this.opts.mark&&t.isDirectory()?this.#ae:"";if(this.opts.withFileTypes)this.matchEmit(t);else if(i){const e=this.opts.posix?t.fullpathPosix():t.fullpath();this.matchEmit(e+r)}else{const e=this.opts.posix?t.relativePosix():t.relative(),i=this.opts.dotRelative&&!e.startsWith(".."+this.#ae)?"."+this.#ae:"";this.matchEmit(e?i+e+r:"."+r)}}async match(t,e,i){const r=await this.matchCheck(t,i);r&&this.matchFinish(r,e)}matchSync(t,e,i){const r=this.matchCheckSync(t,i);r&&this.matchFinish(r,e)}walkCB(t,e,i){this.signal?.aborted&&i(),this.walkCB2(t,e,new fn(this.opts),i)}walkCB2(t,e,i,r){if(this.#le(t))return r();if(this.signal?.aborted&&r(),this.paused)return void this.onResume((()=>this.walkCB2(t,e,i,r)));i.processPatterns(t,e);let s=1;const n=()=>{0==--s&&r()};for(const[t,e,r]of i.matches.entries())this.#ce(t)||(s++,this.match(t,e,r).then((()=>n())));for(const t of i.subwalkTargets()){if(this.maxDepth!==1/0&&t.depth()>=this.maxDepth)continue;s++;const e=t.readdirCached();t.calledReaddir()?this.walkCB3(t,e,i,n):t.readdirCB(((e,r)=>this.walkCB3(t,r,i,n)),!0)}n()}walkCB3(t,e,i,r){i=i.filterEntries(t,e);let s=1;const n=()=>{0==--s&&r()};for(const[t,e,r]of i.matches.entries())this.#ce(t)||(s++,this.match(t,e,r).then((()=>n())));for(const[t,e]of i.subwalks.entries())s++,this.walkCB2(t,e,i.child(),n);n()}walkCBSync(t,e,i){this.signal?.aborted&&i(),this.walkCB2Sync(t,e,new fn(this.opts),i)}walkCB2Sync(t,e,i,r){if(this.#le(t))return r();if(this.signal?.aborted&&r(),this.paused)return void this.onResume((()=>this.walkCB2Sync(t,e,i,r)));i.processPatterns(t,e);let s=1;const n=()=>{0==--s&&r()};for(const[t,e,r]of i.matches.entries())this.#ce(t)||this.matchSync(t,e,r);for(const t of i.subwalkTargets()){if(this.maxDepth!==1/0&&t.depth()>=this.maxDepth)continue;s++;const e=t.readdirSync();this.walkCB3Sync(t,e,i,n)}n()}walkCB3Sync(t,e,i,r){i=i.filterEntries(t,e);let s=1;const n=()=>{0==--s&&r()};for(const[t,e,r]of i.matches.entries())this.#ce(t)||this.matchSync(t,e,r);for(const[t,e]of i.subwalks.entries())s++,this.walkCB2Sync(t,e,i.child(),n);n()}}class mn extends gn{matches;constructor(t,e,i){super(t,e,i),this.matches=new Set}matchEmit(t){this.matches.add(t)}async walk(){if(this.signal?.aborted)throw this.signal.reason;return this.path.isUnknown()&&await this.path.lstat(),await new Promise(((t,e)=>{this.walkCB(this.path,this.patterns,(()=>{this.signal?.aborted?e(this.signal.reason):t(this.matches)}))})),this.matches}walkSync(){if(this.signal?.aborted)throw this.signal.reason;return this.path.isUnknown()&&this.path.lstatSync(),this.walkCBSync(this.path,this.patterns,(()=>{if(this.signal?.aborted)throw this.signal.reason})),this.matches}}class yn extends gn{results;constructor(t,e,i){super(t,e,i),this.results=new Ls({signal:this.signal,objectMode:!0}),this.results.on("drain",(()=>this.resume())),this.results.on("resume",(()=>this.resume()))}matchEmit(t){this.results.write(t),this.results.flowing||this.pause()}stream(){const t=this.path;return t.isUnknown()?t.lstat().then((()=>{this.walkCB(t,this.patterns,(()=>this.results.end()))})):this.walkCB(t,this.patterns,(()=>this.results.end())),this.results}streamSync(){return this.path.isUnknown()&&this.path.lstatSync(),this.walkCBSync(this.path,this.patterns,(()=>this.results.end())),this.results}}const vn="object"==typeof process&&process&&"string"==typeof process.platform?process.platform:"linux";class bn{absolute;cwd;root;dot;dotRelative;follow;ignore;magicalBraces;mark;matchBase;maxDepth;nobrace;nocase;nodir;noext;noglobstar;pattern;platform;realpath;scurry;stat;signal;windowsPathsNoEscape;withFileTypes;opts;patterns;constructor(t,e){if(!e)throw new TypeError("glob options required");if(this.withFileTypes=!!e.withFileTypes,this.signal=e.signal,this.follow=!!e.follow,this.dot=!!e.dot,this.dotRelative=!!e.dotRelative,this.nodir=!!e.nodir,this.mark=!!e.mark,e.cwd?(e.cwd instanceof URL||e.cwd.startsWith("file://"))&&(e.cwd=r.fileURLToPath(e.cwd)):this.cwd="",this.cwd=e.cwd||"",this.root=e.root,this.magicalBraces=!!e.magicalBraces,this.nobrace=!!e.nobrace,this.noext=!!e.noext,this.realpath=!!e.realpath,this.absolute=e.absolute,this.noglobstar=!!e.noglobstar,this.matchBase=!!e.matchBase,this.maxDepth="number"==typeof e.maxDepth?e.maxDepth:1/0,this.stat=!!e.stat,this.ignore=e.ignore,this.withFileTypes&&void 0!==this.absolute)throw new Error("cannot set absolute and withFileTypes:true");if("string"==typeof t&&(t=[t]),this.windowsPathsNoEscape=!!e.windowsPathsNoEscape||!1===e.allowWindowsEscape,this.windowsPathsNoEscape&&(t=t.map((t=>t.replace(/\\/g,"/")))),this.matchBase){if(e.noglobstar)throw new TypeError("base matching requires globstar");t=t.map((t=>t.includes("/")?t:`./**/${t}`))}if(this.pattern=t,this.platform=e.platform||vn,this.opts={...e,platform:this.platform},e.scurry){if(this.scurry=e.scurry,void 0!==e.nocase&&e.nocase!==e.scurry.nocase)throw new Error("nocase option contradicts provided scurry option")}else{const t="win32"===e.platform?sn:"darwin"===e.platform?on:e.platform?nn:an;this.scurry=new t(this.cwd,{nocase:e.nocase,fs:e.fs})}this.nocase=this.scurry.nocase;const i="darwin"===this.platform||"win32"===this.platform,s={...e,dot:this.dot,matchBase:this.matchBase,nobrace:this.nobrace,nocase:this.nocase,nocaseMagicOnly:i,nocomment:!0,noext:this.noext,nonegate:!0,optimizationLevel:2,platform:this.platform,windowsPathsNoEscape:this.windowsPathsNoEscape,debug:!!this.opts.debug},n=this.pattern.map((t=>new Dr(t,s))),[o,a]=n.reduce(((t,e)=>(t[0].push(...e.set),t[1].push(...e.globParts),t)),[[],[]]);this.patterns=o.map(((t,e)=>{const i=a[e];if(!i)throw new Error("invalid pattern object");return new cn(t,i,0,this.platform)}))}async walk(){return[...await new mn(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase}).walk()]}walkSync(){return[...new mn(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase}).walkSync()]}stream(){return new yn(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase}).stream()}streamSync(){return new yn(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase}).streamSync()}iterateSync(){return this.streamSync()[Symbol.iterator]()}[Symbol.iterator](){return this.iterateSync()}iterate(){return this.stream()[Symbol.asyncIterator]()}[Symbol.asyncIterator](){return this.iterate()}}function wn(t,e={}){return new bn(t,e).streamSync()}function Sn(t,e={}){return new bn(t,e).stream()}function _n(t,e={}){return new bn(t,e).walkSync()}async function kn(t,e={}){return new bn(t,e).walk()}function En(t,e={}){return new bn(t,e).iterateSync()}function An(t,e={}){return new bn(t,e).iterate()}const Cn=wn,Rn=Object.assign(Sn,{sync:wn}),xn=En,In=Object.assign(An,{sync:En}),Nn=Object.assign(_n,{stream:wn,iterate:En}),Tn=Object.assign(kn,{glob:kn,globSync:_n,sync:Nn,globStream:Sn,stream:Rn,globStreamSync:wn,streamSync:Cn,globIterate:An,iterate:In,globIterateSync:En,iterateSync:xn,Glob:bn,hasMagic:(t,e={})=>{Array.isArray(t)||(t=[t]);for(const i of t)if(new Dr(i,e).hasMagic())return!0;return!1},escape:lr,unescape:Zi});function On(t){return t.split(".").slice(0,-1).join(".")}function Ln(t){const e=t.split("-");return[e.slice(0,-1).join("-"),e[e.length-1]]}function Mn(t,e){return Tn.globSync(e,{cwd:t}).map((t=>On(t)))}function Fn(t,e,i){for(let r=0;r<i.length;++r)t[r+1][e]=i[r]}function Dn(){const t=function(t,e){const i=Tn.globSync(e,{cwd:t}),r=new Map;for(const t of i){const e=On(t);if(!e.includes("-"))throw Error(`invalid character name ${e}`);const[i,s]=Ln(e),n=r.get(i);void 0!==n?n.push(s):r.set(i,[s])}return Array.from(r).map((t=>({name:t[0],actions:t[1].join(",")})))}("Data/assets/Assets/AddressablesAsset/character","*.png").filter((t=>"default"!==t.name));return t.findIndex((t=>"me"===t.name))<0&&t.unshift({name:"me",actions:"default"}),t}function Bn(){const t=Dn(),i=function(t){const i="Data/assets/Assets/AddressablesAsset/configs/character.yaml";if(e.existsSync(i)){const r=e.readFileSync(i,"utf-8"),s=Ci.load(r),n=new Map;for(const e of s)t.includes(e.character)&&(e.order=t.findIndex((t=>t===e.character)),"string"!=typeof e.name&&(e.name=e.character),n.set(e.character,e));for(let e=0;e<t.length;e++)n.has(t[e])||n.set(t[e],{character:t[e],name:t[e],msg_color:"ffffff",name_bgcolor:"ffffff",order:e});return Array.from(n.values()).sort(((t,e)=>t.order-e.order))}{const e=[];for(const i of t)e.push({character:i,name:i,msg_color:"ffffff",name_bgcolor:"ffffff",order:0});return e}}(t.map((t=>t.name))),r=Mn("Data/assets/Assets/AddressablesAsset/avatar","*.png"),s=function(t){const i="Data/assets/Assets/AddressablesAsset/configs/avatar.yaml";if(e.existsSync(i)){const r=e.readFileSync(i,"utf-8"),s=Ci.load(r),n=new Map;for(const e of s)t.includes(e.avatar)&&(e.order=t.findIndex((t=>t===e.avatar)),n.set(e.avatar,e));for(let e=0;e<t.length;e++)n.has(t[e])||n.set(t[e],{avatar:t[e],name:t[e],image:t[e],order:e});return Array.from(n.values()).sort(((t,e)=>t.order-e.order))}{const e=[];for(const i of t)e.push({avatar:i,name:i,image:i,order:0});return e}}(r),n=Mn("Data/assets/Assets/AddressablesAsset/bg","*.png"),o=function(t,e){return Tn.globSync(e,{cwd:t}).map((t=>On(t))).filter((t=>!t.endsWith("_thumb")))}("Data/assets/Assets/AddressablesAsset/cg","*.png"),a=Mn("Data/assets/Assets/AddressablesAsset/minicg","*.png"),c=Mn("Data/assets/Assets/AddressablesAsset/sticker","*.png"),l=Mn("Data/assets/Assets/AddressablesAsset/bgm","*.ogg"),h=Mn("Data/assets/Assets/AddressablesAsset/sound","*.ogg"),u=Math.max(4,t.length,t.length,r.length,r.length,n.length,o.length,a.length,c.length,l.length,h.length)+2,d=new Array(u+1).fill(0).map((()=>new Array(16).fill("")));d[0]=["Sheet Type","Position","Character List","Character Name","Text Color","Name Banner Color","Action Character List","Avatar List","Avatar Name","Background List","CG List","mini CG List","Sticker List","BGM List","Sound List","Type CG List"],Fn(d,0,["novel","chat"]),Fn(d,1,["center","left","right","me"]),Fn(d,2,["empty","narrator",...t.map((t=>t.name))]),Fn(d,3,["empty","",...i.map((t=>t.name))]),Fn(d,4,["","ffffff",...i.map((t=>t.msg_color))]),Fn(d,5,["","ffffff",...i.map((t=>t.name_bgcolor))]),Fn(d,6,["","default",...t.map((t=>t.actions))]),Fn(d,7,["me",...r]),Fn(d,8,["me",...s.map((t=>t.avatar))]),Fn(d,9,n),Fn(d,10,o),Fn(d,11,a),Fn(d,12,c),Fn(d,13,l),Fn(d,14,h),Fn(d,15,["cg","minicg","image"]),e.writeFileSync("asset-list.csv",N(d),{encoding:"utf-8"})}Tn.glob=Tn;var Un,Gn={exports:{}},jn={exports:{}},$n={exports:{}},Pn={exports:{}};try{var qn=require("util");if("function"!=typeof qn.inherits)throw"";$n.exports=qn.inherits}catch(t){$n.exports=(Un||(Un=1,"function"==typeof Object.create?Pn.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:Pn.exports=function(t,e){if(e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}}),Pn.exports)}var zn=$n.exports,Wn=n.EventEmitter;function Hn(t){if(!(this instanceof Hn))return new Hn(t);Wn.call(this),t=t||{},this.concurrency=t.concurrency||1/0,this.timeout=t.timeout||0,this.autostart=t.autostart||!1,this.results=t.results||null,this.pending=0,this.session=0,this.running=!1,this.jobs=[],this.timers={}}jn.exports=Hn,jn.exports.default=Hn,zn(Hn,Wn);["pop","shift","indexOf","lastIndexOf"].forEach((function(t){Hn.prototype[t]=function(){return Array.prototype[t].apply(this.jobs,arguments)}})),Hn.prototype.slice=function(t,e){return this.jobs=this.jobs.slice(t,e),this},Hn.prototype.reverse=function(){return this.jobs.reverse(),this};function Yn(){for(var t in this.timers){var e=this.timers[t];delete this.timers[t],clearTimeout(e)}}function Jn(t){var e=this;function i(t){e.end(t)}this.on("error",i),this.on("end",(function r(s){e.removeListener("error",i),e.removeListener("end",r),t(s,this.results)}))}function Kn(t){this.session++,this.running=!1,this.emit("end",t)}["push","unshift","splice"].forEach((function(t){Hn.prototype[t]=function(){var e=Array.prototype[t].apply(this.jobs,arguments);return this.autostart&&this.start(),e}})),Object.defineProperty(Hn.prototype,"length",{get:function(){return this.pending+this.jobs.length}}),Hn.prototype.start=function(t){if(t&&Jn.call(this,t),this.running=!0,!(this.pending>=this.concurrency))if(0!==this.jobs.length){var e=this,i=this.jobs.shift(),r=!0,s=this.session,n=null,o=!1,a=null,c=i.hasOwnProperty("timeout")?i.timeout:this.timeout;c&&(n=setTimeout((function(){o=!0,e.listeners("timeout").length>0?e.emit("timeout",h,i):h()}),c),this.timers[n]=n),this.results&&(a=this.results.length,this.results[a]=null),this.pending++,e.emit("start",i);var l=i(h);l&&l.then&&"function"==typeof l.then&&l.then((function(t){return h(null,t)})).catch((function(t){return h(t||!0)})),this.running&&this.jobs.length>0&&this.start()}else 0===this.pending&&Kn.call(this);function h(t,c){r&&e.session===s&&(r=!1,e.pending--,null!==n&&(delete e.timers[n],clearTimeout(n)),t?e.emit("error",t,i):!1===o&&(null!==a&&(e.results[a]=Array.prototype.slice.call(arguments,1)),e.emit("success",c,i)),e.session===s&&(0===e.pending&&0===e.jobs.length?Kn.call(e):e.running&&e.start()))}},Hn.prototype.stop=function(){this.running=!1},Hn.prototype.end=function(t){Yn.call(this),this.jobs.length=0,this.pending=0,Kn.call(this,t)};var Vn=jn.exports,Xn={},Zn={},Qn={};!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.findBox=t.readUInt=t.readUInt32LE=t.readUInt32BE=t.readInt32LE=t.readUInt24LE=t.readUInt16LE=t.readUInt16BE=t.readInt16LE=t.toHexString=t.toUTF8String=void 0;const e=new TextDecoder;t.toUTF8String=(t,i=0,r=t.length)=>e.decode(t.slice(i,r));t.toHexString=(t,e=0,i=t.length)=>t.slice(e,i).reduce(((t,e)=>t+("0"+e.toString(16)).slice(-2)),"");t.readInt16LE=(t,e=0)=>{const i=t[e]+256*t[e+1];return i|131070*(32768&i)};t.readUInt16BE=(t,e=0)=>256*t[e]+t[e+1];t.readUInt16LE=(t,e=0)=>t[e]+256*t[e+1];t.readUInt24LE=(t,e=0)=>t[e]+256*t[e+1]+65536*t[e+2];t.readInt32LE=(t,e=0)=>t[e]+256*t[e+1]+65536*t[e+2]+(t[e+3]<<24);t.readUInt32BE=(t,e=0)=>t[e]*2**24+65536*t[e+1]+256*t[e+2]+t[e+3];t.readUInt32LE=(t,e=0)=>t[e]+256*t[e+1]+65536*t[e+2]+t[e+3]*2**24;const i={readUInt16BE:t.readUInt16BE,readUInt16LE:t.readUInt16LE,readUInt32BE:t.readUInt32BE,readUInt32LE:t.readUInt32LE};function r(e,i){if(e.length-i<4)return;const r=(0,t.readUInt32BE)(e,i);return e.length-i<r?void 0:{name:(0,t.toUTF8String)(e,4+i,8+i),offset:i,size:r}}t.readUInt=function(t,e,r,s){return r=r||0,i["readUInt"+e+(s?"BE":"LE")](t,r)},t.findBox=function(t,e,i){for(;i<t.length;){const s=r(t,i);if(!s)break;if(s.name===e)return s;i+=s.size}}}(Qn),Object.defineProperty(Zn,"__esModule",{value:!0}),Zn.BMP=void 0;const to=Qn;Zn.BMP={validate:t=>"BM"===(0,to.toUTF8String)(t,0,2),calculate:t=>({height:Math.abs((0,to.readInt32LE)(t,22)),width:(0,to.readUInt32LE)(t,18)})};var eo={},io={};Object.defineProperty(io,"__esModule",{value:!0}),io.ICO=void 0;const ro=Qn;function so(t,e){const i=t[e];return 0===i?256:i}function no(t,e){const i=6+16*e;return{height:so(t,i+1),width:so(t,i)}}io.ICO={validate(t){const e=(0,ro.readUInt16LE)(t,0),i=(0,ro.readUInt16LE)(t,4);if(0!==e||0===i)return!1;return 1===(0,ro.readUInt16LE)(t,2)},calculate(t){const e=(0,ro.readUInt16LE)(t,4),i=no(t,0);if(1===e)return i;const r=[i];for(let i=1;i<e;i+=1)r.push(no(t,i));return{height:i.height,images:r,width:i.width}}},Object.defineProperty(eo,"__esModule",{value:!0}),eo.CUR=void 0;const oo=io,ao=Qn;eo.CUR={validate(t){const e=(0,ao.readUInt16LE)(t,0),i=(0,ao.readUInt16LE)(t,4);if(0!==e||0===i)return!1;return 2===(0,ao.readUInt16LE)(t,2)},calculate:t=>oo.ICO.calculate(t)};var co={};Object.defineProperty(co,"__esModule",{value:!0}),co.DDS=void 0;const lo=Qn;co.DDS={validate:t=>542327876===(0,lo.readUInt32LE)(t,0),calculate:t=>({height:(0,lo.readUInt32LE)(t,12),width:(0,lo.readUInt32LE)(t,16)})};var ho={};Object.defineProperty(ho,"__esModule",{value:!0}),ho.GIF=void 0;const uo=Qn,po=/^GIF8[79]a/;ho.GIF={validate:t=>po.test((0,uo.toUTF8String)(t,0,6)),calculate:t=>({height:(0,uo.readUInt16LE)(t,8),width:(0,uo.readUInt16LE)(t,6)})};var fo={};Object.defineProperty(fo,"__esModule",{value:!0}),fo.HEIF=void 0;const go=Qn,mo={avif:"avif",mif1:"heif",msf1:"heif",heic:"heic",heix:"heic",hevc:"heic",hevx:"heic"};fo.HEIF={validate(t){const e=(0,go.toUTF8String)(t,4,8),i=(0,go.toUTF8String)(t,8,12);return"ftyp"===e&&i in mo},calculate(t){const e=(0,go.findBox)(t,"meta",0),i=e&&(0,go.findBox)(t,"iprp",e.offset+12),r=i&&(0,go.findBox)(t,"ipco",i.offset+8),s=r&&(0,go.findBox)(t,"ispe",r.offset+8);if(s)return{height:(0,go.readUInt32BE)(t,s.offset+16),width:(0,go.readUInt32BE)(t,s.offset+12),type:(0,go.toUTF8String)(t,8,12)};throw new TypeError("Invalid HEIF, no size found")}};var yo={};Object.defineProperty(yo,"__esModule",{value:!0}),yo.ICNS=void 0;const vo=Qn,bo={ICON:32,"ICN#":32,"icm#":16,icm4:16,icm8:16,"ics#":16,ics4:16,ics8:16,is32:16,s8mk:16,icp4:16,icl4:32,icl8:32,il32:32,l8mk:32,icp5:32,ic11:32,ich4:48,ich8:48,ih32:48,h8mk:48,icp6:64,ic12:32,it32:128,t8mk:128,ic07:128,ic08:256,ic13:256,ic09:512,ic14:512,ic10:1024};function wo(t,e){const i=e+4;return[(0,vo.toUTF8String)(t,e,i),(0,vo.readUInt32BE)(t,i)]}function So(t){const e=bo[t];return{width:e,height:e,type:t}}yo.ICNS={validate:t=>"icns"===(0,vo.toUTF8String)(t,0,4),calculate(t){const e=t.length,i=(0,vo.readUInt32BE)(t,4);let r=8,s=wo(t,r),n=So(s[0]);if(r+=s[1],r===i)return n;const o={height:n.height,images:[n],width:n.width};for(;r<i&&r<e;)s=wo(t,r),n=So(s[0]),r+=s[1],o.images.push(n);return o}};var _o={};Object.defineProperty(_o,"__esModule",{value:!0}),_o.J2C=void 0;const ko=Qn;_o.J2C={validate:t=>"ff4fff51"===(0,ko.toHexString)(t,0,4),calculate:t=>({height:(0,ko.readUInt32BE)(t,12),width:(0,ko.readUInt32BE)(t,8)})};var Eo={};Object.defineProperty(Eo,"__esModule",{value:!0}),Eo.JP2=void 0;const Ao=Qn;Eo.JP2={validate(t){if(1783636e3!==(0,Ao.readUInt32BE)(t,4)||(0,Ao.readUInt32BE)(t,0)<1)return!1;const e=(0,Ao.findBox)(t,"ftyp",0);return!!e&&1718909296===(0,Ao.readUInt32BE)(t,e.offset+4)},calculate(t){const e=(0,Ao.findBox)(t,"jp2h",0),i=e&&(0,Ao.findBox)(t,"ihdr",e.offset+8);if(i)return{height:(0,Ao.readUInt32BE)(t,i.offset+8),width:(0,Ao.readUInt32BE)(t,i.offset+12)};throw new TypeError("Unsupported JPEG 2000 format")}};var Co={};Object.defineProperty(Co,"__esModule",{value:!0}),Co.JPG=void 0;const Ro=Qn,xo=6,Io=12,No=2;function To(t){return"45786966"===(0,Ro.toHexString)(t,2,6)}function Oo(t,e){return{height:(0,Ro.readUInt16BE)(t,e),width:(0,Ro.readUInt16BE)(t,e+2)}}function Lo(t,e){const i=t.slice(2,e),r=(0,Ro.toHexString)(i,xo,xo+2),s="4d4d"===r;if(s||"4949"===r)return function(t,e){const i=xo+8,r=(0,Ro.readUInt)(t,16,i,e);for(let s=0;s<r;s++){const r=i+No+s*Io,n=r+Io;if(r>t.length)return;const o=t.slice(r,n);if(274===(0,Ro.readUInt)(o,16,0,e)){if(3!==(0,Ro.readUInt)(o,16,2,e))return;if(1!==(0,Ro.readUInt)(o,32,4,e))return;return(0,Ro.readUInt)(o,16,8,e)}}}(i,s)}function Mo(t,e){if(e>t.length)throw new TypeError("Corrupt JPG, exceeded buffer limits")}Co.JPG={validate:t=>"ffd8"===(0,Ro.toHexString)(t,0,2),calculate(t){let e,i;for(t=t.slice(4);t.length;){const r=(0,Ro.readUInt16BE)(t,0);if(255===t[r]){if(To(t)&&(e=Lo(t,r)),Mo(t,r),i=t[r+1],192===i||193===i||194===i){const i=Oo(t,r+5);return e?{height:i.height,orientation:e,width:i.width}:i}t=t.slice(r+2)}else t=t.slice(1)}throw new TypeError("Invalid JPG, no size found")}};var Fo={};Object.defineProperty(Fo,"__esModule",{value:!0}),Fo.KTX=void 0;const Do=Qn;Fo.KTX={validate:t=>{const e=(0,Do.toUTF8String)(t,1,7);return["KTX 11","KTX 20"].includes(e)},calculate:t=>{const e=49===t[5]?"ktx":"ktx2",i="ktx"===e?36:20;return{height:(0,Do.readUInt32LE)(t,i+4),width:(0,Do.readUInt32LE)(t,i),type:e}}};var Bo={};Object.defineProperty(Bo,"__esModule",{value:!0}),Bo.PNG=void 0;const Uo=Qn,Go="CgBI";Bo.PNG={validate(t){if("PNG\r\n\n"===(0,Uo.toUTF8String)(t,1,8)){let e=(0,Uo.toUTF8String)(t,12,16);if(e===Go&&(e=(0,Uo.toUTF8String)(t,28,32)),"IHDR"!==e)throw new TypeError("Invalid PNG");return!0}return!1},calculate:t=>(0,Uo.toUTF8String)(t,12,16)===Go?{height:(0,Uo.readUInt32BE)(t,36),width:(0,Uo.readUInt32BE)(t,32)}:{height:(0,Uo.readUInt32BE)(t,20),width:(0,Uo.readUInt32BE)(t,16)}};var jo={};Object.defineProperty(jo,"__esModule",{value:!0}),jo.PNM=void 0;const $o=Qn,Po={P1:"pbm/ascii",P2:"pgm/ascii",P3:"ppm/ascii",P4:"pbm",P5:"pgm",P6:"ppm",P7:"pam",PF:"pfm"},qo={default:t=>{let e=[];for(;t.length>0;){const i=t.shift();if("#"!==i[0]){e=i.split(" ");break}}if(2===e.length)return{height:parseInt(e[1],10),width:parseInt(e[0],10)};throw new TypeError("Invalid PNM")},pam:t=>{const e={};for(;t.length>0;){const i=t.shift();if(i.length>16||i.charCodeAt(0)>128)continue;const[r,s]=i.split(" ");if(r&&s&&(e[r.toLowerCase()]=parseInt(s,10)),e.height&&e.width)break}if(e.height&&e.width)return{height:e.height,width:e.width};throw new TypeError("Invalid PAM")}};jo.PNM={validate:t=>(0,$o.toUTF8String)(t,0,2)in Po,calculate(t){const e=(0,$o.toUTF8String)(t,0,2),i=Po[e],r=(0,$o.toUTF8String)(t,3).split(/[\r\n]+/);return(qo[i]||qo.default)(r)}};var zo={};Object.defineProperty(zo,"__esModule",{value:!0}),zo.PSD=void 0;const Wo=Qn;zo.PSD={validate:t=>"8BPS"===(0,Wo.toUTF8String)(t,0,4),calculate:t=>({height:(0,Wo.readUInt32BE)(t,14),width:(0,Wo.readUInt32BE)(t,18)})};var Ho={};Object.defineProperty(Ho,"__esModule",{value:!0}),Ho.SVG=void 0;const Yo=Qn,Jo=/<svg\s([^>"']|"[^"]*"|'[^']*')*>/,Ko={height:/\sheight=(['"])([^%]+?)\1/,root:Jo,viewbox:/\sviewBox=(['"])(.+?)\1/i,width:/\swidth=(['"])([^%]+?)\1/},Vo=2.54,Xo={in:96,cm:96/Vo,em:16,ex:8,m:96/Vo*100,mm:96/Vo/10,pc:96/72/12,pt:96/72,px:1},Zo=new RegExp(`^([0-9.]+(?:e\\d+)?)(${Object.keys(Xo).join("|")})?$`);function Qo(t){const e=Zo.exec(t);if(e)return Math.round(Number(e[1])*(Xo[e[2]]||1))}function ta(t){const e=t.split(" ");return{height:Qo(e[3]),width:Qo(e[2])}}Ho.SVG={validate:t=>Jo.test((0,Yo.toUTF8String)(t,0,1e3)),calculate(t){const e=(0,Yo.toUTF8String)(t).match(Ko.root);if(e){const t=function(t){const e=t.match(Ko.width),i=t.match(Ko.height),r=t.match(Ko.viewbox);return{height:i&&Qo(i[2]),viewbox:r&&ta(r[2]),width:e&&Qo(e[2])}}(e[0]);if(t.width&&t.height)return function(t){return{height:t.height,width:t.width}}(t);if(t.viewbox)return function(t,e){const i=e.width/e.height;return t.width?{height:Math.floor(t.width/i),width:t.width}:t.height?{height:t.height,width:Math.floor(t.height*i)}:{height:e.height,width:e.width}}(t,t.viewbox)}throw new TypeError("Invalid SVG")}};var ea={};Object.defineProperty(ea,"__esModule",{value:!0}),ea.TGA=void 0;const ia=Qn;ea.TGA={validate:t=>0===(0,ia.readUInt16LE)(t,0)&&0===(0,ia.readUInt16LE)(t,4),calculate:t=>({height:(0,ia.readUInt16LE)(t,14),width:(0,ia.readUInt16LE)(t,12)})};var ra={};Object.defineProperty(ra,"__esModule",{value:!0}),ra.TIFF=void 0;const sa=e,na=Qn;function oa(t,e){const i=(0,na.readUInt)(t,16,8,e);return((0,na.readUInt)(t,16,10,e)<<16)+i}function aa(t){if(t.length>24)return t.slice(12)}const ca=["49492a00","4d4d002a"];ra.TIFF={validate:t=>ca.includes((0,na.toHexString)(t,0,4)),calculate(t,e){if(!e)throw new TypeError("Tiff doesn't support buffer");const i="BE"===function(t){const e=(0,na.toUTF8String)(t,0,2);return"II"===e?"LE":"MM"===e?"BE":void 0}(t),r=function(t,e,i){const r=(0,na.readUInt)(t,32,4,i);let s=1024;const n=sa.statSync(e).size;r+s>n&&(s=n-r-10);const o=new Uint8Array(s),a=sa.openSync(e,"r");return sa.readSync(a,o,0,s,r),sa.closeSync(a),o.slice(2)}(t,e,i),s=function(t,e){const i={};let r=t;for(;r&&r.length;){const t=(0,na.readUInt)(r,16,0,e),s=(0,na.readUInt)(r,16,2,e),n=(0,na.readUInt)(r,32,4,e);if(0===t)break;1!==n||3!==s&&4!==s||(i[t]=oa(r,e)),r=aa(r)}return i}(r,i),n=s[256],o=s[257];if(!n||!o)throw new TypeError("Invalid Tiff. Missing tags");return{height:o,width:n}}};var la={};Object.defineProperty(la,"__esModule",{value:!0}),la.WEBP=void 0;const ha=Qn;la.WEBP={validate(t){const e="RIFF"===(0,ha.toUTF8String)(t,0,4),i="WEBP"===(0,ha.toUTF8String)(t,8,12),r="VP8"===(0,ha.toUTF8String)(t,12,15);return e&&i&&r},calculate(t){const e=(0,ha.toUTF8String)(t,12,16);if(t=t.slice(20,30),"VP8X"===e){const e=t[0];if(!(192&e)&&!(1&e))return function(t){return{height:1+(0,ha.readUInt24LE)(t,7),width:1+(0,ha.readUInt24LE)(t,4)}}(t);throw new TypeError("Invalid WebP")}if("VP8 "===e&&47!==t[0])return function(t){return{height:16383&(0,ha.readInt16LE)(t,8),width:16383&(0,ha.readInt16LE)(t,6)}}(t);const i=(0,ha.toHexString)(t,3,6);if("VP8L"===e&&"9d012a"!==i)return function(t){return{height:1+((15&t[4])<<10|t[3]<<2|(192&t[2])>>6),width:1+((63&t[2])<<8|t[1])}}(t);throw new TypeError("Invalid WebP")}},Object.defineProperty(Xn,"__esModule",{value:!0}),Xn.typeHandlers=void 0;const ua=Zn,da=eo,pa=co,fa=ho,ga=fo,ma=yo,ya=io,va=_o,ba=Eo,wa=Co,Sa=Fo,_a=Bo,ka=jo,Ea=zo,Aa=Ho,Ca=ea,Ra=ra,xa=la;Xn.typeHandlers={bmp:ua.BMP,cur:da.CUR,dds:pa.DDS,gif:fa.GIF,heif:ga.HEIF,icns:ma.ICNS,ico:ya.ICO,j2c:va.J2C,jp2:ba.JP2,jpg:wa.JPG,ktx:Sa.KTX,png:_a.PNG,pnm:ka.PNM,psd:Ea.PSD,svg:Aa.SVG,tga:Ca.TGA,tiff:Ra.TIFF,webp:xa.WEBP};var Ia={};Object.defineProperty(Ia,"__esModule",{value:!0}),Ia.detector=void 0;const Na=Xn,Ta=Object.keys(Na.typeHandlers),Oa={56:"psd",66:"bmp",68:"dds",71:"gif",73:"tiff",77:"tiff",82:"webp",105:"icns",137:"png",255:"jpg"};Ia.detector=function(t){const e=t[0];if(e in Oa){const i=Oa[e];if(i&&Na.typeHandlers[i].validate(t))return i}return Ta.find((e=>Na.typeHandlers[e].validate(t)))},function(t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.types=r.setConcurrency=r.disableTypes=r.disableFS=r.imageSize=void 0;const s=e,n=i,o=Xn,a=Ia,c=524288,l=new Vn.default({concurrency:100,autostart:!0}),h={disabledFS:!1,disabledTypes:[]};function u(t,e){const i=(0,a.detector)(t);if(void 0!==i){if(h.disabledTypes.indexOf(i)>-1)throw new TypeError("disabled file type: "+i);if(i in o.typeHandlers){const r=o.typeHandlers[i].calculate(t,e);if(void 0!==r)return r.type=r.type??i,r}}throw new TypeError("unsupported file type: "+i+" (file: "+e+")")}function d(t,e){if(t instanceof Uint8Array)return u(t);if("string"!=typeof t||h.disabledFS)throw new TypeError("invalid invocation. input should be a Uint8Array");const i=n.resolve(t);if("function"!=typeof e){const t=function(t){const e=s.openSync(t,"r");try{const{size:t}=s.fstatSync(e);if(t<=0)throw new Error("Empty file");const i=Math.min(t,c),r=new Uint8Array(i);return s.readSync(e,r,0,i,0),r}finally{s.closeSync(e)}}(i);return u(t,i)}l.push((()=>async function(t){const e=await s.promises.open(t,"r");try{const{size:t}=await e.stat();if(t<=0)throw new Error("Empty file");const i=Math.min(t,c),r=new Uint8Array(i);return await e.read(r,0,i,0),r}finally{await e.close()}}(i).then((t=>process.nextTick(e,null,u(t,i)))).catch(e)))}t.exports=r=d,r.default=d,r.imageSize=d;r.disableFS=t=>{h.disabledFS=t};r.disableTypes=t=>{h.disabledTypes=t};r.setConcurrency=t=>{l.concurrency=t},r.types=Object.keys(o.typeHandlers)}(Gn,Gn.exports);var La,Ma=u(Gn.exports);!function(t){t.Avatar="avatar",t.Sticket="sticker",t.ChatBackground="chat-background",t.ChatButton="chat-button",t.ChatHeader="chat-header",t.ChatDecoration="chat-decoration",t.Background="bg",t.Character="character",t.CG="cg",t.CG_Thumb="cg_thumb",t.MiniCG="minicg",t.Cover="cover",t.StoryThumb="preview",t.MiniStoryThumb="minipreview",t.Gallery="gallery",t.Banner="banner"}(La||(La={}));const Fa=new Map([[La.Avatar,{width:164,height:164}],[La.ChatBackground,{width:1080,height:1920}],[La.Sticket,{width:372,height:320}],[La.ChatButton,{width:100,height:100}],[La.ChatHeader,{width:1080,height:160}],[La.ChatDecoration,{width:48,height:48}],[La.Background,{width:1920,height:1920}],[La.Character,{width:2104,height:2104}],[La.CG,{width:2160,height:3840}],[La.CG_Thumb,{width:100,height:100}],[La.MiniCG,{width:724,height:724}],[La.Cover,{width:1080,height:1280}],[La.StoryThumb,{width:320,height:452}],[La.MiniStoryThumb,{width:320,height:320}],[La.Gallery,{width:2092,height:600}],[La.Banner,{width:1032,height:376}]]);class Da{constructor(t,e){this.filePath=e,this.type=t}checkValidSize(){const t=Fa.get(this.type);if(!t)throw new Error("Error: invalid image type");const e=this.readSize();return void 0!==e.width&&void 0!==e.height&&(e.width===t.width&&e.height===t.height)}readSize(){const t=Ma(this.filePath);if(!t)throw new Error("Error: invalid png file");if(!t.width||!t.height)throw new Error(`width or height is undefined in ${this.filePath} (result: ${t})`);return{width:t.width,height:t.height}}}var Ba;!function(t){t[t.GAME=0]="GAME",t[t.TOOL=1]="TOOL"}(Ba||(Ba={}));const Ua=new Map([[La.Avatar,{path:"avatar/"}],[La.Sticket,{path:"sticker/"}],[La.ChatBackground,{path:"chat/background/"}],[La.ChatButton,{path:"chat/header/",includeKeyword:["btn_"]}],[La.ChatHeader,{path:"chat/header/",excludeKeyword:["btn_"]}],[La.ChatDecoration,{path:"chat/decoration/"}],[La.Background,{path:"bg/"}],[La.Character,{path:"character/"}],[La.CG,{path:"cg/",excludeKeyword:["_thumb"]}],[La.CG_Thumb,{path:"cg/",includeKeyword:["_thumb"]}],[La.MiniCG,{path:"minicg/"}],[La.Cover,{path:"cover/{name}"}],[La.StoryThumb,{path:"cover/{name}_lobby"}],[La.MiniStoryThumb,{path:"cover/{name}_continue"}]]);function Ga(t){return t+"/Assets/AddressablesAsset/"}function ja(t,e,i){if(e){for(const i of e)if(t.includes(i))return!0;return!1}if(i){for(const e of i)if(t.includes(e))return!1;return!0}return!0}class $a{constructor(){this.dict=[]}init(t,e){this.dict=[];var i=[];Array.isArray(t)?i.push(...t):i.push(t),this.addFiles(i,!1),void 0!==e&&this.addWords(e,!1),this.finalizeDict()}addWords(t,e){e=void 0===e||e,this.dict.push.apply(this.dict,t),e&&this.finalizeDict()}finalizeDict(){this.dict=this.sortuniq(this.dict)}addFiles(t,e){e=void 0===e||e,t=this.sortuniq(this.flatten(t.map((function(t){return Tn.sync(t)}))));for(var i=0;i<t.length;i++){console.log("load dict from "+t[i]);var r=l.readFileSync(t[i],{encoding:"utf-8"}).split(/[\r\n]+/).filter((function(t){return t.length>1}));this.addWords(r,!1)}e&&this.finalizeDict()}dictSeek(t,e,i,r,s){for(var n=null;t<=e;){var o=Math.floor((t+e)/2),a=this.dict[o];if(a.length<=r)t=o+1;else{var c=a[r];c<i?t=o+1:c>i?e=o-1:(n=o,0==s?e=o-1:t=o+1)}}return n}isFinal(t){return this.dict[t.l].length==t.strOffset}createAcceptor(){return{l:0,r:this.dict.length-1,strOffset:0,isFinal:!1,dict:this,transit:function(t){return this.dict.transit(this,t)},isError:!1,tag:"DICT",w:1,type:"DICT"}}transit(t,e){var i=this.dictSeek(t.l,t.r,e,t.strOffset,0);if(null!==i){var r=this.dictSeek(i,t.r,e,t.strOffset,1);t.l=i,t.r=r,t.strOffset++,t.isFinal=this.isFinal(t)}else t.isError=!0;return t}sortuniq(t){return t.sort().filter((function(t,e,i){return!e||t!=i[e-1]}))}flatten(t){return[].concat.apply([],t)}}class Pa{buildByAcceptors(t,e,i){return e.map((function(e){var r=i-e.strOffset+1,s=t[r],n={p:r,mw:s.mw+(void 0===e.mw?0:e.mw),w:e.w+s.w,merge:void 0,unk:(e.unk?e.unk:0)+s.unk,type:e.type};if("PART"==e.type){for(var o=r+1;o<=i;o++)t[o].merge=r;n.merge=r}return n})).filter((function(t){return t}))}fallback(t,e,i,r){var s=t[e];return i[r].match(/[\u0E48-\u0E4E]/)?(0!=e&&(e=t[e].p),{p:e,mw:0,w:1+s.w,unk:1+s.unk,type:"UNK"}):{p:e,mw:s.mw,w:1+s.w,unk:1+s.unk,type:"UNK"}}build(t,e,i,r,s){var n=this.buildByAcceptors(t,e,i);return n.length>0?n:[this.fallback(t,r,s,i)]}}class qa{selectPath(t){return t.reduce((function(t,e){if(null==t)return e;if(e.unk<t.unk)return e;if(e.unk==t.unk){if(e.mw<t.mw)return e;if(e.mw==t.mw&&e.w<t.w)return e}return t}),null)}createPath(){return[{p:null,w:0,unk:0,type:"INIT",mw:0}]}}class za{constructor(){this.creators=[],this.current=[],this.tag={}}init(){this.creators=[],this.current=[],this.tag={}}reset(){this.current=[],this.tag={}}transit(t){var e=this;e.creators.forEach((t=>{var i=t.createAcceptor(e.tag);i&&e.current.push(i)}));var i=[];e.tag={};for(var r=0;r<e.current.length;r++){var s=e.current[r].transit(t);s.isError||(i.push(s),e.tag[s.tag]=s)}e.current=i}getFinalAcceptors(){return this.current.filter((function(t){return t.isFinal}))}}var Wa=[new class{createAcceptor(t){return t.WORD_RULE?null:{strOffset:0,isFinal:!1,transit:function(t){var e=t.toLowerCase();return e>="a"&&e<="z"?(this.isFinal=!0,this.strOffset++):this.isError=!0,this},isError:!1,tag:"WORD_RULE",type:"WORD_RULE",w:1}}},new class{constructor(){this.tag="SPACE_RULE"}createAcceptor(t){return t.SPACE_RULE?null:{strOffset:0,isFinal:!1,transit:function(t){return" "==t||"\t"==t||"\r"==t||"\n"==t||" "==t||" "==t?(this.isFinal=!0,this.strOffset++):this.isError=!0,this},isError:!1,tag:this.tag,w:1,type:"SPACE_RULE"}}},new class{constructor(){this.tag="SINSYM"}createAcceptor(t){return{strOffset:0,isFinal:!1,transit:function(t){return 0==this.strOffset&&t.match(/^[\@\(\)\/\,\-\."`]$/)?(this.isFinal=!0,this.strOffset++):this.isError=!0,this},isError:!1,tag:"SINSYM",w:1,type:"SINSYM"}}},new class{createAcceptor(t){return t.NUMBER_RULE?null:{strOffset:0,isFinal:!1,transit:function(t){return t>="0"&&t<="9"?(this.isFinal=!0,this.strOffset++):this.isError=!0,this},isError:!1,tag:"NUMBER_RULE",type:"NUMBER_RULE",w:1}}}];function Ha(t,e,i){if(t.length<=e)return!1;var r=t[e];return r==i||r.match(/[กข]/)&&i.match(/[ก-ฮ]/)||r.match(/[มบ]/)&&i.match(/[ก-ฮ]/)||r.match(/\u0E49/)&&i.match(/[\u0E48-\u0E4B]/)}class Ya{constructor(t){this.pat=t,this.strOffset=0,this.isFinal=!1,this.isError=!1,this.tag="THAI_RULE",this.type="THAI_RULE",this.w=1,this.transit=t=>(Ha(this.pat,this.strOffset,t)?(this.isFinal=this.strOffset+1==this.pat.length,this.strOffset++):this.isError=!0,this)}}class Ja{createAcceptor(t){return new Ya("เหก็ม")}}class Ka{createAcceptor(t){return{strOffset:0,patterns:["แก","เก","ก้","กก์","กา","กี","กิ","กืก"],isFinal:!1,transit:function(t){var e=this.strOffset;if(this.patterns=this.patterns.filter((function(i){return Ha(i,e,t)})),this.patterns.length>0){var i=1+e;this.isFinal=this.patterns.some((function(t){return t.length==i})),this.strOffset++}else this.isError=!0;return this},isError:!1,tag:"PART",type:"PART",unk:1,w:1}}}const Va="|",Xa=["<",">"],Za=[" ","\n","\r","ๆ"];class Qa{static init(){this.wordcut.init([__dirname+"/dict/*.txt"],["!","?","~","That's","that's","That' s","that' s","'s","' s"])}static cutterString(t){return function(t,e){const i=new ic(e);let r,s="";const n=[];for(;void 0!==(r=i.getNext());){if(1===r.type){if(r.buffer.indexOf("/")<0)n.push(r.buffer);else{const t=ec(r.buffer).replace("/","");for(let e=n.length;--e>=0;)if(n[e].indexOf(t)>=0){n.splice(e,1);break}}continue}if(s.length>0&&void 0!==Xa.find((t=>t===s[s.length-1]))&&(s+=Va),2===r.type){s+=tc(n,r.buffer);continue}const e=t.cut(r.buffer).split(Va);for(let t=0;t<e.length;++t)s+=tc(n,e[t]),t<e.length-1&&(s+=Va)}return s}(this.wordcut,t)}}function tc(t,e){return`${t.reduce(((t,e)=>`${t}${e}`),"")}${e}${t.reduceRight(((t,e)=>`${t}${function(t){const e=ec(t),i=e.split("=");return 2==i.length?`</${i[0]}>`:`</${e}>`}(e)}`),"")}`}function ec(t){return t.replace("<","").replace(">","")}Qa.wordcut=new class{constructor(){this.pathSelector=new qa,this.acceptors=new za,this.pathInfoBuilder=new Pa,[new Ja,new Ka].forEach((t=>{this.acceptors.creators.push(t)})),Wa.forEach((t=>{this.acceptors.creators.push(t)}))}initNoDict(){this.init([],[])}init(t,e){var i=new $a;i.init(t,e),this.acceptors.creators.push(i)}buildPath(t){var e=this,i=e.pathSelector.createPath(),r=0;e.acceptors.reset();for(var s=0;s<t.length;s++){var n=t[s];e.acceptors.transit(n);var o=e.pathInfoBuilder.build(i,e.acceptors.getFinalAcceptors(),s,r,t),a=e.pathSelector.selectPath(o);i.push(a),"UNK"!==a.type&&(r=s)}return i}pathToRanges(t){for(var e=t.length-1,i=[];e>0;){var r=t[e],s=r.p;if(void 0!==r.merge&&i.length>0){var n=i[i.length-1];n.s=r.merge,s=n.s}else i.push({s:s,e:e});e=s}return i.reverse()}rangesToText(t,e,i){return e.map((function(e){return t.substring(e.s,e.e)})).join(i)}cut(t,e){let i=this.buildPath(t),r=this.pathToRanges(i),s=void 0===e?"|":e;return this.rangesToText(t,r,s)}cutIntoRanges(t,e){var i=this.buildPath(t),r=this.pathToRanges(i);return e||r.forEach((function(e){e.text=t.substring(e.s,e.e)})),r}cutIntoArray(t){var e=this.buildPath(t);return this.pathToRanges(e).map((function(e){return t.substring(e.s,e.e)}))}};class ic{constructor(t){this.fullText=t,this.curIndex=-1}getNext(){const t=++this.curIndex;let e=0,i="";void 0!==Xa.find((e=>e===this.fullText[t]))?e=1:void 0!==Za.find((e=>e===this.fullText[t]))&&(e=2);for(let r=t;r<this.fullText.length;++r){const t=this.fullText[r];if(1!==e)if(2!==e){if(!rc(t))return{buffer:i,type:e};i+=t,this.curIndex=r}else{const s=Za.find((e=>e===t));if(void 0===s)return{buffer:i,type:e};i+=s,this.curIndex=r}else if(i+=t,this.curIndex=r,">"===t)return{buffer:i,type:e}}if(i.length>0)return{buffer:i,type:e}}}function rc(t){return void 0===Xa.find((e=>e===t))&&void 0===Za.find((e=>e===t))}var sc;!function(t){t[t.Story=0]="Story",t[t.Library=1]="Library"}(sc||(sc={}));var nc={exports:{}},oc={},ac={},cc={},lc={},hc="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");lc.encode=function(t){if(0<=t&&t<hc.length)return hc[t];throw new TypeError("Must be between 0 and 63: "+t)},lc.decode=function(t){return 65<=t&&t<=90?t-65:97<=t&&t<=122?t-97+26:48<=t&&t<=57?t-48+52:43==t?62:47==t?63:-1};var uc=lc;cc.encode=function(t){var e,i="",r=function(t){return t<0?1+(-t<<1):0+(t<<1)}(t);do{e=31&r,(r>>>=5)>0&&(e|=32),i+=uc.encode(e)}while(r>0);return i},cc.decode=function(t,e,i){var r,s,n,o,a=t.length,c=0,l=0;do{if(e>=a)throw new Error("Expected more digits in base 64 VLQ value.");if(-1===(s=uc.decode(t.charCodeAt(e++))))throw new Error("Invalid base64 digit: "+t.charAt(e-1));r=!!(32&s),c+=(s&=31)<<l,l+=5}while(r);i.value=(o=(n=c)>>1,1&~n?o:-o),i.rest=e};var dc={};!function(t){t.getArg=function(t,e,i){if(e in t)return t[e];if(3===arguments.length)return i;throw new Error('"'+e+'" is a required argument.')};var e=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,i=/^data:.+\,.+$/;function r(t){var i=t.match(e);return i?{scheme:i[1],auth:i[2],host:i[3],port:i[4],path:i[5]}:null}function s(t){var e="";return t.scheme&&(e+=t.scheme+":"),e+="//",t.auth&&(e+=t.auth+"@"),t.host&&(e+=t.host),t.port&&(e+=":"+t.port),t.path&&(e+=t.path),e}function n(e){var i=e,n=r(e);if(n){if(!n.path)return e;i=n.path}for(var o,a=t.isAbsolute(i),c=i.split(/\/+/),l=0,h=c.length-1;h>=0;h--)"."===(o=c[h])?c.splice(h,1):".."===o?l++:l>0&&(""===o?(c.splice(h+1,l),l=0):(c.splice(h,2),l--));return""===(i=c.join("/"))&&(i=a?"/":"."),n?(n.path=i,s(n)):i}function o(t,e){""===t&&(t="."),""===e&&(e=".");var o=r(e),a=r(t);if(a&&(t=a.path||"/"),o&&!o.scheme)return a&&(o.scheme=a.scheme),s(o);if(o||e.match(i))return e;if(a&&!a.host&&!a.path)return a.host=e,s(a);var c="/"===e.charAt(0)?e:n(t.replace(/\/+$/,"")+"/"+e);return a?(a.path=c,s(a)):c}t.urlParse=r,t.urlGenerate=s,t.normalize=n,t.join=o,t.isAbsolute=function(t){return"/"===t.charAt(0)||e.test(t)},t.relative=function(t,e){""===t&&(t="."),t=t.replace(/\/$/,"");for(var i=0;0!==e.indexOf(t+"/");){var r=t.lastIndexOf("/");if(r<0)return e;if((t=t.slice(0,r)).match(/^([^\/]+:\/)?\/*$/))return e;++i}return Array(i+1).join("../")+e.substr(t.length+1)};var a=!("__proto__"in Object.create(null));function c(t){return t}function l(t){if(!t)return!1;var e=t.length;if(e<9)return!1;if(95!==t.charCodeAt(e-1)||95!==t.charCodeAt(e-2)||111!==t.charCodeAt(e-3)||116!==t.charCodeAt(e-4)||111!==t.charCodeAt(e-5)||114!==t.charCodeAt(e-6)||112!==t.charCodeAt(e-7)||95!==t.charCodeAt(e-8)||95!==t.charCodeAt(e-9))return!1;for(var i=e-10;i>=0;i--)if(36!==t.charCodeAt(i))return!1;return!0}function h(t,e){return t===e?0:null===t?1:null===e?-1:t>e?1:-1}t.toSetString=a?c:function(t){return l(t)?"$"+t:t},t.fromSetString=a?c:function(t){return l(t)?t.slice(1):t},t.compareByOriginalPositions=function(t,e,i){var r=h(t.source,e.source);return 0!==r||0!==(r=t.originalLine-e.originalLine)||0!==(r=t.originalColumn-e.originalColumn)||i||0!==(r=t.generatedColumn-e.generatedColumn)||0!==(r=t.generatedLine-e.generatedLine)?r:h(t.name,e.name)},t.compareByGeneratedPositionsDeflated=function(t,e,i){var r=t.generatedLine-e.generatedLine;return 0!==r||0!==(r=t.generatedColumn-e.generatedColumn)||i||0!==(r=h(t.source,e.source))||0!==(r=t.originalLine-e.originalLine)||0!==(r=t.originalColumn-e.originalColumn)?r:h(t.name,e.name)},t.compareByGeneratedPositionsInflated=function(t,e){var i=t.generatedLine-e.generatedLine;return 0!==i||0!==(i=t.generatedColumn-e.generatedColumn)||0!==(i=h(t.source,e.source))||0!==(i=t.originalLine-e.originalLine)||0!==(i=t.originalColumn-e.originalColumn)?i:h(t.name,e.name)},t.parseSourceMapInput=function(t){return JSON.parse(t.replace(/^\)]}'[^\n]*\n/,""))},t.computeSourceURL=function(t,e,i){if(e=e||"",t&&("/"!==t[t.length-1]&&"/"!==e[0]&&(t+="/"),e=t+e),i){var a=r(i);if(!a)throw new Error("sourceMapURL could not be parsed");if(a.path){var c=a.path.lastIndexOf("/");c>=0&&(a.path=a.path.substring(0,c+1))}e=o(s(a),e)}return n(e)}}(dc);var pc={},fc=dc,gc=Object.prototype.hasOwnProperty,mc="undefined"!=typeof Map;function yc(){this._array=[],this._set=mc?new Map:Object.create(null)}yc.fromArray=function(t,e){for(var i=new yc,r=0,s=t.length;r<s;r++)i.add(t[r],e);return i},yc.prototype.size=function(){return mc?this._set.size:Object.getOwnPropertyNames(this._set).length},yc.prototype.add=function(t,e){var i=mc?t:fc.toSetString(t),r=mc?this.has(t):gc.call(this._set,i),s=this._array.length;r&&!e||this._array.push(t),r||(mc?this._set.set(t,s):this._set[i]=s)},yc.prototype.has=function(t){if(mc)return this._set.has(t);var e=fc.toSetString(t);return gc.call(this._set,e)},yc.prototype.indexOf=function(t){if(mc){var e=this._set.get(t);if(e>=0)return e}else{var i=fc.toSetString(t);if(gc.call(this._set,i))return this._set[i]}throw new Error('"'+t+'" is not in the set.')},yc.prototype.at=function(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)},yc.prototype.toArray=function(){return this._array.slice()},pc.ArraySet=yc;var vc={},bc=dc;function wc(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}wc.prototype.unsortedForEach=function(t,e){this._array.forEach(t,e)},wc.prototype.add=function(t){var e,i,r,s,n,o;e=this._last,i=t,r=e.generatedLine,s=i.generatedLine,n=e.generatedColumn,o=i.generatedColumn,s>r||s==r&&o>=n||bc.compareByGeneratedPositionsInflated(e,i)<=0?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))},wc.prototype.toArray=function(){return this._sorted||(this._array.sort(bc.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},vc.MappingList=wc;var Sc=cc,_c=dc,kc=pc.ArraySet,Ec=vc.MappingList;function Ac(t){t||(t={}),this._file=_c.getArg(t,"file",null),this._sourceRoot=_c.getArg(t,"sourceRoot",null),this._skipValidation=_c.getArg(t,"skipValidation",!1),this._sources=new kc,this._names=new kc,this._mappings=new Ec,this._sourcesContents=null}Ac.prototype._version=3,Ac.fromSourceMap=function(t){var e=t.sourceRoot,i=new Ac({file:t.file,sourceRoot:e});return t.eachMapping((function(t){var r={generated:{line:t.generatedLine,column:t.generatedColumn}};null!=t.source&&(r.source=t.source,null!=e&&(r.source=_c.relative(e,r.source)),r.original={line:t.originalLine,column:t.originalColumn},null!=t.name&&(r.name=t.name)),i.addMapping(r)})),t.sources.forEach((function(r){var s=r;null!==e&&(s=_c.relative(e,r)),i._sources.has(s)||i._sources.add(s);var n=t.sourceContentFor(r);null!=n&&i.setSourceContent(r,n)})),i},Ac.prototype.addMapping=function(t){var e=_c.getArg(t,"generated"),i=_c.getArg(t,"original",null),r=_c.getArg(t,"source",null),s=_c.getArg(t,"name",null);this._skipValidation||this._validateMapping(e,i,r,s),null!=r&&(r=String(r),this._sources.has(r)||this._sources.add(r)),null!=s&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:e.line,generatedColumn:e.column,originalLine:null!=i&&i.line,originalColumn:null!=i&&i.column,source:r,name:s})},Ac.prototype.setSourceContent=function(t,e){var i=t;null!=this._sourceRoot&&(i=_c.relative(this._sourceRoot,i)),null!=e?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[_c.toSetString(i)]=e):this._sourcesContents&&(delete this._sourcesContents[_c.toSetString(i)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))},Ac.prototype.applySourceMap=function(t,e,i){var r=e;if(null==e){if(null==t.file)throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');r=t.file}var s=this._sourceRoot;null!=s&&(r=_c.relative(s,r));var n=new kc,o=new kc;this._mappings.unsortedForEach((function(e){if(e.source===r&&null!=e.originalLine){var a=t.originalPositionFor({line:e.originalLine,column:e.originalColumn});null!=a.source&&(e.source=a.source,null!=i&&(e.source=_c.join(i,e.source)),null!=s&&(e.source=_c.relative(s,e.source)),e.originalLine=a.line,e.originalColumn=a.column,null!=a.name&&(e.name=a.name))}var c=e.source;null==c||n.has(c)||n.add(c);var l=e.name;null==l||o.has(l)||o.add(l)}),this),this._sources=n,this._names=o,t.sources.forEach((function(e){var r=t.sourceContentFor(e);null!=r&&(null!=i&&(e=_c.join(i,e)),null!=s&&(e=_c.relative(s,e)),this.setSourceContent(e,r))}),this)},Ac.prototype._validateMapping=function(t,e,i,r){if(e&&"number"!=typeof e.line&&"number"!=typeof e.column)throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if((!(t&&"line"in t&&"column"in t&&t.line>0&&t.column>=0)||e||i||r)&&!(t&&"line"in t&&"column"in t&&e&&"line"in e&&"column"in e&&t.line>0&&t.column>=0&&e.line>0&&e.column>=0&&i))throw new Error("Invalid mapping: "+JSON.stringify({generated:t,source:i,original:e,name:r}))},Ac.prototype._serializeMappings=function(){for(var t,e,i,r,s=0,n=1,o=0,a=0,c=0,l=0,h="",u=this._mappings.toArray(),d=0,p=u.length;d<p;d++){if(t="",(e=u[d]).generatedLine!==n)for(s=0;e.generatedLine!==n;)t+=";",n++;else if(d>0){if(!_c.compareByGeneratedPositionsInflated(e,u[d-1]))continue;t+=","}t+=Sc.encode(e.generatedColumn-s),s=e.generatedColumn,null!=e.source&&(r=this._sources.indexOf(e.source),t+=Sc.encode(r-l),l=r,t+=Sc.encode(e.originalLine-1-a),a=e.originalLine-1,t+=Sc.encode(e.originalColumn-o),o=e.originalColumn,null!=e.name&&(i=this._names.indexOf(e.name),t+=Sc.encode(i-c),c=i)),h+=t}return h},Ac.prototype._generateSourcesContent=function(t,e){return t.map((function(t){if(!this._sourcesContents)return null;null!=e&&(t=_c.relative(e,t));var i=_c.toSetString(t);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null}),this)},Ac.prototype.toJSON=function(){var t={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(t.file=this._file),null!=this._sourceRoot&&(t.sourceRoot=this._sourceRoot),this._sourcesContents&&(t.sourcesContent=this._generateSourcesContent(t.sources,t.sourceRoot)),t},Ac.prototype.toString=function(){return JSON.stringify(this.toJSON())},ac.SourceMapGenerator=Ac;var Cc={},Rc={};!function(t){function e(i,r,s,n,o,a){var c=Math.floor((r-i)/2)+i,l=o(s,n[c],!0);return 0===l?c:l>0?r-c>1?e(c,r,s,n,o,a):a==t.LEAST_UPPER_BOUND?r<n.length?r:-1:c:c-i>1?e(i,c,s,n,o,a):a==t.LEAST_UPPER_BOUND?c:i<0?-1:i}t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2,t.search=function(i,r,s,n){if(0===r.length)return-1;var o=e(-1,r.length,i,r,s,n||t.GREATEST_LOWER_BOUND);if(o<0)return-1;for(;o-1>=0&&0===s(r[o],r[o-1],!0);)--o;return o}}(Rc);var xc={};function Ic(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function Nc(t,e,i,r){if(i<r){var s=i-1;Ic(t,(c=i,l=r,Math.round(c+Math.random()*(l-c))),r);for(var n=t[r],o=i;o<r;o++)e(t[o],n)<=0&&Ic(t,s+=1,o);Ic(t,s+1,o);var a=s+1;Nc(t,e,i,a-1),Nc(t,e,a+1,r)}var c,l}xc.quickSort=function(t,e){Nc(t,e,0,t.length-1)};var Tc=dc,Oc=Rc,Lc=pc.ArraySet,Mc=cc,Fc=xc.quickSort;function Dc(t,e){var i=t;return"string"==typeof t&&(i=Tc.parseSourceMapInput(t)),null!=i.sections?new Gc(i,e):new Bc(i,e)}function Bc(t,e){var i=t;"string"==typeof t&&(i=Tc.parseSourceMapInput(t));var r=Tc.getArg(i,"version"),s=Tc.getArg(i,"sources"),n=Tc.getArg(i,"names",[]),o=Tc.getArg(i,"sourceRoot",null),a=Tc.getArg(i,"sourcesContent",null),c=Tc.getArg(i,"mappings"),l=Tc.getArg(i,"file",null);if(r!=this._version)throw new Error("Unsupported version: "+r);o&&(o=Tc.normalize(o)),s=s.map(String).map(Tc.normalize).map((function(t){return o&&Tc.isAbsolute(o)&&Tc.isAbsolute(t)?Tc.relative(o,t):t})),this._names=Lc.fromArray(n.map(String),!0),this._sources=Lc.fromArray(s,!0),this._absoluteSources=this._sources.toArray().map((function(t){return Tc.computeSourceURL(o,t,e)})),this.sourceRoot=o,this.sourcesContent=a,this._mappings=c,this._sourceMapURL=e,this.file=l}function Uc(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}function Gc(t,e){var i=t;"string"==typeof t&&(i=Tc.parseSourceMapInput(t));var r=Tc.getArg(i,"version"),s=Tc.getArg(i,"sections");if(r!=this._version)throw new Error("Unsupported version: "+r);this._sources=new Lc,this._names=new Lc;var n={line:-1,column:0};this._sections=s.map((function(t){if(t.url)throw new Error("Support for url field in sections not implemented.");var i=Tc.getArg(t,"offset"),r=Tc.getArg(i,"line"),s=Tc.getArg(i,"column");if(r<n.line||r===n.line&&s<n.column)throw new Error("Section offsets must be ordered and non-overlapping.");return n=i,{generatedOffset:{generatedLine:r+1,generatedColumn:s+1},consumer:new Dc(Tc.getArg(t,"map"),e)}}))}Dc.fromSourceMap=function(t,e){return Bc.fromSourceMap(t,e)},Dc.prototype._version=3,Dc.prototype.__generatedMappings=null,Object.defineProperty(Dc.prototype,"_generatedMappings",{configurable:!0,enumerable:!0,get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),Dc.prototype.__originalMappings=null,Object.defineProperty(Dc.prototype,"_originalMappings",{configurable:!0,enumerable:!0,get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),Dc.prototype._charIsMappingSeparator=function(t,e){var i=t.charAt(e);return";"===i||","===i},Dc.prototype._parseMappings=function(t,e){throw new Error("Subclasses must implement _parseMappings")},Dc.GENERATED_ORDER=1,Dc.ORIGINAL_ORDER=2,Dc.GREATEST_LOWER_BOUND=1,Dc.LEAST_UPPER_BOUND=2,Dc.prototype.eachMapping=function(t,e,i){var r,s=e||null;switch(i||Dc.GENERATED_ORDER){case Dc.GENERATED_ORDER:r=this._generatedMappings;break;case Dc.ORIGINAL_ORDER:r=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var n=this.sourceRoot;r.map((function(t){var e=null===t.source?null:this._sources.at(t.source);return{source:e=Tc.computeSourceURL(n,e,this._sourceMapURL),generatedLine:t.generatedLine,generatedColumn:t.generatedColumn,originalLine:t.originalLine,originalColumn:t.originalColumn,name:null===t.name?null:this._names.at(t.name)}}),this).forEach(t,s)},Dc.prototype.allGeneratedPositionsFor=function(t){var e=Tc.getArg(t,"line"),i={source:Tc.getArg(t,"source"),originalLine:e,originalColumn:Tc.getArg(t,"column",0)};if(i.source=this._findSourceIndex(i.source),i.source<0)return[];var r=[],s=this._findMapping(i,this._originalMappings,"originalLine","originalColumn",Tc.compareByOriginalPositions,Oc.LEAST_UPPER_BOUND);if(s>=0){var n=this._originalMappings[s];if(void 0===t.column)for(var o=n.originalLine;n&&n.originalLine===o;)r.push({line:Tc.getArg(n,"generatedLine",null),column:Tc.getArg(n,"generatedColumn",null),lastColumn:Tc.getArg(n,"lastGeneratedColumn",null)}),n=this._originalMappings[++s];else for(var a=n.originalColumn;n&&n.originalLine===e&&n.originalColumn==a;)r.push({line:Tc.getArg(n,"generatedLine",null),column:Tc.getArg(n,"generatedColumn",null),lastColumn:Tc.getArg(n,"lastGeneratedColumn",null)}),n=this._originalMappings[++s]}return r},Cc.SourceMapConsumer=Dc,Bc.prototype=Object.create(Dc.prototype),Bc.prototype.consumer=Dc,Bc.prototype._findSourceIndex=function(t){var e,i=t;if(null!=this.sourceRoot&&(i=Tc.relative(this.sourceRoot,i)),this._sources.has(i))return this._sources.indexOf(i);for(e=0;e<this._absoluteSources.length;++e)if(this._absoluteSources[e]==t)return e;return-1},Bc.fromSourceMap=function(t,e){var i=Object.create(Bc.prototype),r=i._names=Lc.fromArray(t._names.toArray(),!0),s=i._sources=Lc.fromArray(t._sources.toArray(),!0);i.sourceRoot=t._sourceRoot,i.sourcesContent=t._generateSourcesContent(i._sources.toArray(),i.sourceRoot),i.file=t._file,i._sourceMapURL=e,i._absoluteSources=i._sources.toArray().map((function(t){return Tc.computeSourceURL(i.sourceRoot,t,e)}));for(var n=t._mappings.toArray().slice(),o=i.__generatedMappings=[],a=i.__originalMappings=[],c=0,l=n.length;c<l;c++){var h=n[c],u=new Uc;u.generatedLine=h.generatedLine,u.generatedColumn=h.generatedColumn,h.source&&(u.source=s.indexOf(h.source),u.originalLine=h.originalLine,u.originalColumn=h.originalColumn,h.name&&(u.name=r.indexOf(h.name)),a.push(u)),o.push(u)}return Fc(i.__originalMappings,Tc.compareByOriginalPositions),i},Bc.prototype._version=3,Object.defineProperty(Bc.prototype,"sources",{get:function(){return this._absoluteSources.slice()}}),Bc.prototype._parseMappings=function(t,e){for(var i,r,s,n,o,a=1,c=0,l=0,h=0,u=0,d=0,p=t.length,f=0,g={},m={},y=[],v=[];f<p;)if(";"===t.charAt(f))a++,f++,c=0;else if(","===t.charAt(f))f++;else{for((i=new Uc).generatedLine=a,n=f;n<p&&!this._charIsMappingSeparator(t,n);n++);if(s=g[r=t.slice(f,n)])f+=r.length;else{for(s=[];f<n;)Mc.decode(t,f,m),o=m.value,f=m.rest,s.push(o);if(2===s.length)throw new Error("Found a source, but no line and column");if(3===s.length)throw new Error("Found a source and line, but no column");g[r]=s}i.generatedColumn=c+s[0],c=i.generatedColumn,s.length>1&&(i.source=u+s[1],u+=s[1],i.originalLine=l+s[2],l=i.originalLine,i.originalLine+=1,i.originalColumn=h+s[3],h=i.originalColumn,s.length>4&&(i.name=d+s[4],d+=s[4])),v.push(i),"number"==typeof i.originalLine&&y.push(i)}Fc(v,Tc.compareByGeneratedPositionsDeflated),this.__generatedMappings=v,Fc(y,Tc.compareByOriginalPositions),this.__originalMappings=y},Bc.prototype._findMapping=function(t,e,i,r,s,n){if(t[i]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+t[i]);if(t[r]<0)throw new TypeError("Column must be greater than or equal to 0, got "+t[r]);return Oc.search(t,e,s,n)},Bc.prototype.computeColumnSpans=function(){for(var t=0;t<this._generatedMappings.length;++t){var e=this._generatedMappings[t];if(t+1<this._generatedMappings.length){var i=this._generatedMappings[t+1];if(e.generatedLine===i.generatedLine){e.lastGeneratedColumn=i.generatedColumn-1;continue}}e.lastGeneratedColumn=1/0}},Bc.prototype.originalPositionFor=function(t){var e={generatedLine:Tc.getArg(t,"line"),generatedColumn:Tc.getArg(t,"column")},i=this._findMapping(e,this._generatedMappings,"generatedLine","generatedColumn",Tc.compareByGeneratedPositionsDeflated,Tc.getArg(t,"bias",Dc.GREATEST_LOWER_BOUND));if(i>=0){var r=this._generatedMappings[i];if(r.generatedLine===e.generatedLine){var s=Tc.getArg(r,"source",null);null!==s&&(s=this._sources.at(s),s=Tc.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));var n=Tc.getArg(r,"name",null);return null!==n&&(n=this._names.at(n)),{source:s,line:Tc.getArg(r,"originalLine",null),column:Tc.getArg(r,"originalColumn",null),name:n}}}return{source:null,line:null,column:null,name:null}},Bc.prototype.hasContentsOfAllSources=function(){return!!this.sourcesContent&&(this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some((function(t){return null==t})))},Bc.prototype.sourceContentFor=function(t,e){if(!this.sourcesContent)return null;var i=this._findSourceIndex(t);if(i>=0)return this.sourcesContent[i];var r,s=t;if(null!=this.sourceRoot&&(s=Tc.relative(this.sourceRoot,s)),null!=this.sourceRoot&&(r=Tc.urlParse(this.sourceRoot))){var n=s.replace(/^file:\/\//,"");if("file"==r.scheme&&this._sources.has(n))return this.sourcesContent[this._sources.indexOf(n)];if((!r.path||"/"==r.path)&&this._sources.has("/"+s))return this.sourcesContent[this._sources.indexOf("/"+s)]}if(e)return null;throw new Error('"'+s+'" is not in the SourceMap.')},Bc.prototype.generatedPositionFor=function(t){var e=Tc.getArg(t,"source");if((e=this._findSourceIndex(e))<0)return{line:null,column:null,lastColumn:null};var i={source:e,originalLine:Tc.getArg(t,"line"),originalColumn:Tc.getArg(t,"column")},r=this._findMapping(i,this._originalMappings,"originalLine","originalColumn",Tc.compareByOriginalPositions,Tc.getArg(t,"bias",Dc.GREATEST_LOWER_BOUND));if(r>=0){var s=this._originalMappings[r];if(s.source===i.source)return{line:Tc.getArg(s,"generatedLine",null),column:Tc.getArg(s,"generatedColumn",null),lastColumn:Tc.getArg(s,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},Cc.BasicSourceMapConsumer=Bc,Gc.prototype=Object.create(Dc.prototype),Gc.prototype.constructor=Dc,Gc.prototype._version=3,Object.defineProperty(Gc.prototype,"sources",{get:function(){for(var t=[],e=0;e<this._sections.length;e++)for(var i=0;i<this._sections[e].consumer.sources.length;i++)t.push(this._sections[e].consumer.sources[i]);return t}}),Gc.prototype.originalPositionFor=function(t){var e={generatedLine:Tc.getArg(t,"line"),generatedColumn:Tc.getArg(t,"column")},i=Oc.search(e,this._sections,(function(t,e){var i=t.generatedLine-e.generatedOffset.generatedLine;return i||t.generatedColumn-e.generatedOffset.generatedColumn})),r=this._sections[i];return r?r.consumer.originalPositionFor({line:e.generatedLine-(r.generatedOffset.generatedLine-1),column:e.generatedColumn-(r.generatedOffset.generatedLine===e.generatedLine?r.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}},Gc.prototype.hasContentsOfAllSources=function(){return this._sections.every((function(t){return t.consumer.hasContentsOfAllSources()}))},Gc.prototype.sourceContentFor=function(t,e){for(var i=0;i<this._sections.length;i++){var r=this._sections[i].consumer.sourceContentFor(t,!0);if(r)return r}if(e)return null;throw new Error('"'+t+'" is not in the SourceMap.')},Gc.prototype.generatedPositionFor=function(t){for(var e=0;e<this._sections.length;e++){var i=this._sections[e];if(-1!==i.consumer._findSourceIndex(Tc.getArg(t,"source"))){var r=i.consumer.generatedPositionFor(t);if(r)return{line:r.line+(i.generatedOffset.generatedLine-1),column:r.column+(i.generatedOffset.generatedLine===r.line?i.generatedOffset.generatedColumn-1:0)}}}return{line:null,column:null}},Gc.prototype._parseMappings=function(t,e){this.__generatedMappings=[],this.__originalMappings=[];for(var i=0;i<this._sections.length;i++)for(var r=this._sections[i],s=r.consumer._generatedMappings,n=0;n<s.length;n++){var o=s[n],a=r.consumer._sources.at(o.source);a=Tc.computeSourceURL(r.consumer.sourceRoot,a,this._sourceMapURL),this._sources.add(a),a=this._sources.indexOf(a);var c=null;o.name&&(c=r.consumer._names.at(o.name),this._names.add(c),c=this._names.indexOf(c));var l={source:a,generatedLine:o.generatedLine+(r.generatedOffset.generatedLine-1),generatedColumn:o.generatedColumn+(r.generatedOffset.generatedLine===o.generatedLine?r.generatedOffset.generatedColumn-1:0),originalLine:o.originalLine,originalColumn:o.originalColumn,name:c};this.__generatedMappings.push(l),"number"==typeof l.originalLine&&this.__originalMappings.push(l)}Fc(this.__generatedMappings,Tc.compareByGeneratedPositionsDeflated),Fc(this.__originalMappings,Tc.compareByOriginalPositions)},Cc.IndexedSourceMapConsumer=Gc;var jc={},$c=ac.SourceMapGenerator,Pc=dc,qc=/(\r?\n)/,zc="$$$isSourceNode$$$";function Wc(t,e,i,r,s){this.children=[],this.sourceContents={},this.line=null==t?null:t,this.column=null==e?null:e,this.source=null==i?null:i,this.name=null==s?null:s,this[zc]=!0,null!=r&&this.add(r)}Wc.fromStringWithSourceMap=function(t,e,i){var r=new Wc,s=t.split(qc),n=0,o=function(){return t()+(t()||"");function t(){return n<s.length?s[n++]:void 0}},a=1,c=0,l=null;return e.eachMapping((function(t){if(null!==l){if(!(a<t.generatedLine)){var e=(i=s[n]||"").substr(0,t.generatedColumn-c);return s[n]=i.substr(t.generatedColumn-c),c=t.generatedColumn,h(l,e),void(l=t)}h(l,o()),a++,c=0}for(;a<t.generatedLine;)r.add(o()),a++;if(c<t.generatedColumn){var i=s[n]||"";r.add(i.substr(0,t.generatedColumn)),s[n]=i.substr(t.generatedColumn),c=t.generatedColumn}l=t}),this),n<s.length&&(l&&h(l,o()),r.add(s.splice(n).join(""))),e.sources.forEach((function(t){var s=e.sourceContentFor(t);null!=s&&(null!=i&&(t=Pc.join(i,t)),r.setSourceContent(t,s))})),r;function h(t,e){if(null===t||void 0===t.source)r.add(e);else{var s=i?Pc.join(i,t.source):t.source;r.add(new Wc(t.originalLine,t.originalColumn,s,e,t.name))}}},Wc.prototype.add=function(t){if(Array.isArray(t))t.forEach((function(t){this.add(t)}),this);else{if(!t[zc]&&"string"!=typeof t)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);t&&this.children.push(t)}return this},Wc.prototype.prepend=function(t){if(Array.isArray(t))for(var e=t.length-1;e>=0;e--)this.prepend(t[e]);else{if(!t[zc]&&"string"!=typeof t)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);this.children.unshift(t)}return this},Wc.prototype.walk=function(t){for(var e,i=0,r=this.children.length;i<r;i++)(e=this.children[i])[zc]?e.walk(t):""!==e&&t(e,{source:this.source,line:this.line,column:this.column,name:this.name})},Wc.prototype.join=function(t){var e,i,r=this.children.length;if(r>0){for(e=[],i=0;i<r-1;i++)e.push(this.children[i]),e.push(t);e.push(this.children[i]),this.children=e}return this},Wc.prototype.replaceRight=function(t,e){var i=this.children[this.children.length-1];return i[zc]?i.replaceRight(t,e):"string"==typeof i?this.children[this.children.length-1]=i.replace(t,e):this.children.push("".replace(t,e)),this},Wc.prototype.setSourceContent=function(t,e){this.sourceContents[Pc.toSetString(t)]=e},Wc.prototype.walkSourceContents=function(t){for(var e=0,i=this.children.length;e<i;e++)this.children[e][zc]&&this.children[e].walkSourceContents(t);var r=Object.keys(this.sourceContents);for(e=0,i=r.length;e<i;e++)t(Pc.fromSetString(r[e]),this.sourceContents[r[e]])},Wc.prototype.toString=function(){var t="";return this.walk((function(e){t+=e})),t},Wc.prototype.toStringWithSourceMap=function(t){var e={code:"",line:1,column:0},i=new $c(t),r=!1,s=null,n=null,o=null,a=null;return this.walk((function(t,c){e.code+=t,null!==c.source&&null!==c.line&&null!==c.column?(s===c.source&&n===c.line&&o===c.column&&a===c.name||i.addMapping({source:c.source,original:{line:c.line,column:c.column},generated:{line:e.line,column:e.column},name:c.name}),s=c.source,n=c.line,o=c.column,a=c.name,r=!0):r&&(i.addMapping({generated:{line:e.line,column:e.column}}),s=null,r=!1);for(var l=0,h=t.length;l<h;l++)10===t.charCodeAt(l)?(e.line++,e.column=0,l+1===h?(s=null,r=!1):r&&i.addMapping({source:c.source,original:{line:c.line,column:c.column},generated:{line:e.line,column:e.column},name:c.name})):e.column++})),this.walkSourceContents((function(t,e){i.setSourceContent(t,e)})),{code:e.code,map:i}},jc.SourceNode=Wc,oc.SourceMapGenerator=ac.SourceMapGenerator,oc.SourceMapConsumer=Cc.SourceMapConsumer,oc.SourceNode=jc.SourceNode;var Hc=Object.prototype.toString,Yc="undefined"!=typeof Buffer&&"function"==typeof Buffer.alloc&&"function"==typeof Buffer.allocUnsafe&&"function"==typeof Buffer.from;var Jc=function(t,e,i){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return r=t,"ArrayBuffer"===Hc.call(r).slice(8,-1)?function(t,e,i){e>>>=0;var r=t.byteLength-e;if(r<0)throw new RangeError("'offset' is out of bounds");if(void 0===i)i=r;else if((i>>>=0)>r)throw new RangeError("'length' is out of bounds");return Yc?Buffer.from(t.slice(e,e+i)):new Buffer(new Uint8Array(t.slice(e,e+i)))}(t,e,i):"string"==typeof t?function(t,e){if("string"==typeof e&&""!==e||(e="utf8"),!Buffer.isEncoding(e))throw new TypeError('"encoding" must be a valid string encoding');return Yc?Buffer.from(t,e):new Buffer(t,e)}(t,e):Yc?Buffer.from(t):new Buffer(t);var r};!function(t,e){var r,s=oc.SourceMapConsumer,n=i;try{(r=require("fs")).existsSync&&r.readFileSync||(r=null)}catch(t){}var o=Jc;function a(t,e){return t.require(e)}var c=!1,l=!1,h=!1,u="auto",d={},p={},f=/^data:application\/json[^,]+base64,/,g=[],m=[];function y(){return"browser"===u||"node"!==u&&("undefined"!=typeof window&&"function"==typeof XMLHttpRequest&&!(window.require&&window.module&&window.process&&"renderer"===window.process.type))}function v(t){return function(e){for(var i=0;i<t.length;i++){var r=t[i](e);if(r)return r}return null}}var b=v(g);function w(t,e){if(!t)return e;var i=n.dirname(t),r=/^\w+:\/\/[^\/]*/.exec(i),s=r?r[0]:"",o=i.slice(s.length);return s&&/^\/\w\:/.test(o)?(s+="/")+n.resolve(i.slice(s.length),e).replace(/\\/g,"/"):s+n.resolve(i.slice(s.length),e)}g.push((function(t){if(t=t.trim(),/^file:/.test(t)&&(t=t.replace(/file:\/\/\/(\w:)?/,(function(t,e){return e?"":"/"}))),t in d)return d[t];var e="";try{if(r)r.existsSync(t)&&(e=r.readFileSync(t,"utf8"));else{var i=new XMLHttpRequest;i.open("GET",t,!1),i.send(null),4===i.readyState&&200===i.status&&(e=i.responseText)}}catch(t){}return d[t]=e}));var S=v(m);function _(t){var e=p[t.source];if(!e){var i=S(t.source);i?(e=p[t.source]={url:i.url,map:new s(i.map)}).map.sourcesContent&&e.map.sources.forEach((function(t,i){var r=e.map.sourcesContent[i];if(r){var s=w(e.url,t);d[s]=r}})):e=p[t.source]={url:null,map:null}}if(e&&e.map&&"function"==typeof e.map.originalPositionFor){var r=e.map.originalPositionFor(t);if(null!==r.source)return r.source=w(e.url,r.source),r}return t}function k(t){var e=/^eval at ([^(]+) \((.+):(\d+):(\d+)\)$/.exec(t);if(e){var i=_({source:e[2],line:+e[3],column:e[4]-1});return"eval at "+e[1]+" ("+i.source+":"+i.line+":"+(i.column+1)+")"}return(e=/^eval at ([^(]+) \((.+)\)$/.exec(t))?"eval at "+e[1]+" ("+k(e[2])+")":t}function E(){var t,e="";if(this.isNative())e="native";else{!(t=this.getScriptNameOrSourceURL())&&this.isEval()&&(e=this.getEvalOrigin(),e+=", "),e+=t||"<anonymous>";var i=this.getLineNumber();if(null!=i){e+=":"+i;var r=this.getColumnNumber();r&&(e+=":"+r)}}var s="",n=this.getFunctionName(),o=!0,a=this.isConstructor();if(!(this.isToplevel()||a)){var c=this.getTypeName();"[object Object]"===c&&(c="null");var l=this.getMethodName();n?(c&&0!=n.indexOf(c)&&(s+=c+"."),s+=n,l&&n.indexOf("."+l)!=n.length-l.length-1&&(s+=" [as "+l+"]")):s+=c+"."+(l||"<anonymous>")}else a?s+="new "+(n||"<anonymous>"):n?s+=n:(s+=e,o=!1);return o&&(s+=" ("+e+")"),s}function A(t){var e={};return Object.getOwnPropertyNames(Object.getPrototypeOf(t)).forEach((function(i){e[i]=/^(?:is|get)/.test(i)?function(){return t[i].call(t)}:t[i]})),e.toString=E,e}function C(t,e){if(void 0===e&&(e={nextPosition:null,curPosition:null}),t.isNative())return e.curPosition=null,t;var i=t.getFileName()||t.getScriptNameOrSourceURL();if(i){var r=t.getLineNumber(),s=t.getColumnNumber()-1,n=/^v(10\.1[6-9]|10\.[2-9][0-9]|10\.[0-9]{3,}|1[2-9]\d*|[2-9]\d|\d{3,}|11\.11)/.test("object"==typeof process&&null!==process?process.version:"")?0:62;1===r&&s>n&&!y()&&!t.isEval()&&(s-=n);var o=_({source:i,line:r,column:s});e.curPosition=o;var a=(t=A(t)).getFunctionName;return t.getFunctionName=function(){return null==e.nextPosition?a():e.nextPosition.name||a()},t.getFileName=function(){return o.source},t.getLineNumber=function(){return o.line},t.getColumnNumber=function(){return o.column+1},t.getScriptNameOrSourceURL=function(){return o.source},t}var c=t.isEval()&&t.getEvalOrigin();return c?(c=k(c),(t=A(t)).getEvalOrigin=function(){return c},t):t}function R(t,e){h&&(d={},p={});for(var i=(t.name||"Error")+": "+(t.message||""),r={nextPosition:null,curPosition:null},s=[],n=e.length-1;n>=0;n--)s.push("\n    at "+C(e[n],r)),r.nextPosition=r.curPosition;return r.curPosition=r.nextPosition=null,i+s.reverse().join("")}function x(t){var e=/\n    at [^(]+ \((.*):(\d+):(\d+)\)/.exec(t.stack);if(e){var i=e[1],s=+e[2],n=+e[3],o=d[i];if(!o&&r&&r.existsSync(i))try{o=r.readFileSync(i,"utf8")}catch(t){o=""}if(o){var a=o.split(/(?:\r\n|\r|\n)/)[s-1];if(a)return i+":"+s+"\n"+a+"\n"+new Array(n).join(" ")+"^"}}return null}function I(t){var e=x(t),i=function(){if("object"==typeof process&&null!==process)return process.stderr}();i&&i._handle&&i._handle.setBlocking&&i._handle.setBlocking(!0),e&&(console.error(),console.error(e)),console.error(t.stack),function(t){if("object"==typeof process&&null!==process&&"function"==typeof process.exit)process.exit(t)}(1)}m.push((function(t){var e,i=function(t){var e;if(y())try{var i=new XMLHttpRequest;i.open("GET",t,!1),i.send(null),e=4===i.readyState?i.responseText:null;var r=i.getResponseHeader("SourceMap")||i.getResponseHeader("X-SourceMap");if(r)return r}catch(t){}e=b(t);for(var s,n,o=/(?:\/\/[@#][\s]*sourceMappingURL=([^\s'"]+)[\s]*$)|(?:\/\*[@#][\s]*sourceMappingURL=([^\s*'"]+)[\s]*(?:\*\/)[\s]*$)/gm;n=o.exec(e);)s=n;return s?s[1]:null}(t);if(!i)return null;if(f.test(i)){var r=i.slice(i.indexOf(",")+1);e=o(r,"base64").toString(),i=t}else i=w(t,i),e=b(i);return e?{url:i,map:e}:null}));var N=g.slice(0),T=m.slice(0);e.wrapCallSite=C,e.getErrorSource=x,e.mapSourcePosition=_,e.retrieveSourceMap=S,e.install=function(e){if((e=e||{}).environment&&(u=e.environment,-1===["node","browser","auto"].indexOf(u)))throw new Error("environment "+u+" was unknown. Available options are {auto, browser, node}");if(e.retrieveFile&&(e.overrideRetrieveFile&&(g.length=0),g.unshift(e.retrieveFile)),e.retrieveSourceMap&&(e.overrideRetrieveSourceMap&&(m.length=0),m.unshift(e.retrieveSourceMap)),e.hookRequire&&!y()){var i=a(t,"module"),r=i.prototype._compile;r.__sourceMapSupport||(i.prototype._compile=function(t,e){return d[e]=t,p[e]=void 0,r.call(this,t,e)},i.prototype._compile.__sourceMapSupport=!0)}if(h||(h="emptyCacheBetweenOperations"in e&&e.emptyCacheBetweenOperations),c||(c=!0,Error.prepareStackTrace=R),!l){var s=!("handleUncaughtExceptions"in e)||e.handleUncaughtExceptions;try{!1===a(t,"worker_threads").isMainThread&&(s=!1)}catch(t){}s&&"object"==typeof process&&null!==process&&"function"==typeof process.on&&(l=!0,n=process.emit,process.emit=function(t){if("uncaughtException"===t){var e=arguments[1]&&arguments[1].stack,i=this.listeners(t).length>0;if(e&&!i)return I(arguments[1])}return n.apply(this,arguments)})}var n},e.resetRetrieveHandlers=function(){g.length=0,m.length=0,g=N.slice(0),m=T.slice(0),S=v(m),b=v(g)}}(nc,nc.exports);var Kc=u(nc.exports);function Vc(){return Xc}const Xc=new Map;function Zc(){Xc.set(0,{id:0,asset_id:0,name:"",image:"",avatar:{id:"",name:""},ended:!1,summary:{progress:[]},group:[],author:[],illustrator:[],short_mini_story:"",mini_story:"",dynamic_links:"",to_be_continue:"",require_ending:[],recommended_next_story:[],ignore:!1,contest:!1,precarious:!1}),console.log(`[ISP] loaded ${Xc.size} stories`)}var Qc,tl;function el(t){for(let e=0;e<Qc.MAX;++e)if(t.toUpperCase()===Qc[e].toUpperCase())return e;throw new Error(`getRoomType: unknow type [${t}]`)}!function(t){t[t.NOVEL=0]="NOVEL",t[t.CHAT=1]="CHAT",t[t.MAX=2]="MAX"}(Qc||(Qc={})),function(t){t.NONE="none",t.NEW="new",t.UPDATE="update"}(tl||(tl={}));class il{constructor(t,e,i,r,s,n,o){this.storyID=t,this.type=e,this.fileName=i,this.label=r,this.detail=n,this.data=s,this.map=new Map,this.mapName=new Map,this.status=void 0===o?tl.NONE:o;for(let t=0;t<s.length;++t){const e=s[t].label;void 0!==e&&this.map.set(e,t);const i=s[t].name;void 0!==i&&this.mapName.set(i,t)}}getByIndex(t){if(!(t>=this.data.length))return this.data[t]}getByLabel(t){const e=this.map.get(t);if(void 0!==e)return this.getByIndex(e)}getNodeStoryByLabel(t){const e=this.getByLabel(t);if(void 0!==e&&("novel"===e.type||"chat"===e.type||"light_novel"===e.type))return e}getIndexByLabel(t){const e=this.map.get(t);if(void 0===e)throw new Error(`getIndexByLabel[${t}]: missing label`);return e}getNodeStoryByDay(t){const e=[];for(const i of this.data){if("novel"!==i.type&&"chat"!==i.type&&"light_novel"!==i.type)continue;const r=i;r.day===t&&e.push(r)}return e}getNodeStory(){const t=[];for(const e of this.data)"novel"!==e.type&&"chat"!==e.type&&"light_novel"!==e.type||t.push(e);return t}getFirstNodeStory(){for(const t of this.data){if("novel"!==t.type&&"chat"!==t.type&&"light_novel"!==t.type)continue;return t}throw new Error("getFirstNodeStory: node story not found")}getToBeContinueNodeStory(){for(let t=this.data.length;--t>=0;){const e=this.data[t];if("novel"!==e.type&&"chat"!==e.type&&"light_novel"!==e.type)continue;const i=e;if(i.to_be_continue)return i}throw new Error("getLastNodeStory: node story not found")}getModState(){const t=[];for(const e of this.data)if("novel_choice"===e.type||"chat_choice"===e.type)("novel_choice"===e.type||"chat_choice"===e.type)&&t.push(e.state);else if("goto"===e.type){const i=e;void 0!==i.state&&t.push(i.state)}else if("image_on_exit"===e.type){const i=e;void 0!==i.state&&t.push(i.state)}return t}getModVariable(){const t=new Map;for(const e of this.data)if("novel_choice"===e.type||"chat_choice"===e.type){let i;if(("novel_choice"===e.type||"chat_choice"===e.type)&&(i=e.choice),i)for(const e of i){const i=e.update;if(i)for(const e of i){const i=e.split(" ")[0];t.set(i,!0)}}}const e=[];for(const i of t.keys())e.push(i);return e}isRoomTypeLocked(t){const e=this.getByLabel(t);if(void 0===e||"novel"!==e.type&&"chat"!==e.type&&"light_novel"!==e.type)return!1;const i=e;let r=0;for(const t of i.locked.cost)r+=t.value;return void 0!==i.locked.conditions&&i.locked.conditions.length>0||r>0}getStoryID(){return this.storyID}getType(){return this.type}getFileName(){return this.fileName}getLabel(){return this.label}getData(){return this.data}getDetail(){return this.detail}getLabelCount(){return this.mapName.size}}function rl(t){const e=t.match(/\S+/g);if(null===e)throw new Error("invalid goto format");return e[0]}function sl(t,e,i){const r=function(t){const e=new Map;for(const i of t)switch(i.type){case"chat_choice":case"novel_choice":for(const t of i.choice){const i=t.goto;void 0!==i&&nl(i,e)}break;case"goto":nl(i.goto,e)}return e}(i);for(const[s,n]of r){if(void 0===ol(s,i))throw new Error(`checkJumpLabel: jump target not found, label: #${s} type: #${t} name: #${e}`)}}function nl(t,e){if(Array.isArray(t))for(const i of t){const t=rl(i);void 0===e.get(t)&&e.set(t,!0)}else{const i=rl(t);void 0===e.get(i)&&e.set(i,!0)}}function ol(t,e){const i=e.findIndex((e=>void 0!==e.label&&e.label===t));if(!(i<0||i>=e.length))return i}const al=1e4;function cl(t,e,i,r){if("novel"===e||"chat"===e||"light_novel"===e)return;const s=ll(0,t,e,i,r.map((t=>({node:t,visit:!1}))));if(void 0!==s)throw new Error(`checkRoomEnd storyId[${t}] type[${e}] name[${i}] ${s}`)}function ll(t,e,i,r,s){let n=0;for(;t<s.length;){if(n++,n>al)throw new Error(`checkRoomEnd: storyId[${e}] type[${i}] name[${r}] loop more than #${al}`);const o=s[t];if(o.visit)return;switch(o.node.type){case"novel":case"chat":case"light_novel":if(o.visit||o.node.to_be_continue)return;t++,o.visit=!0;break;case"goto":return void hl(o.node.goto,s,(n=>{if(n<=t)throw new Error(`checkRoomEnd::goto storyId[${e}] type[${i}] name[${r}] label #${s[n].node.label} index #${n} is less than #${t}`);ll(n,e,i,r,s)}));case"ending":return;default:t++,o.visit=!0}}throw new Error(`checkRoomEnd storyId[${e}] type[${i}] name[${r}]\nerror: missing node ending`)}function hl(t,e,i){if(Array.isArray(t))for(const r of t)i(ul(rl(r),e));else i(ul(rl(t),e))}function ul(t,e){const i=e.findIndex((e=>void 0!==e.node.label&&e.node.label===t));if(i<0||i>=e.length)throw new Error(`getIndexByLabel: unexpected index #${i}`);return i}const dl="001",pl="002",fl="003",gl="004",ml="005",yl="006";function vl(t){return`(error_${t})`}const bl=1e4;function wl(t,e,i){if("novel"!==t&&"chat"!==t)return;return Sl(0,void 0,t,e,i.map((t=>({node:t,visit_found_cg:!1,visit_not_found_cg:!1}))))}function Sl(t,e,i,r,s){let n=0;for(;t<s.length;){if(n++,n>bl)throw new Error(`checkCGEmpty: loop more than #${bl} type: #${i} name: #${r}`);const o=s[t];if(o.visit_found_cg&&void 0!==e||o.visit_not_found_cg&&void 0===e)return;switch(o.node.type){case"chat_choice":case"novel_choice":let n=!1;for(const a of o.node.choice){const o=a.goto;void 0!==o?kl(o,s,(n=>{if(n<=t)throw new Error(`checkCGEmpty::choice label #${s[n].node.label} index #${n} is less than #${t} type: #${i} name: #${r}`);Sl(n,e,i,r,s)})):n=!0}if(!n)return;t+=1;break;case"goto":return void kl(o.node.goto,s,(n=>{if(n<=t)throw new Error(`checkCGEmpty::goto label #${s[n].node.label} index #${n} is less than #${t} type: #${i} name: #${r}`);Sl(n,e,i,r,s)}));default:const a=_l(t,s,e);if(void 0===a)throw new Error(`checkCGEmpty type[${i}] name[${r}] format error: missing cg empty before background ${vl(yl)} [${JSON.stringify(s[t])}]`);e=a.found,t=a.next_index,o.visit_found_cg||(o.visit_found_cg=void 0!==a.found),o.visit_not_found_cg||(o.visit_not_found_cg=void 0===a.found)}}}function _l(t,e,i){const r=e[t],s=t+1;return"cg"!==r.node.type&&"background"!==r.node.type?{found:i,next_index:s}:void 0===i?("cg"===r.node.type&&"empty"!==r.node.cg&&(i=r),{found:i,next_index:s}):"cg"===r.node.type&&"empty"===r.node.cg?{found:i=void 0,next_index:s}:void 0===i||"background"!==r.node.type?{found:i,next_index:s}:void 0}function kl(t,e,i){if(Array.isArray(t))for(const r of t)i(El(rl(r),e));else i(El(rl(t),e))}function El(t,e){const i=e.findIndex((e=>void 0!==e.node.label&&e.node.label===t));if(i<0||i>=e.length)throw new Error(`getIndexByLabel: unexpected index #${i}`);return i}function Al(t,e){return e>0?h.join(t,e.toString()):t}var Cl;!function(t){t[t.STRING=0]="STRING",t[t.NUMBER=1]="NUMBER",t[t.BOOLEAN=2]="BOOLEAN",t[t.STRING_ARRAY=3]="STRING_ARRAY",t[t.CHOICE_SKIP=4]="CHOICE_SKIP",t[t.CHOICE_MESSAGE=5]="CHOICE_MESSAGE",t[t.STRING_OR_ARRAY_STRING=6]="STRING_OR_ARRAY_STRING",t[t.NOTIFY=7]="NOTIFY",t[t.LOCKED=8]="LOCKED",t[t.CONDITION_ARRAY=9]="CONDITION_ARRAY",t[t.COST=10]="COST",t[t.COST_ARRAY=11]="COST_ARRAY"}(Cl||(Cl={}));const Rl=["rp","var"];function xl(t){const e=Zh(new vh,t);return void 0!==e?e:rh([{cmd:"label",type:Cl.STRING,value:t.label,require:!1},{cmd:"music",type:Cl.STRING,value:t.music,require:!0}])}function Il(t){const e=Zh(new bh,t);return void 0!==e?e:rh([{cmd:"label",type:Cl.STRING,value:t.label,require:!1},{cmd:"background",type:Cl.STRING,value:t.background,require:!0}])}function Nl(t){const e=Zh(new wh,t);return void 0!==e?e:rh([{cmd:"label",type:Cl.STRING,value:t.label,require:!1},{cmd:"cg",type:Cl.STRING,value:t.cg,require:!0}])}function Tl(t){const e=Zh(new Sh,t);if(void 0!==e)return e;const i=ih(t.character);return void 0!==i?i:rh([{cmd:"label",type:Cl.STRING,value:t.label,require:!1},{cmd:"character",type:Cl.STRING,value:t.character,require:!0},{cmd:"msg",type:Cl.STRING,value:t.msg,require:!0},{cmd:"position",type:Cl.STRING,value:t.position,require:!1},{cmd:"act",type:Cl.STRING,value:t.act,require:!1},{cmd:"override_name",type:Cl.STRING,value:t.override_name,require:!1}])}function Ol(t){const e=Zh(new _h,t);return void 0!==e?e:rh([{cmd:"hide_msg",type:Cl.BOOLEAN,value:t.hide_msg,require:!0},{cmd:"label",type:Cl.STRING,value:t.label,require:!1}])}function Ll(t){const e=Zh(new kh,t);if(void 0!==e)return e;const i=ih(t.avatar);return void 0!==i?i:rh([{cmd:"label",type:Cl.STRING,value:t.label,require:!1},{cmd:"delay",type:Cl.NUMBER,value:t.delay,require:!1},{cmd:"avatar",type:Cl.STRING,value:t.avatar,require:!0},{cmd:"msg",type:Cl.STRING,value:t.msg,require:!0},{cmd:"frame",type:Cl.STRING,value:t.frame,require:!1},{cmd:"override_name",type:Cl.STRING,value:t.override_name,require:!1},{cmd:"style",type:Cl.STRING_OR_ARRAY_STRING,value:t.style,require:!1}])}function Ml(t){const e=Zh(new Eh,t);return void 0!==e?e:rh([{cmd:"label",type:Cl.STRING,value:t.label,require:!1},{cmd:"shake",type:Cl.STRING,value:t.shake,require:!0}])}function Fl(t){const e=Zh(new Ah,t);if(void 0!==e)return e;const i=ih(t.sound);return void 0!==i?i:rh([{cmd:"label",type:Cl.STRING,value:t.label,require:!1},{cmd:"sound",type:Cl.STRING,value:t.sound,require:!0}])}function Dl(t){const e=Zh(new Ch,t);if(void 0!==e)return e;const i=mh(t.state);if(void 0!==i)return`novel choice error: ${i}`;const r=ih(t.character);return void 0!==r?r:rh([{cmd:"label",type:Cl.STRING,value:t.label,require:!1},{cmd:"character",type:Cl.STRING,value:t.character,require:!0},{cmd:"state",type:Cl.STRING,value:t.state,require:!0},{cmd:"skip",type:Cl.CHOICE_SKIP,value:t.skip,require:!1},{cmd:"choice",type:Cl.CHOICE_MESSAGE,value:t.choice,require:!0},{cmd:"override_name",type:Cl.STRING,value:t.override_name,require:!1}])}function Bl(t){const e=Zh(new Nh,t);if(void 0!==e)return e;const i=mh(t.state);if(void 0!==i)return`chat choice error: ${i}`;const r=ih(t.avatar);return void 0!==r?r:rh([{cmd:"label",type:Cl.STRING,value:t.label,require:!1},{cmd:"delay",type:Cl.NUMBER,value:t.delay,require:!1},{cmd:"avatar",type:Cl.STRING,value:t.avatar,require:!0},{cmd:"state",type:Cl.STRING,value:t.state,require:!0},{cmd:"skip",type:Cl.CHOICE_SKIP,value:t.skip,require:!1},{cmd:"choice",type:Cl.CHOICE_MESSAGE,value:t.choice,require:!0},{cmd:"override_name",type:Cl.STRING,value:t.override_name,require:!1}])}function Ul(t){const e=Zh(new Th,t);if(void 0!==e)return e;const i=ih(t.character);return void 0!==i?i:rh([{cmd:"label",type:Cl.STRING,value:t.label,require:!1},{cmd:"act",type:Cl.STRING,value:t.act,require:!1},{cmd:"character",type:Cl.STRING,value:t.character,require:!0},{cmd:"position",type:Cl.STRING,value:t.position,require:!1},{cmd:"transition",type:Cl.STRING,value:t.transition,require:!1}])}function Gl(t){const e=Zh(new Oh,t);if(void 0!==e)return e;const i=rh([{cmd:"label",type:Cl.STRING,value:t.label,require:!1},{cmd:"goto",type:Cl.STRING_OR_ARRAY_STRING,value:t.goto,require:!0},{cmd:"state",type:Cl.STRING,value:t.state,require:!1}]);if(i)return i;if(!Array.isArray(t.goto))return;if(void 0===t.state&&function(t){for(const e of t)if(gh(e))return!0;return!1}(t.goto))return"variable detect need state";const r=t.goto[t.goto.length-1].match(/\S+/g);return null!==r&&r.length>1?"last goto must be no condition":void 0}function jl(t,e){const i=Zh(new Lh,e);if(void 0!==i)return i;if(void 0!==e.avatar){const t=ih(e.avatar);if(void 0!==t)return t}const r=[{cmd:"label",type:Cl.STRING,value:e.label,require:!1},{cmd:"image",type:Cl.STRING,value:e.image,require:!0},{cmd:"delay",type:Cl.NUMBER,value:e.delay,require:!1},{cmd:"override_name",type:Cl.STRING,value:e.override_name,require:!1}];return"chat"===t&&r.push({cmd:"avatar",type:Cl.STRING,value:e.avatar,require:!0}),"light_novel"===t&&r.push({cmd:"width",type:Cl.NUMBER,value:e.width,require:!1},{cmd:"height",type:Cl.NUMBER,value:e.height,require:!1}),rh(r)}function $l(t){const e=Zh(new Mh,t);return void 0!==e?e:rh([{cmd:"label",type:Cl.STRING,value:t.label,require:!1},{cmd:"delay",type:Cl.NUMBER,value:t.delay,require:!1},{cmd:"sys",type:Cl.STRING,value:t.sys,require:!0}])}function Pl(t){const e=Zh(new Fh,t);if(void 0!==e)return e;const i=ih(t.avatar);return void 0!==i?i:rh([{cmd:"label",type:Cl.STRING,value:t.label,require:!1},{cmd:"delay",type:Cl.NUMBER,value:t.delay,require:!1},{cmd:"avatar",type:Cl.STRING,value:t.avatar,require:!0},{cmd:"sticker",type:Cl.STRING,value:t.sticker,require:!0},{cmd:"override_name",type:Cl.STRING,value:t.override_name,require:!1}])}function ql(t){const e=Zh(new Dh,t);if(void 0!==e)return e;if(void 0!==t.avatars)for(const e of t.avatars){const t=ih(e);if(void 0!==t)return t}return rh([{cmd:"avatars",type:Cl.STRING_ARRAY,value:t.avatars,require:!1},{cmd:"day",type:Cl.NUMBER,value:t.day,require:!1},{cmd:"free_heart",type:Cl.BOOLEAN,value:t.free_heart,require:!1},{cmd:"label",type:Cl.STRING,value:t.label,require:!0},{cmd:"models",type:Cl.STRING_ARRAY,value:t.models,require:!1},{cmd:"novel",type:Cl.STRING,value:t.novel,require:!0},{cmd:"title",type:Cl.STRING,value:t.title,require:!0},{cmd:"notify",type:Cl.NOTIFY,value:t.notify,require:!1},{cmd:"time",type:Cl.STRING,value:t.time,require:!1},{cmd:"end_day",type:Cl.BOOLEAN,value:t.end_day,require:!1},{cmd:"force_heart",type:Cl.NUMBER,value:t.force_heart,require:!1},{cmd:"half_heart",type:Cl.BOOLEAN,value:t.half_heart,require:!1},{cmd:"end_game",type:Cl.STRING,value:t.end_game,require:!1},{cmd:"room_condition",type:Cl.NUMBER,value:t.room_condition,require:!1},{cmd:"locked",type:Cl.LOCKED,value:t.locked,require:!1},{cmd:"cost",type:Cl.COST,value:t.cost,require:!1},{cmd:"to_be_continue",type:Cl.BOOLEAN,value:t.to_be_continue,require:!1},{cmd:"prologue",type:Cl.BOOLEAN,value:t.prologue,require:!1}])}function zl(t){const e=Zh(new Bh,t);return void 0!==e?e:rh([{cmd:"light_novel",type:Cl.STRING,value:t.light_novel,require:!0},{cmd:"label",type:Cl.STRING,value:t.label,require:!0},{cmd:"title",type:Cl.STRING,value:t.title,require:!0},{cmd:"cost",type:Cl.COST,value:t.cost,require:!1},{cmd:"day",type:Cl.NUMBER,value:t.day,require:!1},{cmd:"room_condition",type:Cl.NUMBER,value:t.room_condition,require:!1},{cmd:"end_game",type:Cl.STRING,value:t.end_game,require:!1},{cmd:"locked",type:Cl.LOCKED,value:t.locked,require:!1},{cmd:"to_be_continue",type:Cl.BOOLEAN,value:t.to_be_continue,require:!1},{cmd:"prologue",type:Cl.BOOLEAN,value:t.prologue,require:!1}])}function Wl(t){const e=Zh(new Gh,t);if(void 0!==e)return e;if(void 0!==t.avatars)for(const e of t.avatars){const t=ih(e);if(void 0!==t)return t}return rh([{cmd:"avatars",type:Cl.STRING_ARRAY,value:t.avatars,require:!1},{cmd:"day",type:Cl.NUMBER,value:t.day,require:!1},{cmd:"free_heart",type:Cl.BOOLEAN,value:t.free_heart,require:!1},{cmd:"label",type:Cl.STRING,value:t.label,require:!0},{cmd:"chat",type:Cl.STRING,value:t.chat,require:!0},{cmd:"title",type:Cl.STRING,value:t.title,require:!0},{cmd:"notify",type:Cl.NOTIFY,value:t.notify,require:!1},{cmd:"time",type:Cl.STRING,value:t.time,require:!1},{cmd:"end_day",type:Cl.BOOLEAN,value:t.end_day,require:!1},{cmd:"force_heart",type:Cl.NUMBER,value:t.force_heart,require:!1},{cmd:"half_heart",type:Cl.BOOLEAN,value:t.half_heart,require:!1},{cmd:"end_game",type:Cl.STRING,value:t.end_game,require:!1},{cmd:"room_condition",type:Cl.NUMBER,value:t.room_condition,require:!1},{cmd:"locked",type:Cl.LOCKED,value:t.locked,require:!1},{cmd:"cost",type:Cl.COST,value:t.cost,require:!1},{cmd:"to_be_continue",type:Cl.BOOLEAN,value:t.to_be_continue,require:!1},{cmd:"prologue",type:Cl.BOOLEAN,value:t.prologue,require:!1},{cmd:"theme",type:Cl.STRING,value:t.theme,require:!1}])}function Hl(t){const e=Zh(new jh,t);return void 0!==e?e:rh([{cmd:"label",type:Cl.STRING,value:t.label,require:!1},{cmd:"delay",type:Cl.NUMBER,value:t.delay,require:!0}])}function Yl(t){const e=Zh(new $h,t);return void 0!==e?e:rh([{cmd:"label",type:Cl.STRING,value:t.label,require:!1},{cmd:"image_on_exit",type:Cl.STRING_ARRAY,value:t.image_on_exit,require:!0},{cmd:"state",type:Cl.STRING,value:t.state,require:!1}])}function Jl(t){const e=Zh(new Ph,t);return void 0!==e?e:rh([{cmd:"label",type:Cl.STRING,value:t.label,require:!1},{cmd:"conclusion_image",type:Cl.STRING,value:t.conclusion_image,require:!0},{cmd:"delay",type:Cl.NUMBER,value:t.delay,require:!1}])}function Kl(t){const e=Zh(new Uh,t);return void 0!==e?e:rh([{cmd:"msg",type:Cl.STRING,value:t.msg,require:!0},{cmd:"align",type:Cl.STRING,value:t.align,require:!1},{cmd:"label",type:Cl.STRING,value:t.label,require:!1}])}function Vl(t){const e=Zh(new qh,t);return void 0!==e?e:rh([{cmd:"label",type:Cl.STRING,value:t.label,require:!1},{cmd:"conclusion_msg",type:Cl.STRING,value:t.conclusion_msg,require:!0},{cmd:"params",type:Cl.STRING_ARRAY,value:t.params,require:!1},{cmd:"delay",type:Cl.NUMBER,value:t.delay,require:!1}])}function Xl(t){const e=Zh(new zh,t);return void 0!==e?e:rh([{cmd:"label",type:Cl.STRING,value:t.label,require:!0}])}function Zl(t){const e=Zh(new Wh,t);return void 0!==e?e:rh([{cmd:"label",type:Cl.STRING,value:t.label,require:!1},{cmd:"ending title",type:Cl.STRING,value:t.ending.title,require:!0},{cmd:"ending subtitle",type:Cl.STRING,value:t.ending.subtitle,require:!1},{cmd:"ending story suggest",type:Cl.NUMBER,value:t.ending.story_suggest,require:!1}])}function Ql(t){const e=Zh(new Hh,t);return void 0!==e?e:rh([{cmd:"label",type:Cl.STRING,value:t.label,require:!1},{cmd:"chat_mode",type:Cl.STRING,value:t.chat_mode,require:!0}])}function th(t){const e=Zh(new Yh,t);return void 0!==e?e:rh([{cmd:"typing",type:Cl.BOOLEAN,value:t.typing,require:!0},{cmd:"avatar",type:Cl.STRING,value:t.avatar,require:!1},{cmd:"label",type:Cl.STRING,value:t.label,require:!1},{cmd:"delay",type:Cl.NUMBER,value:t.delay,require:!1}])}function eh(t){const e=Zh(new Jh,t);return void 0!==e?e:rh([{cmd:"image",type:Cl.STRING,value:t.image,require:!0},{cmd:"override_avatar",type:Cl.STRING,value:t.override_avatar,require:!0},{cmd:"label",type:Cl.STRING,value:t.label,require:!1}])}function ih(t){if(new RegExp(/[\u0E00-\u0E7F]+/g).test(t))return`detect thai language ${vl(ml)}`}function rh(t){for(const e of t){let t;if(e.type===Cl.STRING?t=sh(e.value,e.require):e.type===Cl.NUMBER?t=nh(e.value,e.require):e.type===Cl.BOOLEAN?t=oh(e.value,e.require):e.type===Cl.STRING_ARRAY?t=ah(e.value,e.require):e.type===Cl.CHOICE_SKIP?t=ch(e.value,e.require):e.type===Cl.CHOICE_MESSAGE?t=lh(e.value,e.require):e.type===Cl.NOTIFY?t=hh(e.value,e.require):e.type===Cl.LOCKED?t=uh(e.value,e.require):e.type===Cl.COST?t=dh(e.value,e.require):e.type===Cl.COST_ARRAY?t=ph(e.value,e.require):e.type===Cl.CONDITION_ARRAY?t=fh(e.value,e.require):e.type===Cl.STRING_OR_ARRAY_STRING&&(t=sh(e.value,e.require),void 0!==t&&(t=ah(e.value,e.require))),t)return`${e.cmd}: ${t}`}}function sh(t,e){return e&&void 0===t?"string missing":void 0!==t&&"string"!=typeof t?`not string ${vl(dl)}`:void 0}function nh(t,e){return e&&void 0===t?"number missing":void 0===t||"number"==typeof t&&!isNaN(t)?void 0:`not number ${vl(pl)}`}function oh(t,e){return e&&void 0===t?"boolean missing":void 0!==t&&"boolean"!=typeof t?"not boolean":void 0}function ah(t,e){if(e&&void 0===t)return"string array missing";if(void 0===t)return;if(!Array.isArray(t))return"string not array";const i=[];return t.forEach((t=>{const r=sh(t,e);void 0!==r&&i.push(r)})),i.length>0?JSON.stringify(i):void 0}function ch(t,e){if(e&&void 0===t)return"choice skip missing";if(void 0!==t){const e=t,i=Zh(new Rh,e);return void 0!==i?i:rh([{cmd:"msg",type:Cl.STRING,value:e.msg,require:!1},{cmd:"goto",type:Cl.STRING_OR_ARRAY_STRING,value:e.goto,require:!0}])}}function lh(t,e){if(e&&void 0===t)return"choice message missing";if(void 0===t)return;const i=t;if(!Array.isArray(i))return"choice message not array";const r=[];return i.forEach((t=>{const e=Zh(new Ih,t);if(void 0!==e)return e;const i=rh([{cmd:"update",type:Cl.STRING_ARRAY,value:t.update,require:!1},{cmd:"goto",type:Cl.STRING_OR_ARRAY_STRING,value:t.goto,require:!1},{cmd:"msg",type:Cl.STRING,value:t.msg,require:!0},{cmd:"msg_override",type:Cl.STRING,value:t.msg_override,require:!1},{cmd:"cost",type:Cl.NUMBER,value:t.cost,require:!1}]);if(void 0!==i&&r.push(i),void 0!==t.update)for(const e of t.update){const t=e.match(/\S+/g);if(null===t||3!==t.length){r.push(`update invalid format ${vl(fl)}`);continue}if("+="!==t[1]&&"-="!==t[1]){r.push(`invalid update parameter operator of ${e} (operator must be += or -=)`);continue}const i=Number(t[2]);Number.isNaN(i)&&r.push(`update value must be number #${t[2]}`);const s=yh(t[0]);void 0!==s&&r.push(s)}})),r.length>0?JSON.stringify(r):void 0}function hh(t,e){if(e&&void 0===t)return"notify missing";if(void 0!==t){const e=t,i=Zh(new xh,e);return void 0!==i?i:rh([{cmd:"title",type:Cl.STRING,value:e.title,require:!0},{cmd:"content",type:Cl.STRING,value:e.content,require:!0}])}}function uh(t,e){if(e&&void 0===t)return"locked missing";if(void 0!==t){const e=t,i=Zh(new Xh,e);return void 0!==i?i:rh([{cmd:"conditions",type:Cl.CONDITION_ARRAY,value:e.conditions,require:!1},{cmd:"cost",type:Cl.COST_ARRAY,value:e.cost,require:!0},{cmd:"by_pass",type:Cl.NUMBER,value:e.by_pass,require:!1}])}}function dh(t,e){if(e&&void 0===t)return"cost missing";if(void 0!==t){const e=t,i=Zh(new Vh,e);return void 0!==i?i:rh([{cmd:"type",type:Cl.STRING,value:e.type,require:!0},{cmd:"value",type:Cl.NUMBER,value:e.value,require:!0}])}}function ph(t,e){if(e&&void 0===t)return"cost missing";if(void 0===t)return;const i=t;if(!Array.isArray(i))return"cost not array";const r=[];return i.forEach((t=>{const e=Zh(new Vh,i);if(void 0!==e)return e;const s=rh([{cmd:"type",type:Cl.STRING,value:t.type,require:!0},{cmd:"value",type:Cl.NUMBER,value:t.value,require:!0}]);void 0!==s&&r.push(s)})),r.length>0?JSON.stringify(r):void 0}function fh(t,e){if(e&&void 0===t)return"condition missing";if(void 0===t)return;const i=t;if(!Array.isArray(i))return"condition not array";const r=[];if(i.forEach((t=>{const e=Zh(new Kh,t);if(void 0!==e)return e;const i=rh([{cmd:"type",type:Cl.STRING,value:t.type,require:!0},{cmd:"value",type:Cl.NUMBER,value:t.value,require:!0}]);void 0!==i&&r.push(i)})),r.length>0)return JSON.stringify(r);console.log("condition array:",i)}function gh(t){for(const e of Rl)if(t.startsWith(`${e}_`))return!0;return!1}function mh(t){return t?gh(t)?`state [${t}] start with ${JSON.stringify(Rl)} + _`:void 0:"state missing"}function yh(t){if(!gh(t))return`variable [${t}] not start with ${JSON.stringify(Rl)} + _ ${vl(gl)}`}class vh{constructor(){this.type="music",this.label="",this.music=""}}class bh{constructor(){this.type="background",this.label="",this.background=""}}class wh{constructor(){this.type="cg",this.label="",this.cg=""}}class Sh{constructor(){this.type="novel_msg",this.label="",this.msg="",this.character="",this.position="",this.act="",this.override_name=""}}class _h{constructor(){this.hide_msg=!0,this.type="novel_hide_msg",this.label=""}}class kh{constructor(){this.type="chat_msg",this.label="",this.msg="",this.avatar="",this.delay=0,this.frame="",this.override_name="",this.style=[]}}class Eh{constructor(){this.type="shake",this.label="",this.shake=""}}class Ah{constructor(){this.type="sound",this.label="",this.sound=""}}class Ch{constructor(){this.type="novel_choice",this.label="",this.choice=[],this.skip={msg:"",goto:""},this.state="",this.character="",this.override_name=""}}class Rh{constructor(){this.msg="",this.goto=""}}class xh{constructor(){this.title="",this.content=""}}class Ih{constructor(){this.msg="",this.msg_override="",this.cost=0,this.update=[],this.goto=""}}class Nh{constructor(){this.type="chat_choice",this.label="",this.choice=[],this.skip={msg:"",goto:""},this.state="",this.avatar="",this.delay=0,this.override_name=""}}class Th{constructor(){this.type="character",this.label="",this.character="",this.position="",this.act="",this.transition=""}}class Oh{constructor(){this.type="goto",this.label="",this.goto="",this.state=""}}class Lh{constructor(){this.type="image",this.label="",this.image="",this.avatar="",this.delay=0,this.override_name="",this.width=0,this.height=0}}class Mh{constructor(){this.type="sys",this.label="",this.sys="",this.delay=0}}class Fh{constructor(){this.type="sticker",this.label="",this.sticker="",this.avatar="",this.delay=0,this.override_name=""}}class Dh{constructor(){this.type="novel",this.novel="",this.label="",this.title="",this.to_be_continue=!0,this.day=0,this.avatars=[],this.free_heart=!0,this.half_heart=!0,this.force_heart=0,this.models=[],this.end_game="",this.notify={title:"",content:""},this.time="",this.end_day=!0,this.room_condition=0,this.locked={conditions:[],cost:[]},this.cost={type:"none",value:0},this.prologue=!0}}class Bh{constructor(){this.type="light_novel",this.light_novel="",this.label="",this.title="",this.to_be_continue=!0,this.day=0,this.end_game="",this.room_condition=0,this.locked={conditions:[],cost:[]},this.cost={type:"none",value:0},this.prologue=!0}}class Uh{constructor(){this.type="light_novel_msg",this.label="",this.align="",this.msg=""}}class Gh{constructor(){this.type="chat",this.chat="",this.label="",this.title="",this.to_be_continue=!0,this.day=0,this.avatars=[],this.free_heart=!0,this.half_heart=!0,this.force_heart=0,this.end_game="",this.notify={title:"",content:""},this.time="",this.end_day=!0,this.room_condition=0,this.locked={conditions:[],cost:[]},this.cost={type:"none",value:0},this.prologue=!0,this.theme=""}}class jh{constructor(){this.type="delay",this.label="",this.delay=0}}class $h{constructor(){this.type="image_on_exit",this.label="",this.image_on_exit=[],this.state=""}}class Ph{constructor(){this.type="conclusion_image",this.label="",this.conclusion_image="",this.delay=0}}class qh{constructor(){this.type="conclusion_msg",this.label="",this.conclusion_msg="",this.params=[],this.delay=0}}class zh{constructor(){this.type="empty",this.label=""}}class Wh{constructor(){this.type="ending",this.label="",this.ending={title:"",subtitle:"",story_suggest:0}}}class Hh{constructor(){this.type="chat_mode",this.label="",this.chat_mode="visual_novel"}}class Yh{constructor(){this.type="typing",this.label="",this.typing=!1,this.avatar="",this.override_name="",this.delay=0,this.stop=!1}}class Jh{constructor(){this.type="override_avatar",this.override_avatar="",this.image="",this.label=""}}class Kh{constructor(){this.type="food_rank",this.value=0}}class Vh{constructor(){this.type="none",this.value=0}}class Xh{constructor(){this.conditions=[],this.cost=[],this.by_pass=0}}function Zh(t,e){const i=new Set;Object.keys(t).forEach((t=>{i.add(t)}));const r=[];if(Object.keys(e).forEach((t=>{i.has(t)||r.push(t)})),r.length>0)return`${JSON.stringify(r)} not member of ${t.type}`}const Qh=new Set(["music","background","cg","novel_msg","novel_hide_msg","shake","sound","delay","novel_choice","character","goto","image","image_on_exit"]),tu=new Set(["music","delay","goto","image","sys","chat_msg","chat_choice","sticker","empty","image_on_exit","conclusion_image","conclusion_msg","background","chat_mode","sound","typing","override_avatar","cg"]),eu=new Set(["music","light_novel_msg","image"]),iu=new Set(["novel","light_novel","chat","goto","empty","ending"]);class ru{constructor(){this.fileSizeWarning=new Map}getFileSizeWarning(){return this.fileSizeWarning}loadStory(t,e,i,r,s){var n;let o,a=[];try{const c=h.join(Al(s,t),`${i}.yaml`),u=l.statSync(c);if("story.yaml"!=`${i}.yaml`&&u.size>51200){const e=`${i} is bigger than 50 KB (file size = ${u.size/1024} KB)`;this.fileSizeWarning.set(t,[...null!==(n=this.fileSizeWarning.get(t))&&void 0!==n?n:[],e])}a=vi(l.readFileSync(c,"utf-8"));const d=this.prepareData(e,i,a);r&&(this.validateData(e,i,d),sl(e,i,d),cl(t,e,i,d),function(t,e,i){var r,s;if("novel"!==t&&"chat"!==t)return;const n=new Map,o=t=>{for(const e of n.values())if(e.char===t)return e.act;return""},a=[];a.push([]);for(const t of i)switch(t.type){case"novel_msg":a[a.length-1].push({node:t,act:o(t.character)});break;case"character":t.position&&("empty"!==t.character?(void 0!==t.act&&t.act,n.set(t.position,{char:t.character,act:null!==(r=t.act)&&void 0!==r?r:""})):n.delete(t.position)),a[a.length-1].push({node:t,act:null!==(s=o(t.character))&&void 0!==s?s:""});break;default:a[a.length-1].push({node:t,act:""})}for(const i of a)for(let r=0;r<i.length;++r){if(0===r)continue;const s=i[r-1],n=i[r];"character"===n.node.type&&"novel_msg"===s.node.type&&n.node.character===s.node.character&&n.act===s.act&&console.log(`validateRoomNode type[${t}] name[${e}] format error: invalid order character and novel_msg current [${JSON.stringify(n)}] previous [${JSON.stringify(s)}]`)}}(e,i,d),wl(e,i,d)),o="novel"===e?this.verifyData(d,(t=>Qh.has(t.type))):"chat"===e?this.verifyData(d,(t=>tu.has(t.type))):"light_novel"===e?this.verifyData(d,(t=>eu.has(t.type))):"story"===e?this.verifyData(d,(t=>iu.has(t.type))):"unknow type"}catch(t){o=t}if(o)throw new Error(`loadStory type[${e}] name[${i}] error: `+o);return a}prepareData(t,e,i){const r=[];for(let s=0;s<i.length;++s){const n=i[s];if(void 0!==n.music?n.type="music":void 0!==n.background?n.type="background":void 0!==n.cg?n.type="cg":void 0!==n.msg?n.type="novel"===t?"novel_msg":"chat"===t?"chat_msg":"light_novel"===t?"light_novel_msg":"invalid_msg":n.hide_msg?n.type="novel_hide_msg":void 0!==n.shake?n.type="shake":void 0!==n.sound?n.type="sound":void 0!==n.choice?void 0!==n.character?n.type="novel_choice":void 0!==n.avatar&&(n.type="chat_choice"):void 0!==n.character?n.type="character":void 0!==n.goto?n.type="goto":void 0!==n.image&&void 0===n.override_avatar?(n.type="image",n.image):void 0!==n.sys?n.type="sys":void 0!==n.sticker?n.type="sticker":void 0!==n.typing?n.type="typing":void 0!==n.override_avatar?n.type="override_avatar":void 0!==n.conclusion_image?n.type="conclusion_image":void 0!==n.conclusion_msg?n.type="conclusion_msg":void 0!==n.novel?n.type="novel":void 0!==n.chat?n.type="chat":void 0!==n.light_novel?n.type="light_novel":void 0!==n.delay?n.type="delay":void 0!==n.image_on_exit?n.type="image_on_exit":void 0!==n.ending?n.type="ending":void 0!==n.label?n.type="empty":void 0!==n.chat_mode&&(n.type="chat_mode"),void 0===n.type)throw new Error(`prepareData type[${t}] name[${e}] unknow type at ${s}: ${JSON.stringify(n,null,2)}`);r.push(n)}return r}validateData(t,e,i){for(let r=0;r<i.length;++r){const s=i[r];let n;switch(s.type){case"music":n=xl(s);break;case"background":n=Il(s);break;case"cg":n=Nl(s);break;case"novel_msg":n=Tl(s);break;case"novel_hide_msg":n=Ol(s);break;case"chat_msg":n=Ll(s);break;case"shake":n=Ml(s);break;case"sound":n=Fl(s);break;case"novel_choice":n=Dl(s);break;case"chat_choice":n=Bl(s);break;case"character":n=Ul(s);break;case"goto":n=Gl(s);break;case"image":n=jl(t,s);break;case"sys":n=$l(s);break;case"sticker":n=Pl(s);break;case"conclusion_image":n=Jl(s);break;case"conclusion_msg":n=Vl(s);break;case"novel":n=ql(s);break;case"light_novel":n=zl(s);break;case"chat":n=Wl(s);break;case"image_on_exit":n=Yl(s);break;case"ending":n=Zl(s);break;case"empty":n=Xl(s);break;case"chat_mode":n=Ql(s);break;case"light_novel_msg":n=Kl(s);break;case"typing":n=th(s);break;case"override_avatar":n=eh(s);break;case"delay":n=Hl(s);break;default:throw new Error(`validateData type[${t}] name[${e}] \nunexpected type at ${r}:\ndata:\n${JSON.stringify(s,null,2)}\nerror:\n - ${n}`)}if(n)throw new Error(`validateData type[${t}] name[${e}] \nformat error at ${r}:\ndata:\n${JSON.stringify(s,null,2)}\nerror:\n - ${n}`)}return!0}verifyData(t,e){for(let i=0;i<t.length;++i){if(void 0===t[i].type)return`type undefined at ${i} ${JSON.stringify(t[i])}`;if(!e(t[i]))return"cg"===t[i].type?`${t[i].type} at ${i} ${vl("007")}`:`${t[i].type} at ${i}\n data:\n ${JSON.stringify(t[i])}\n`}}}class su{constructor(){this.loaded=new Map,this.storyList=new Map,this.roomList=new Map,this.roomListByFileName=new Map,this.roomListByStoryID=new Map,this.loader=new ru}setupStory(t){Zc();const e=Vc(),i=new Map;for(const r of e.keys()){const e=this.loader.loadStory(r,"story","story",!0,t.story_path);this.loaded.set(r,e),i.set(r,this.prepareStory(r,e))}this.setupRoomList(this.loaded,t);for(const[t,r]of e.entries()){const e=i.get(t);if(void 0!==e){const i=tl.NONE;this.storyList.set(t,this.newNodeStoryData(t,e,r,i))}}return console.log(`[ISP] setup story with config ${JSON.stringify(t)}`),!0}prepareStory(t,e){var i,r;const s=[];for(const t of e)"novel"===t.type||"chat"===t.type||"light_novel"===t.type?s.push({name:"novel"===t.type?t.novel:"chat"===t.type?t.chat:"light_novel",type:t.type,typeNum:el(t.type),label:t.label,title:t.title,to_be_continue:null!==(i=t.to_be_continue)&&void 0!==i&&i,day:t.day?t.day:0,avatars:"light_novel"===t.type?[]:t.avatars?t.avatars:[],free_heart:"light_novel"!==t.type&&(!!t.free_heart&&t.free_heart),models:"novel"===t.type?t.models:void 0,data:void 0,locked:void 0!==t.locked?t.locked:{conditions:[],cost:[]},cost:void 0!==t.cost?t.cost:{type:"none",value:0},prologue:null!==(r=t.prologue)&&void 0!==r&&r,theme:"chat"===t.type?t.theme:"",mission:{enter:[],complete:[]},getLockedByPass:()=>void 0!==t.locked&&void 0!==t.locked.by_pass?{type:"gold",value:t.locked.by_pass}:{type:"none",value:0}}):"goto"===t.type?s.push({type:t.type,goto:t.goto,label:t.label}):"empty"===t.type?s.push({type:t.type,label:t.label}):"ending"===t.type&&s.push({type:t.type,label:t.label,ending:t.ending});return console.log(`[ISP] build ${t} [${s.length}]`),s}setupRoomList(t,e){t.forEach(((t,i)=>{for(const r of t)if("novel"===r.type){const t=new il(i,r.type,r.novel,r.label,this.loader.loadStory(i,r.type,r.novel,e.validate,e.story_path));this.roomList.set(this.combineKey(r.label,t.getStoryID()),t),this.roomListByFileName.set(r.novel,t);const s=this.roomListByStoryID.get(i),n={fileName:r.novel,room:t};void 0===s?this.roomListByStoryID.set(i,[n]):s.push(n)}else if("chat"===r.type){const t=new il(i,r.type,r.chat,r.label,this.loader.loadStory(i,r.type,r.chat,e.validate,e.story_path));this.roomList.set(this.combineKey(r.label,t.getStoryID()),t),this.roomListByFileName.set(r.chat,t);const s=this.roomListByStoryID.get(i),n={fileName:r.chat,room:t};void 0===s?this.roomListByStoryID.set(i,[n]):s.push(n)}else if("light_novel"===r.type){const t=new il(i,r.type,r.light_novel,r.label,this.loader.loadStory(i,r.type,r.light_novel,e.validate,e.story_path));this.roomList.set(this.combineKey(r.label,t.getStoryID()),t),this.roomListByFileName.set(r.light_novel,t);const s=this.roomListByStoryID.get(i),n={fileName:r.light_novel,room:t};void 0===s?this.roomListByStoryID.set(i,[n]):s.push(n)}})),console.log(`[ISP] setup room list [${this.roomList.size}]`)}newNodeStoryData(t,e,i,r=tl.NONE){for(const i of e)"novel"!==i.type&&"chat"!==i.type&&"light_novel"!==i.type||(i.data=this.roomList.get(this.combineKey(i.label,t)));return new il(t,"story","","",e,i,r)}getStory(t){const e=this.storyList.get(t);if(void 0===e)throw new Error(`getStory ${t} not found`);return e}getRoomListByFileName(){return this.roomListByFileName}getRoomListByStoryID(t){const e=this.roomListByStoryID.get(t);if(void 0===e)throw new Error(`getRoomListByStoryID ${t} not found`);return e}getRawStoryList(){return this.loaded}getStoryList(){return this.storyList}getStoryFileSizeWarning(){return this.loader.getFileSizeWarning()}combineKey(t,e){return t+"_"+e}}class nu{constructor(t,e){this.loaded=!1,this.data=new Map,this.assetsID=t,this.filePath=e}getCharacterDetail(t){return this.data.get(t)}getCharactersDetail(){return this.data}load(){if(this.loaded)return;const t=Al(this.filePath,this.assetsID),e=vi(l.readFileSync(`${t}/character.yaml`,"utf-8"));for(const t of e){const e=[];for(const i of t.action)e.push(`${t.model}-${i}`);if(t.getActionName=()=>e,this.data.has(t.character))throw new Error(`[${this.assetsID}]duplicate character name: ${t.character}`);this.data.set(t.character,t)}this.loaded=!0,console.log(`loaded character data asset #${this.assetsID} [${this.data.size}]`)}}const ou=new Map;let au=!1;function cu(t){if(au)return;au=!0;const e=function(){const t=Vc(),e=[];for(const[i,r]of t)e.findIndex((t=>t===r.asset_id))<0&&e.push(r.asset_id);return e}();for(const i of e){const e=new nu(i,t);e.load(),ou.set(i,e)}}function lu(t){return ou.get(t)}class hu{constructor(t,e){this.loaded=!1,this.data=new Map,this.storyID=t,this.filePath=e}getGalleryDetail(t){return this.data.get(t)}getGallery(){return this.data}hasImage(t,e){for(let i=0;i<e.collect.length;++i)if(e.collect[i].image===t)return i;return-1}hasCG(t,e){for(let i=0;i<e.collect.length;++i)if(e.collect[i].cg===t)return i;return-1}hasMiniCG(t,e){for(let i=0;i<e.collect.length;++i)if(e.collect[i].mini_cg===t)return i;return-1}load(){this.loaded||(this.data=this.loadGalleryData(`${Al(this.filePath,this.storyID)}/gallery.yaml`),this.loaded=!0,console.log(`loaded gallery story #${this.storyID} [${this.data.size}]`))}loadTool(){return this.loadGalleryData(this.filePath)}loadGalleryData(t){const e=new Map,i=vi(l.readFileSync(t,"utf-8"));for(const t of i){const i=this.checkGalleryLabel(t.label);if(i)throw new Error(`story id: ${this.storyID} load gallery failed.\nerror: ${i}`);const r=this.checkGalleryTitle(t.title);if(r)throw new Error(`story id: ${this.storyID} load gallery failed. error: ${r}`);if(t.collectImage=e=>this.hasImage(e,t),t.collectCG=e=>this.hasCG(e,t),t.collectMiniCG=e=>this.hasMiniCG(e,t),e.has(t.label))throw new Error(`[${this.storyID}]duplicate label in gallery: `+t.label);e.set(t.label,t)}return e}checkGalleryLabel(t){return void 0===t?"label missing":"string"!=typeof t?"label not string":void 0}checkGalleryTitle(t){return void 0===t?"title missing":"string"!=typeof t?"title not string":void 0}}const uu=new Map;let du=!1;function pu(t){if(du)return;du=!0;const e=Vc();for(const i of e.values()){const e=new hu(i.id,t);e.load(),uu.set(i.id,e)}}function fu(t){const e=uu.get(t);if(void 0===e)throw new Error(`missing gallery in story #${t}`);return e}const gu=[{name:"avatar",path:"image/avatar.txt"},{name:"gallery",path:"image/gallery.txt"},{name:"bg",path:"image/bg.txt"},{name:"cg",path:"image/cg.txt"},{name:"cg-thumb",path:"image/cg-thumb.txt"},{name:"minicg",path:"image/minicg.txt"},{name:"music",path:"music/music.txt"},{name:"sound",path:"music/sound.txt"},{name:"chat",path:"prefab/chat.txt"},{name:"character",path:"prefab/character.txt"},{name:"sticker",path:"prefab/sticker.txt"},{name:"avatar-config",path:"config/avatar.yaml"}];class mu{constructor(t,e,i){this.mapResourcesNotUse=new Map,this.storyID=t,this.assetsID=e,this.factory=i,this.avatarSet=this.getResources("avatar"),this.gallerySet=this.getResources("gallery"),this.bgSet=this.getResources("bg"),this.cgSet=this.getResources("cg"),this.cgThumbSet=this.getResources("cg-thumb"),this.minicgSet=this.getResources("minicg"),this.musicSet=this.getResources("music"),this.soundSet=this.getResources("sound"),this.chatFrameSet=this.getResources("chat"),this.modelSet=this.getResources("character"),this.stickerSet=this.getResources("sticker"),this.avatarConfigs=new Map,this.mapResourcesNotUse.set("avatarSet",Array.from(this.avatarSet.values())),this.mapResourcesNotUse.set("gallerySet",Array.from(this.gallerySet.values())),this.mapResourcesNotUse.set("bgSet",Array.from(this.bgSet.values())),this.mapResourcesNotUse.set("cgSet",Array.from(this.cgSet.values())),this.mapResourcesNotUse.set("cgThumbSet",Array.from(this.cgThumbSet.values())),this.mapResourcesNotUse.set("minicgSet",Array.from(this.minicgSet.values())),this.mapResourcesNotUse.set("musicSet",Array.from(this.musicSet.values())),this.mapResourcesNotUse.set("soundSet",Array.from(this.soundSet.values())),this.mapResourcesNotUse.set("chatFrameSet",Array.from(this.chatFrameSet.values())),this.mapResourcesNotUse.set("modelSet",Array.from(this.modelSet.values())),this.mapResourcesNotUse.set("stickerSet",Array.from(this.stickerSet.values()))}run(){const t=this.checkClientResourcesCGWithThumb();this.outResult("cg-with-thumb",t);const e=this.checkClientResourcesModel();this.outResult("model",e);const i=this.checkClientResourcesStoryAndRoom();this.outResult("story",i);const r=this.checkClientResourcesGallery();return this.outResult("gallery",r),!0}checkAvatar(t,e){const i=function(t){const e=Xc.get(t);if(void 0===e)throw new Error(`getStory: story not found #${t}`);return e}(t);t>0&&"me"===e&&(e=i.avatar.id);const r=this.getAvatarImageName(i.asset_id,e);if(this.pullResourcesNotUse("avatarSet",r),!this.avatarSet.has(r))return`missing avatar #${r}`}getAvatarImageName(t,e){let i=this.avatarConfigs.get(t);if(!i){const r=Al("./game/client-exists-resources/",t)+"/avatar.yaml";if(i=Ci.load(l.readFileSync(r,"utf-8")),!i)return e;this.avatarConfigs.set(t,i)}const r=i.find((t=>t.avatar===e));return r?r.image:e}checkGallery(t){if(this.pullResourcesNotUse("gallerySet",t),!this.gallerySet.has(t))return`missing gallery #${t}`}checkBG(t){if("empty"!==t)return this.pullResourcesNotUse("bgSet",t),this.bgSet.has(t)?void 0:`missing bg #${t}`}checkCG(t){if("empty"!==t)return this.pullResourcesNotUse("cgSet",t),this.cgSet.has(t)?void 0:`missing cg #${t}`}checkCGThumb(t){if(this.pullResourcesNotUse("cgThumbSet",t),!this.cgThumbSet.has(t))return`missing cg_thumb #${t}`}checkImageAndMiniCG(t){if("empty"!==t)return this.cgSet.has(t)&&this.pullResourcesNotUse("cgSet",t),this.minicgSet.has(t)&&this.pullResourcesNotUse("minicgSet",t),this.cgSet.has(t)||this.minicgSet.has(t)?void 0:`missing image or minicg #${t}`}checkImageThumb(t){if(this.pullResourcesNotUse("cgThumbSet",t),!this.cgThumbSet.has(t))return`missing image_thumb #${t}`}checkMusic(t){if("empty"!==t)return this.pullResourcesNotUse("musicSet",t),this.musicSet.has(t)?void 0:`missing music #${t}`}checkSound(t){if(this.pullResourcesNotUse("soundSet",t),!this.soundSet.has(t))return`missing sound #${t}`}checkChatFrame(t){if(this.pullResourcesNotUse("chatFrameSet",t),!this.chatFrameSet.has(t))return`missing chat_frame #${t}`}checkCharacter(t,e=""){if("empty"===t)return;const i=lu(this.assetsID);if(void 0===i)return`missing character data in asset #${this.assetsID}`;const r=i.getCharacterDetail(t);return void 0===r?`missing character #${t}`:e&&!r.action.includes(e)?`missing act ${e} for character ${t}`:void 0}checkModel(t){if(this.pullResourcesNotUse("modelSet",t),!this.modelSet.has(t))return`missing model #${t}`}checkSticker(t){if(this.pullResourcesNotUse("stickerSet",t),!this.stickerSet.has(t))return`missing sticker #${t}`}checkClientResourcesModel(){const t=new Map,e=lu(this.assetsID);if(void 0!==e){const i=e.getCharactersDetail();for(const[e,r]of i){if("default"===r.model)continue;const i=this.checkModel(r.model);if(void 0===i)continue;const s=r.getActionName(),n=[];for(const t of s){const e=this.checkModel(t);void 0!==e&&n.push(e)}n.length===s.length?t.set(e,[{index:0,error:[i]}]):n.length>0&&t.set(e,[{index:0,error:n}])}}else t.set(this.storyID.toString(),[{index:0,error:[`missing character data in asset #${this.assetsID}`]}]);return t}checkClientResourcesStoryAndRoom(){const t=new Map,e=this.factory.getRawStoryList();for(const[i,r]of e.entries()){if(this.storyID.findIndex((t=>t===i))<0)continue;const e=[];for(let t=0;t<r.length;++t){const s=r[t],n=this.checkByNode(i,s);n.length>0&&e.push({index:t,error:n})}e.length>0&&t.set(i.toString(),e)}for(const e of this.storyID){const i=this.factory.getRoomListByStoryID(e);for(const r of i){const i=r.room.getData(),s=[];for(let t=0;t<i.length;++t){const r=i[t],n=this.checkByNode(e,r);n.length>0&&s.push({index:t,error:n})}s.length>0&&t.set(r.fileName,s)}}return t}checkClientResourcesCGWithThumb(){const t=new Map;for(const e of this.cgSet.values()){if(""===e||""===e)continue;const i=`${e}_thumb`;void 0!==this.checkCGThumb(i)&&this.put(t,"cg missing thumb",i)}for(const e of this.cgThumbSet.values()){const i=`${e.split("_thumb")[0]}`;void 0!==this.checkCG(i)&&this.put(t,"thumb missing cg",i)}return t}checkClientResourcesGallery(){const t=new Map,e=uu;for(const i of this.storyID){const r=e.get(i);if(void 0!==r)for(const e of r.getGallery().values()){void 0!==this.checkGallery(e.image)&&this.put(t,"missing gallery",e.image);for(let i=0;i<e.collect.length;++i){const r=e.collect[i];if(void 0!==r.cg){void 0!==this.checkCG(r.cg)&&this.put(t,`missing gallery #${e.image} cg at #${i}`,r.cg)}else if(void 0!==r.image){void 0!==this.checkImageAndMiniCG(r.image)&&this.put(t,`missing gallery #${e.image} image at #${i}`,r.image)}else if(void 0!==r.mini_cg){void 0!==this.checkImageAndMiniCG(r.mini_cg)&&this.put(t,`missing gallery #${e.image} minicg at #${i}`,r.mini_cg)}}}}return t}checkClientResourcesNotUse(){const t=new Map;for(const[e,i]of this.mapResourcesNotUse)for(const r of i)this.put(t,`resources ${e} not use`,r);return t}pullResourcesNotUse(t,e){const i=this.mapResourcesNotUse.get(t);if(void 0===i)throw new Error(`pullResourcesNotUse: key not found #${t}`);const r=i.findIndex((t=>t===e));r>=0&&i.splice(r,1)}put(t,e,i){let r=t.get(e);void 0===r&&(r=[],t.set(e,r)),r.push(i)}outResult(t,e){if(e.size<=0)console.log(`all resources assets_id: ${this.assetsID} #${t} exists`);else{l.mkdirSync(`./check-result/${this.assetsID}`,{recursive:!0}),console.log(`======= missing result assets_id: ${this.assetsID} #${t} =======`);let i="";for(const[t,r]of e.entries()){const e=JSON.stringify(r,void 0,2);i+=`${t} ${e}\n`,console.error(t,e)}l.writeFileSync(`./check-result/${this.assetsID}/missing-resources-asset${this.assetsID}-${t}-result.txt`,i,{encoding:"utf-8"})}}checkByNode(t,e){switch(e.type){case"music":return this.checkResourceMusic(e);case"background":return this.checkResourceBackground(e);case"cg":return this.checkResourceCG(e);case"novel_msg":return this.checkResourceNovelMsg(e);case"novel_hide_msg":return this.checkResourceNovelHideMsg(e);case"chat_msg":return this.checkResourceChatMsg(t,e);case"shake":return this.checkResourceShake(e);case"sound":return this.checkResourceSound(e);case"delay":return this.checkResourceDelay(e);case"novel_choice":return this.checkResourceNovelChoice(e);case"chat_choice":return this.checkResourceChatChoice(t,e);case"character":return this.checkResourceCharacter(e);case"image":return this.checkResourceImage(t,e);case"goto":return this.checkResourceGoto(e);case"sys":return this.checkResourceSys(e);case"sticker":return this.checkResourceSticker(t,e);case"novel":return this.checkResourceNovel(t,e);case"chat":return this.checkResourceChat(t,e);case"light_novel":return this.checkResourceLightNovel(t,e);case"light_novel_msg":return this.checkResourceLightNovelMsg(e);case"image_on_exit":return this.checkResourceEnd(e);case"conclusion_image":return this.checkResourceConclusionImage(e);case"conclusion_msg":return this.checkResourceConclusionMsg(e);case"ending":return this.checkResourceEnding(e);case"empty":return this.checkResourceEmpty(e);case"chat_mode":return this.checkResourceChatMode(e);case"typing":return this.checkResourceTyping(e);default:return[`unknow node type #${e.type}`]}}load(t){return l.readFileSync(`${Al("./game/client-exists-resources",this.assetsID)}/${t}`,"utf-8").replace(/\r\n/g,"\n").split("\n")}getPathByType(t){for(const e of gu)if(e.name===t)return e.path}getResources(t){const e=this.getPathByType(t);if(void 0===e)throw new Error("getResources: invalid path");const i=this.load(e);return console.log(`${t}: ${i.length} name`),new Set(i)}checkResourceMusic(t){const e=[],i=this.checkMusic(t.music);return void 0!==i&&e.push(i),e}checkResourceBackground(t){const e=[],i=this.checkBG(t.background);return void 0!==i&&e.push(i),e}checkResourceCG(t){const e=[],i=this.checkCG(t.cg);return void 0!==i&&e.push(i),e}checkResourceNovelMsg(t){const e=[],i=this.checkCharacter(t.character);return void 0!==i&&e.push(i),e}checkResourceChatMsg(t,e){const i=[],r=this.checkAvatar(t,e.avatar);if(void 0!==r&&i.push(r),void 0!==e.frame){const t=this.checkChatFrame(e.frame);void 0!==t&&i.push(t)}return i}checkResourceShake(t){return[]}checkResourceSound(t){const e=[],i=this.checkSound(t.sound);return void 0!==i&&e.push(i),e}checkResourceDelay(t){return[]}checkResourceNovelChoice(t){const e=[],i=this.checkCharacter(t.character);return void 0!==i&&e.push(i),e}checkResourceChatChoice(t,e){const i=[],r=this.checkAvatar(t,e.avatar);return void 0!==r&&i.push(r),i}checkResourceCharacter(t){const e=[],i=this.checkCharacter(t.character,t.act);return void 0!==i&&e.push(i),e}checkResourceGoto(t){return[]}checkResourceImage(t,e){const i=[],r=this.checkImageAndMiniCG(e.image);if(void 0!==r&&i.push(r),void 0!==e.avatar){const r=this.checkAvatar(t,e.avatar);void 0!==r&&i.push(r)}return i}checkResourceSys(t){return[]}checkResourceSticker(t,e){const i=[],r=this.checkSticker(e.sticker);if(void 0!==r&&i.push(r),void 0!==e.avatar){const r=this.checkAvatar(t,e.avatar);void 0!==r&&i.push(r)}return i}checkResourceNovel(t,e){const i=[];if(void 0!==e.avatars)for(const r of e.avatars){const e=this.checkAvatar(t,r);void 0!==e&&i.push(e)}if(void 0!==e.models)for(const t of e.models){const e=this.checkCharacter(t);void 0!==e&&i.push(e)}return i}checkResourceChat(t,e){const i=[];if(void 0!==e.avatars)for(const r of e.avatars){const e=this.checkAvatar(t,r);void 0!==e&&i.push(e)}return i}checkResourceLightNovel(t,e){return[]}checkResourceLightNovelMsg(t){return[]}checkResourceEnd(t){const e=[];for(const i of t.image_on_exit){const t=this.checkImageAndMiniCG(i);void 0!==t&&e.push(t)}return e}checkResourceConclusionImage(t){const e=[],i=this.checkImageAndMiniCG(t.conclusion_image);return void 0!==i&&e.push(i),e}checkResourceConclusionMsg(t){return[]}checkResourceEnding(t){return[]}checkResourceEmpty(t){return[]}checkResourceChatMode(t){return[]}checkResourceTyping(t){return[]}checkResourceNovelHideMsg(t){return[]}}function yu(t,e,i){pu(e),cu(i);const r=function(){const t=Vc(),e=new Map;for(const[i,r]of t){let t=e.get(r.asset_id);void 0===t&&(t=[],e.set(r.asset_id,t)),t.push(r.id)}return e}(),s=[];l.existsSync("./check-result")&&l.rmSync("./check-result",{recursive:!0});for(const[e,i]of r){new mu(i,e,t).run()||s.push(e)}return s.length<=0}class vu{constructor(t){this.stateData=new Map,this.factory=t}run(){const t=this.checkRoom();if(t.size<=0)console.log("all state not duplicate");else{console.log("======= duplicate result =======");let e="";for(const[i,r]of t.entries()){const t=JSON.stringify(r,void 0,2);e+=`${i} ${t}\n`,console.log(i,t)}l.writeFileSync("./duplicate-state-result.txt",e,{encoding:"utf-8"})}return t.size<=0}checkRoom(){const t=this.factory.getRoomListByFileName();for(const[e,i]of t.entries()){const t=i.getData();for(const i of t)this.checkByNode(e,i)}const e=new Map;for(const[t,i]of this.stateData.entries())i.length>1&&e.set(t,i);return e}checkByNode(t,e){switch(e.type){case"novel_choice":this.checkDupNovelChoice(t,e);break;case"chat_choice":this.checkDupChatChoice(t,e);break;case"goto":this.checkDupGoto(t,e);break;case"image_on_exit":this.checkDupEnd(t,e)}}checkDupNovelChoice(t,e){this.addStateData(e.state,t)}checkDupChatChoice(t,e){this.addStateData(e.state,t)}checkDupGoto(t,e){void 0!==e.state&&this.addStateData(e.state,t)}checkDupEnd(t,e){void 0!==e.state&&this.addStateData(e.state,t)}addStateData(t,e){void 0===e&&(e="no_name");const i=this.stateData.get(t);void 0===i?this.stateData.set(t,[e]):i.push(e)}}const bu="Assets/AddressablesAsset";function wu(t,e){const i=e[t].match(/\S+/g);if(null!==i)return i[0]}class Su{constructor(t){this.loopData=new Map,this.ignoreLabel=new Set(["rv0903aq1c","kv1005q2a"]),this.factory=t}run(){const t=this.checkRoom();if(t.size<=0)console.log("no loop found");else{console.log("======= story loop result =======");let e="";for(const[i,r]of t.entries()){const t=JSON.stringify(r,void 0,2);e+=`${i} ${t}\n`,console.log(i,t)}l.writeFileSync("./story-loop-result.txt",e,{encoding:"utf-8"})}return t.size<=0}checkRoom(){const t=this.factory.getRoomListByFileName();for(const[e,i]of t.entries()){const t=i.getData();for(let r=0;r<t.length;++r){const s=t[r];this.checkByNode(e,s,r,i)}}const e=new Map;for(const[t,i]of this.loopData.entries())e.set(t,i);return e}checkByNode(t,e,i,r){switch(e.type){case"novel_choice":this.checkLoopNovelChoice(t,e,i,r);break;case"chat_choice":this.checkLoopChatChoice(t,e,i,r);break;case"goto":this.checkLoopGoto(t,e,i,r)}}checkLoopNovelChoice(t,e,i,r){for(const s of e.choice)void 0!==s.goto&&this.checkGotoData(t,s.goto,i,r);void 0!==e.skip&&this.checkGotoData(t,e.skip.goto,i,r)}checkLoopChatChoice(t,e,i,r){for(const s of e.choice)void 0!==s.goto&&this.checkGotoData(t,s.goto,i,r);void 0!==e.skip&&this.checkGotoData(t,e.skip.goto,i,r)}checkLoopGoto(t,e,i,r){this.checkGotoData(t,e.goto,i,r)}checkGotoData(t,e,i,r){try{if(Array.isArray(e))for(let s=0;s<e.length;++s){const n=wu(s,e);if(void 0===n)throw new Error("checkGotoData: cannot find goto label");i>r.getIndexByLabel(n)&&this.addLoopData(n,t)}else{i>r.getIndexByLabel(e)&&this.addLoopData(e,t)}}catch(e){console.log(`checkGotoData: filename: #${t} message: #${e}`)}}addLoopData(t,e){this.ignoreLabel.has(t)||(void 0===e&&(e="no_name"),this.loopData.set(t,e))}}function _u(t){const e=t+"/story",i=t+"/assets/Assets/AddressablesAsset/configs",r=new su;if(!r.setupStory({validate:!0,general:!0,story_path:e}))throw new Error("setupStory: failed");if(!yu(r,i,i))throw new Error("checkClientResources: failed");if(!function(t){return new vu(t).run()}(r))throw new Error("checkDuplicateState: failed");if(!function(t){return new Su(t).run()}(r))throw new Error("checkStoryLoop: failed");if(r.getStoryFileSizeWarning().size>0)for(const[t,e]of r.getStoryFileSizeWarning())for(const t of e);}class ku{constructor(t){this.data=new Map,this.assets_path=t}add(t,e,i){const r=this.data.get(e);if(void 0!==r)for(const t of i)r.push(t);else this.data.set(e,i)}run(){for(const[t,e]of this.data.entries()){const i=[],r=[];for(const t of e){const e=t,r={};Object.keys(e).forEach((t=>{const i=e[t];var s;void 0===i||(s=i)&&"[object Function]"==={}.toString.call(s)||(r[t]=i)})),i.push(r)}let s=wi(i,{indent:2});s=s.replace(/'/g,""),r.push(s);let n="";n=t>0?h.join(this.assets_path,t.toString(),bu,"configs","gallery.yaml"):h.join(this.assets_path,bu,"configs","gallery.yaml"),l.writeFileSync(n,r.join("\n"))}}}class Eu{constructor(t,e){this.stateData=new Map,this.stateUseData=new Map,this.storyID=t,this.factory=e}run(){const t=this.checkState();if(console.log(`all state [story_id: ${this.storyID} count: ${this.getStateCount()}]`),t.size<=0)console.log("no cross room state found.");else{console.log("======= cross room state result ======="),console.log(`result story_id: ${this.storyID} count: ${this.getStateErrorCount(t)}`),console.log(`state reuse more than one: ${this.getStateErrorCountMoreThanOne(t)}`),console.log("=======================================");let e="";for(const[i,r]of t.entries()){const t=JSON.stringify(r,void 0,2);e+=`${i} ${t}\n`,console.log(i,t)}l.writeFileSync(`./cross-room-state-result-${this.storyID}.txt`,e,{encoding:"utf-8"})}return t}checkState(){const t=this.factory.getStory(this.storyID).getData();for(const e of t)this.checkByNode("story",e);const e=this.factory.getRoomListByStoryID(this.storyID);for(const t of e){const e=t.room.getData();for(const i of e)this.checkByNode(t.fileName,i)}const i=new Map;for(const[t,e]of this.stateData.entries()){const r=[];for(const i of e){const e=this.getStateUseWith(t,i);e.length>0&&r.push({state:i,filename:e})}r.length>0&&i.set(t,r)}return i}checkByNode(t,e){switch(e.type){case"novel_choice":this.checkNovelChoice(t,e);break;case"chat_choice":this.checkChatChoice(t,e);break;case"goto":this.checkGoto(t,e);break;case"image_on_exit":this.checkEnd(t,e)}}checkNovelChoice(t,e){this.addStateData(t,e.state);for(const i of e.choice)i.goto&&this.checkStateUse(t,i.goto)}checkChatChoice(t,e){this.addStateData(t,e.state);for(const i of e.choice)i.goto&&this.checkStateUse(t,i.goto)}checkGoto(t,e){void 0!==e.state&&this.addStateData(t,e.state),this.checkStateUse(t,e.goto)}checkEnd(t,e){void 0!==e.state&&this.addStateData(t,e.state)}addStateData(t,e){void 0===t&&(t="no_name");const i=this.stateData.get(t);void 0===i?this.stateData.set(t,[e]):i.push(e)}addStateUseData(t,e){void 0===t&&(t="no_name");const i=this.stateUseData.get(t);void 0===i?this.stateUseData.set(t,[e]):i.push(e)}checkStateUse(t,e){if(Array.isArray(e)){console.log("fileName:",t);for(const i of e){const e=this.readState(i);for(const i of e)this.addStateUseData(t,i)}}}getStateUseWith(t,e){const i=[];for(const[r,s]of this.stateUseData.entries()){if(t===r)continue;const n=s.find((t=>t===e));void 0!==n&&i.push(r)}return i}readState(t){const e=[];console.log("goto:",t);const i=t.match(/\S+/g);if(null===i)return e;const r=i.length-1,s=Math.floor(r/4);for(let t=0;t<s;++t){const r=i[1+4*t+1];e.push(r)}return e}getStateCount(){let t=0;for(const e of this.stateData.values())t+=e.length;return t}getStateErrorCount(t){let e=0;for(const i of t.values())e+=i.length;return e}getStateErrorCountMoreThanOne(t){let e=0;for(const i of t.values())for(const t of i.values())t.filename.length>1&&(e+=1);return e}}function Au(t){const e=[],i=Vc();for(const r of i.values()){const i=new Eu(r.id,t).run(),s=[];for(const t of i.values()){const e=t.map((t=>t.state));for(const t of e)void 0===s.find((e=>e===t))&&s.push(t)}s.length>0&&e.push({story_id:r.id,state:s})}e.length>0&&function(t){const e=[],i=[];i.push("# GENERATED FILE. DO NOT EDIT.\n");for(const i of t)e.push(i);let r=wi(e,{indent:2});r=r.replace(/'/g,""),i.push(r),l.writeFileSync("game/novel/room-cross-state.yaml",i.join("\n"))}(e)}const Cu=[{src:["avatar"],dst:"image/avatar",ignore:["default"]},{src:["gallery"],dst:"image/gallery",ignore:["gallery_staffdefault"]},{src:["bg"],dst:"image/bg",ignore:["blank"]},{src:["cg"],dst:"image/cg",not_match:["_thumb"],ignore:["Alpha","SR","SSR"]},{src:["cg"],dst:"image/cg-thumb",match:["_thumb"]},{src:["minicg"],dst:"image/minicg",ignore:["mcg_demeter"]},{src:["bgm"],dst:"music/music",ignore:["bgm_cafe","bgm_chat","bgm_startphone","bgm_opening_1","bgm_opening_2","bgm_gacha1"]},{src:["sound","sound-compress"],dst:"music/sound",ignore:["answer","cat1","cat2","cat3","cat4","cat5","chat","click1","click2","click3","save_screen","eat1","coin","plate1"]},{src:["chat"],dst:"prefab/chat",ignore:["conclusion","default","system"]},{src:["character"],dst:"prefab/character"},{src:["sticker"],dst:"prefab/sticker",ignore:["default"]}],Ru=["avatar","character"];class xu{constructor(t,e){this.mix=new Map,this.assetsID=0,this.assets_path=t,this.output_path=e}run(){this.mix.clear();for(const t of Cu)this.combines(t.src,t.dst,t.match,t.not_match,t.ignore);const t=h.join(this.output_path,"client-exists-resources"),e=Al(t,this.assetsID);l.existsSync(this.output_path)||l.mkdirSync(this.output_path),l.existsSync(t)||l.mkdirSync(t),l.existsSync(e)||l.mkdirSync(e),l.existsSync(h.join(e,"image"))||l.mkdirSync(h.join(e,"image")),l.existsSync(h.join(e,"music"))||l.mkdirSync(h.join(e,"music")),l.existsSync(h.join(e,"prefab"))||l.mkdirSync(h.join(e,"prefab"));for(const[t,i]of this.mix)l.writeFileSync(h.join(e,`${t}.txt`),i.join("\n"));for(const t of Ru)this.copyConfig(t,h.join(e))}combines(t,e,i,r,s){for(const n of t)this.combine(n,e,i,r,s)}combine(t,e,i,r,s){const n=this.getList(e),o=this.getNameList(t,i,r,s);for(const t of o)n.push(t)}getList(t){let e=this.mix.get(t);return void 0===e&&(e=[],this.mix.set(t,e)),e}getNameList(t,e,i,r){const s=[],n=Al(this.assets_path,this.assetsID);return l.readdirSync(h.join(`${n}`,bu,t)).forEach((t=>{const n=h.extname(t);if(".meta"===n.toLowerCase()||".preset"===n.toLowerCase())return;const o=h.basename(t,n);void 0!==r&&void 0!==r.find((t=>t===o))||void 0!==e&&e.filter((e=>{if(t.indexOf(e)>=0)return e})).length<e.length||void 0!==i&&i.filter((e=>{if(t.indexOf(e)<0)return e})).length<i.length||s.push(o)})),s}copyConfig(t,e){const i=Al(this.assets_path,this.assetsID)+`/${bu}/configs/${t}.yaml`;l.existsSync(i)&&l.copyFileSync(i,e+`/${t}.yaml`)}}Kc.install();const Iu=[{command:"asset",run:t=>{Bn()}},{command:"story",run:t=>{!function(){const t=Mn("Data/story/source","*.yaml");t.sort();const i=t.map((t=>({novel:t,title:t,label:t})));i.length>0&&(i[0].prologue=!0),i.push({ending:{title:"the end",subtitle:"จบ"},label:"ending"}),e.writeFileSync("Data/story/story.yaml",wi(i))}()}},{command:"cut",run:function(t){void 0!==t.input&&""!==t.input&&void 0!==t.output&&""!==t.output&&void 0!==t.type&&""!==t.type||(console.log("usage cut --input <input path> --output <output path> --type <type value>"),process.exit(1)),Qa.init();const r=i.resolve(t.input),s=i.resolve(t.output);let n;console.log(`input : ${r}`),console.log(`output : ${s}`);let o=parseInt(t.type);if(Number.isNaN(o))console.log("type is incorrect");else if(n=sc[sc[o]],void 0!==n)switch(console.log(`type : ${sc[n]}`),n){case sc.Story:e.readdirSync(r).forEach((t=>{const i=vi(e.readFileSync(`${r}/${t}`,"utf-8"));for(let t=0;t<i.length;++t){let e=i[t];if(void 0!==e.msg&&(e.msg=Qa.cutterString(e.msg)),void 0!==e.choice&&null!=e.choice.length)for(let t=0;t<e.choice.length;++t)null!=e.choice[t]&&null!=e.choice[t].msg&&(e.choice[t].msg=Qa.cutterString(e.choice[t].msg));null!=e.title&&(e.title=Qa.cutterString(e.title))}e.writeFileSync(`${s}/${t}`,wi(i),"utf8")}));break;case sc.Library:const t=vi(e.readFileSync(`${r}`,"utf-8"));for(let e=0;e<t.length;++e){let i=t[e];void 0!==i.name&&(i.name=Qa.cutterString(i.name)),void 0!==i.short_mini_story&&(i.short_mini_story=Qa.cutterString(i.short_mini_story)),void 0!==i.mini_story&&(i.mini_story=Qa.cutterString(i.mini_story))}e.writeFileSync(`${s}`,wi(t,{lineWidth:-1}),"utf8")}else console.log("type is incorrect")}},{command:"check-image",run:function(t){var i;const r=t._[0],s=r?Ci.load(e.readFileSync(r,"utf-8")):{};s.assets_path=null!==(i=s.assets_path)&&void 0!==i?i:"",function(t){for(const i of Ua)try{const r=Ga(t)+i[1].path,s=e.readdirSync(r);if(s)for(const t of s){if(!t.endsWith(".png")&&!t.endsWith(".jpg"))continue;if(!ja(t,i[1].includeKeyword,i[1].excludeKeyword))continue;const e=new Da(i[0],r+t);if(!e.checkValidSize()){const i=t+" size:"+JSON.stringify(e.readSize());throw new Error("image size is invalid: "+i)}}}catch(t){if(t.message.includes("no such file or directory"))continue;throw new Error(t)}}(s.assets_path)}},{command:"check",run:function(e){var i;void 0!==e.data&&""!==e.data||(console.log("usage check --data <data path>"),t.exit(1)),function(t){const e=t+"/assets",i=e+"/Assets/AddressablesAsset/configs";Zc(),pu(i);const r=Vc(),s=new ku(e);for(const t of r.values()){const e=fu(t.id).getGallery(),i=[];for(const t of e.values())i.push(t);s.add(t.id,t.asset_id,i)}s.run()}(e.data),function(t){const e=t+"/story",i=new su;i.setupStory({validate:!1,general:!0,story_path:e}),Au(i)}(e.data),i=e.data,new xu(i+"/assets","./game/").run(),_u(e.data)}}],Nu={};for(const t of Iu)Nu[t.command]=t;process.argv.length<=2&&(console.log(`commands are ${Iu.map((t=>t.command)).join(", ")}`),t.exit(1));const Tu=Nu[process.argv[2]];void 0===Tu&&(console.log(`unknown command ${process.argv[2]}`),t.exit(1)),Tu.run(g(process.argv.slice(3)));
//# sourceMappingURL=buzzde.js.map
